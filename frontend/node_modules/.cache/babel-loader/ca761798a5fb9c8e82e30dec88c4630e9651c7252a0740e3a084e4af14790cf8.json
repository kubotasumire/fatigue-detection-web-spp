{"ast":null,"code":"import { Observable } from \"../Misc/observable.js\";\nimport { WebXRInputSource } from \"./webXRInputSource.js\";\nimport { WebXRMotionControllerManager } from \"./motionController/webXRMotionControllerManager.js\";\n/**\n * XR input used to track XR inputs such as controllers/rays\n */\nexport class WebXRInput {\n  /**\n   * Initializes the WebXRInput\n   * @param xrSessionManager the xr session manager for this session\n   * @param xrCamera the WebXR camera for this session. Mainly used for teleportation\n   * @param _options = initialization options for this xr input\n   */\n  constructor(\n  /**\n   * the xr session manager for this session\n   */\n  xrSessionManager,\n  /**\n   * the WebXR camera for this session. Mainly used for teleportation\n   */\n  xrCamera, _options = {}) {\n    this.xrSessionManager = xrSessionManager;\n    this.xrCamera = xrCamera;\n    this._options = _options;\n    /**\n     * XR controllers being tracked\n     */\n    this.controllers = [];\n    /**\n     * Event when a controller has been connected/added\n     */\n    this.onControllerAddedObservable = new Observable();\n    /**\n     * Event when a controller has been removed/disconnected\n     */\n    this.onControllerRemovedObservable = new Observable();\n    this._onInputSourcesChange = event => {\n      this._addAndRemoveControllers(event.added, event.removed);\n    };\n    // Remove controllers when exiting XR\n    this._sessionEndedObserver = this.xrSessionManager.onXRSessionEnded.add(() => {\n      this._addAndRemoveControllers([], this.controllers.map(c => {\n        return c.inputSource;\n      }));\n    });\n    this._sessionInitObserver = this.xrSessionManager.onXRSessionInit.add(session => {\n      session.addEventListener(\"inputsourceschange\", this._onInputSourcesChange);\n    });\n    this._frameObserver = this.xrSessionManager.onXRFrameObservable.add(frame => {\n      // Update controller pose info\n      this.controllers.forEach(controller => {\n        controller.updateFromXRFrame(frame, this.xrSessionManager.referenceSpace, this.xrCamera, this.xrSessionManager);\n      });\n    });\n    if (this._options.customControllersRepositoryURL) {\n      WebXRMotionControllerManager.BaseRepositoryUrl = this._options.customControllersRepositoryURL;\n    }\n    WebXRMotionControllerManager.UseOnlineRepository = !this._options.disableOnlineControllerRepository;\n    if (WebXRMotionControllerManager.UseOnlineRepository) {\n      // pre-load the profiles list to load the controllers quicker afterwards\n      try {\n        WebXRMotionControllerManager.UpdateProfilesList().catch(() => {\n          WebXRMotionControllerManager.UseOnlineRepository = false;\n        });\n      } catch (e) {\n        WebXRMotionControllerManager.UseOnlineRepository = false;\n      }\n    }\n  }\n  _addAndRemoveControllers(addInputs, removeInputs) {\n    // Add controllers if they don't already exist\n    const sources = this.controllers.map(c => {\n      return c.inputSource;\n    });\n    for (const input of addInputs) {\n      if (sources.indexOf(input) === -1) {\n        const controller = new WebXRInputSource(this.xrSessionManager.scene, input, {\n          ...(this._options.controllerOptions || {}),\n          forceControllerProfile: this._options.forceInputProfile,\n          doNotLoadControllerMesh: this._options.doNotLoadControllerMeshes,\n          disableMotionControllerAnimation: this._options.disableControllerAnimation\n        });\n        this.controllers.push(controller);\n        this.onControllerAddedObservable.notifyObservers(controller);\n      }\n    }\n    // Remove and dispose of controllers to be disposed\n    const keepControllers = [];\n    const removedControllers = [];\n    this.controllers.forEach(c => {\n      if (removeInputs.indexOf(c.inputSource) === -1) {\n        keepControllers.push(c);\n      } else {\n        removedControllers.push(c);\n      }\n    });\n    this.controllers = keepControllers;\n    removedControllers.forEach(c => {\n      this.onControllerRemovedObservable.notifyObservers(c);\n      c.dispose();\n    });\n  }\n  /**\n   * Disposes of the object\n   */\n  dispose() {\n    this.controllers.forEach(c => {\n      c.dispose();\n    });\n    this.xrSessionManager.onXRFrameObservable.remove(this._frameObserver);\n    this.xrSessionManager.onXRSessionInit.remove(this._sessionInitObserver);\n    this.xrSessionManager.onXRSessionEnded.remove(this._sessionEndedObserver);\n    this.onControllerAddedObservable.clear();\n    this.onControllerRemovedObservable.clear();\n    // clear the controller cache\n    WebXRMotionControllerManager.ClearControllerCache();\n  }\n}\n//# sourceMappingURL=webXRInput.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}