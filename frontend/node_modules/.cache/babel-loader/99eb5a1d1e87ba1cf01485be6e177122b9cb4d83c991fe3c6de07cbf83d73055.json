{"ast":null,"code":"const _maxGroups = 4;\nconst _maxBindingsPerGroup = 1 << 16;\n// all types not listed are assumed to consume 1 location\nconst _typeToLocationSize = {\n  // GLSL types\n  mat2: 2,\n  mat3: 3,\n  mat4: 4,\n  // WGSL types\n  mat2x2: 2,\n  mat3x3: 3,\n  mat4x4: 4\n};\n/**\n * @internal\n */\nexport class WebGPUShaderProcessingContext {\n  static get KnownUBOs() {\n    return WebGPUShaderProcessingContext._SimplifiedKnownBindings ? WebGPUShaderProcessingContext._SimplifiedKnownUBOs : WebGPUShaderProcessingContext._KnownUBOs;\n  }\n  constructor(shaderLanguage) {\n    this.shaderLanguage = shaderLanguage;\n    this._attributeNextLocation = 0;\n    this._varyingNextLocation = 0;\n    this.freeGroupIndex = 0;\n    this.freeBindingIndex = 0;\n    this.availableVaryings = {};\n    this.availableAttributes = {};\n    this.availableBuffers = {};\n    this.availableTextures = {};\n    this.availableSamplers = {};\n    this.orderedAttributes = [];\n    this.bindGroupLayoutEntries = [];\n    this.bindGroupLayoutEntryInfo = [];\n    this.bindGroupEntries = [];\n    this.bufferNames = [];\n    this.textureNames = [];\n    this.samplerNames = [];\n    this.leftOverUniforms = [];\n    this._findStartingGroupBinding();\n  }\n  _findStartingGroupBinding() {\n    const knownUBOs = WebGPUShaderProcessingContext.KnownUBOs;\n    const groups = [];\n    for (const name in knownUBOs) {\n      const binding = knownUBOs[name].binding;\n      if (binding.groupIndex === -1) {\n        continue;\n      }\n      if (groups[binding.groupIndex] === undefined) {\n        groups[binding.groupIndex] = binding.bindingIndex;\n      } else {\n        groups[binding.groupIndex] = Math.max(groups[binding.groupIndex], binding.bindingIndex);\n      }\n    }\n    this.freeGroupIndex = groups.length - 1;\n    if (this.freeGroupIndex === 0) {\n      this.freeGroupIndex++;\n      this.freeBindingIndex = 0;\n    } else {\n      this.freeBindingIndex = groups[groups.length - 1] + 1;\n    }\n  }\n  getAttributeNextLocation(dataType, arrayLength = 0) {\n    const index = this._attributeNextLocation;\n    this._attributeNextLocation += (_typeToLocationSize[dataType] ?? 1) * (arrayLength || 1);\n    return index;\n  }\n  getVaryingNextLocation(dataType, arrayLength = 0) {\n    const index = this._varyingNextLocation;\n    this._varyingNextLocation += (_typeToLocationSize[dataType] ?? 1) * (arrayLength || 1);\n    return index;\n  }\n  getNextFreeUBOBinding() {\n    return this._getNextFreeBinding(1);\n  }\n  _getNextFreeBinding(bindingCount) {\n    if (this.freeBindingIndex > _maxBindingsPerGroup - bindingCount) {\n      this.freeGroupIndex++;\n      this.freeBindingIndex = 0;\n    }\n    if (this.freeGroupIndex === _maxGroups) {\n      // eslint-disable-next-line no-throw-literal\n      throw \"Too many textures or UBOs have been declared and it is not supported in WebGPU.\";\n    }\n    const returnValue = {\n      groupIndex: this.freeGroupIndex,\n      bindingIndex: this.freeBindingIndex\n    };\n    this.freeBindingIndex += bindingCount;\n    return returnValue;\n  }\n}\n/** @internal */\nWebGPUShaderProcessingContext._SimplifiedKnownBindings = true; // if true, use only group=0,binding=0 as a known group/binding for the Scene ubo and use group=1,binding=X for all other bindings\n// if false, see _KnownUBOs for the known groups/bindings used\nWebGPUShaderProcessingContext._SimplifiedKnownUBOs = {\n  Scene: {\n    binding: {\n      groupIndex: 0,\n      bindingIndex: 0\n    }\n  },\n  Light0: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light1: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light2: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light3: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light4: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light5: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light6: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light7: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light8: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light9: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light10: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light11: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light12: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light13: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light14: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light15: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light16: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light17: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light18: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light19: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light20: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light21: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light22: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light23: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light24: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light25: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light26: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light27: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light28: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light29: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light30: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Light31: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Material: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Mesh: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  },\n  Internals: {\n    binding: {\n      groupIndex: -1,\n      bindingIndex: -1\n    }\n  }\n};\nWebGPUShaderProcessingContext._KnownUBOs = {\n  Scene: {\n    binding: {\n      groupIndex: 0,\n      bindingIndex: 0\n    }\n  },\n  Light0: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 0\n    }\n  },\n  Light1: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 1\n    }\n  },\n  Light2: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 2\n    }\n  },\n  Light3: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 3\n    }\n  },\n  Light4: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 4\n    }\n  },\n  Light5: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 5\n    }\n  },\n  Light6: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 6\n    }\n  },\n  Light7: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 7\n    }\n  },\n  Light8: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 8\n    }\n  },\n  Light9: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 9\n    }\n  },\n  Light10: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 10\n    }\n  },\n  Light11: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 11\n    }\n  },\n  Light12: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 12\n    }\n  },\n  Light13: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 13\n    }\n  },\n  Light14: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 14\n    }\n  },\n  Light15: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 15\n    }\n  },\n  Light16: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 16\n    }\n  },\n  Light17: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 17\n    }\n  },\n  Light18: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 18\n    }\n  },\n  Light19: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 19\n    }\n  },\n  Light20: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 20\n    }\n  },\n  Light21: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 21\n    }\n  },\n  Light22: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 22\n    }\n  },\n  Light23: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 23\n    }\n  },\n  Light24: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 24\n    }\n  },\n  Light25: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 25\n    }\n  },\n  Light26: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 26\n    }\n  },\n  Light27: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 27\n    }\n  },\n  Light28: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 28\n    }\n  },\n  Light29: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 29\n    }\n  },\n  Light30: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 30\n    }\n  },\n  Light31: {\n    binding: {\n      groupIndex: 1,\n      bindingIndex: 31\n    }\n  },\n  Material: {\n    binding: {\n      groupIndex: 2,\n      bindingIndex: 0\n    }\n  },\n  Mesh: {\n    binding: {\n      groupIndex: 2,\n      bindingIndex: 1\n    }\n  },\n  Internals: {\n    binding: {\n      groupIndex: 2,\n      bindingIndex: 2\n    }\n  }\n};\n//# sourceMappingURL=webgpuShaderProcessingContext.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}