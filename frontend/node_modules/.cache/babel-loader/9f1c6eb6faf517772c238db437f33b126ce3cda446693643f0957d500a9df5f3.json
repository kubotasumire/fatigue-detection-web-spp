{"ast":null,"code":"import { Logger } from \"../Misc/logger.js\";\nimport { Observable } from \"../Misc/observable.js\";\nimport { SceneComponentConstants } from \"../sceneComponent.js\";\nimport { Scene } from \"../scene.js\";\nimport { PhysicsEngine as PhysicsEngineV1 } from \"./v1/physicsEngine.js\";\nimport { PhysicsEngine as PhysicsEngineV2 } from \"./v2/physicsEngine.js\";\n/**\n * Gets the current physics engine\n * @returns a IPhysicsEngine or null if none attached\n */\nScene.prototype.getPhysicsEngine = function () {\n  return this._physicsEngine;\n};\n/**\n * Enables physics to the current scene\n * @param gravity defines the scene's gravity for the physics engine\n * @param plugin defines the physics engine to be used. defaults to CannonJS.\n * @returns a boolean indicating if the physics engine was initialized\n */\nScene.prototype.enablePhysics = function (gravity = null, plugin) {\n  if (this._physicsEngine) {\n    return true;\n  }\n  // Register the component to the scene\n  let component = this._getComponent(SceneComponentConstants.NAME_PHYSICSENGINE);\n  if (!component) {\n    component = new PhysicsEngineSceneComponent(this);\n    this._addComponent(component);\n  }\n  try {\n    if (!plugin || plugin?.getPluginVersion() === 1) {\n      this._physicsEngine = new PhysicsEngineV1(gravity, plugin);\n    } else if (plugin?.getPluginVersion() === 2) {\n      this._physicsEngine = new PhysicsEngineV2(gravity, plugin);\n    } else {\n      throw new Error(\"Unsupported Physics plugin version.\");\n    }\n    this._physicsTimeAccumulator = 0;\n    return true;\n  } catch (e) {\n    Logger.Error(e.message);\n    return false;\n  }\n};\n/**\n * Disables and disposes the physics engine associated with the scene\n */\nScene.prototype.disablePhysicsEngine = function () {\n  if (!this._physicsEngine) {\n    return;\n  }\n  this._physicsEngine.dispose();\n  this._physicsEngine = null;\n};\n/**\n * Gets a boolean indicating if there is an active physics engine\n * @returns a boolean indicating if there is an active physics engine\n */\nScene.prototype.isPhysicsEnabled = function () {\n  return this._physicsEngine !== undefined;\n};\n/**\n * Deletes a physics compound impostor\n * @param compound defines the compound to delete\n */\nScene.prototype.deleteCompoundImpostor = function (compound) {\n  const mesh = compound.parts[0].mesh;\n  if (mesh.physicsImpostor) {\n    mesh.physicsImpostor.dispose(/*true*/);\n    mesh.physicsImpostor = null;\n  }\n};\n/**\n * @internal\n */\nScene.prototype._advancePhysicsEngineStep = function (step) {\n  if (this._physicsEngine) {\n    const subTime = this._physicsEngine.getSubTimeStep();\n    if (subTime > 0) {\n      this._physicsTimeAccumulator += step;\n      while (this._physicsTimeAccumulator > subTime) {\n        this.onBeforePhysicsObservable.notifyObservers(this);\n        this._physicsEngine._step(subTime / 1000);\n        this.onAfterPhysicsObservable.notifyObservers(this);\n        this._physicsTimeAccumulator -= subTime;\n      }\n    } else {\n      this.onBeforePhysicsObservable.notifyObservers(this);\n      this._physicsEngine._step(step / 1000);\n      this.onAfterPhysicsObservable.notifyObservers(this);\n    }\n  }\n};\n/**\n * Defines the physics engine scene component responsible to manage a physics engine\n */\nexport class PhysicsEngineSceneComponent {\n  /**\n   * Creates a new instance of the component for the given scene\n   * @param scene Defines the scene to register the component in\n   */\n  constructor(scene) {\n    /**\n     * The component name helpful to identify the component in the list of scene components.\n     */\n    this.name = SceneComponentConstants.NAME_PHYSICSENGINE;\n    this.scene = scene;\n    this.scene.onBeforePhysicsObservable = new Observable();\n    this.scene.onAfterPhysicsObservable = new Observable();\n    // Replace the function used to get the deterministic frame time\n    this.scene.getDeterministicFrameTime = () => {\n      if (this.scene._physicsEngine) {\n        return this.scene._physicsEngine.getTimeStep() * 1000;\n      }\n      return 1000.0 / 60.0;\n    };\n  }\n  /**\n   * Registers the component in a given scene\n   */\n  register() {}\n  /**\n   * Rebuilds the elements related to this component in case of\n   * context lost for instance.\n   */\n  rebuild() {\n    // Nothing to do for this component\n  }\n  /**\n   * Disposes the component and the associated resources\n   */\n  dispose() {\n    this.scene.onBeforePhysicsObservable.clear();\n    this.scene.onAfterPhysicsObservable.clear();\n    if (this.scene._physicsEngine) {\n      this.scene.disablePhysicsEngine();\n    }\n  }\n}\n//# sourceMappingURL=joinedPhysicsEngineComponent.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}