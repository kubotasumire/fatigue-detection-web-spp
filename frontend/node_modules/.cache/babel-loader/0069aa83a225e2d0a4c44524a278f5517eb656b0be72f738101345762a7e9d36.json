{"ast":null,"code":"import { RawTexture } from \"../Textures/rawTexture.js\";\nimport { ShaderMaterial } from \"../shaderMaterial.js\";\nimport { Color3 } from \"../../Maths/math.color.js\";\nimport { Vector2 } from \"../../Maths/math.vector.js\";\nimport \"../../Shaders/greasedLine.fragment.js\";\nimport \"../../Shaders/greasedLine.vertex.js\";\nimport { GreasedLineMeshColorDistributionType, GreasedLineMeshColorMode } from \"./greasedLineMaterialInterfaces.js\";\nimport { GreasedLineTools } from \"../../Misc/greasedLineTools.js\";\nimport { GreasedLineMaterialDefaults } from \"./greasedLineMaterialDefaults.js\";\n/**\n * GreasedLineSimpleMaterial\n */\nexport class GreasedLineSimpleMaterial extends ShaderMaterial {\n  /**\n   * GreasedLineSimple material constructor\n   * @param name material name\n   * @param scene the scene\n   * @param options material options\n   */\n  constructor(name, scene, options) {\n    const defines = [`COLOR_DISTRIBUTION_TYPE_LINE ${GreasedLineMeshColorDistributionType.COLOR_DISTRIBUTION_TYPE_LINE}.`, `COLOR_DISTRIBUTION_TYPE_SEGMENT ${GreasedLineMeshColorDistributionType.COLOR_DISTRIBUTION_TYPE_SEGMENT}.`, `COLOR_MODE_SET ${GreasedLineMeshColorMode.COLOR_MODE_SET}.`, `COLOR_MODE_ADD ${GreasedLineMeshColorMode.COLOR_MODE_ADD}.`, `COLOR_MODE_MULTIPLY ${GreasedLineMeshColorMode.COLOR_MODE_MULTIPLY}.`];\n    const attributes = [\"position\", \"grl_widths\", \"grl_offsets\", \"grl_colorPointers\"];\n    scene.useRightHandedSystem && defines.push(\"GREASED_LINE_RIGHT_HANDED_COORDINATE_SYSTEM\");\n    if (options.cameraFacing) {\n      defines.push(\"GREASED_LINE_CAMERA_FACING\");\n      attributes.push(\"grl_previousAndSide\", \"grl_nextAndCounters\");\n    } else {\n      attributes.push(\"grl_slopes\");\n      attributes.push(\"grl_counters\");\n    }\n    super(name, scene, {\n      vertex: \"greasedLine\",\n      fragment: \"greasedLine\"\n    }, {\n      attributes,\n      uniforms: [\"world\", \"viewProjection\", \"view\", \"projection\", \"grlColorsWidth\", \"grlUseColors\", \"grlWidth\", \"grlColor\", \"grl_colorModeAndColorDistributionType\", \"grlResolution\", \"grlAspect\", \"grlAizeAttenuation\", \"grlDashArray\", \"grlDashOffset\", \"grlDashRatio\", \"grlUseDash\", \"grlVisibility\"],\n      samplers: [\"grlColors\"],\n      defines\n    });\n    this._color = Color3.White();\n    this._colorsDistributionType = GreasedLineMeshColorDistributionType.COLOR_DISTRIBUTION_TYPE_SEGMENT;\n    this._colorsTexture = null;\n    options = options || {\n      color: GreasedLineMaterialDefaults.DEFAULT_COLOR\n    };\n    const engine = scene.getEngine();\n    this.visibility = options.visibility ?? 1;\n    this.useDash = options.useDash ?? false;\n    this.dashRatio = options.dashRatio ?? 0.5;\n    this.dashOffset = options.dashOffset ?? 0;\n    this.dashCount = options.dashCount ?? 1; // calculate the _dashArray value, call the setter\n    this.width = options.width ? options.width : options.sizeAttenuation && options.cameraFacing ? GreasedLineMaterialDefaults.DEFAULT_WIDTH_ATTENUATED : GreasedLineMaterialDefaults.DEFAULT_WIDTH;\n    this.sizeAttenuation = options.sizeAttenuation ?? false;\n    this.color = options.color ?? Color3.White();\n    this.useColors = options.useColors ?? false;\n    this.colorsDistributionType = options.colorDistributionType ?? GreasedLineMeshColorDistributionType.COLOR_DISTRIBUTION_TYPE_SEGMENT;\n    this.colorsSampling = options.colorsSampling ?? RawTexture.NEAREST_NEAREST;\n    this.colorMode = options.colorMode ?? GreasedLineMeshColorMode.COLOR_MODE_SET;\n    this._colors = options.colors ?? null;\n    this._cameraFacing = options.cameraFacing ?? true;\n    this.resolution = options.resolution ?? new Vector2(engine.getRenderWidth(), engine.getRenderHeight()); // calculate aspect call the setter\n    if (options.colorsTexture) {\n      this.colorsTexture = options.colorsTexture;\n    } else {\n      this.colorsTexture = GreasedLineTools.PrepareEmptyColorsTexture(scene);\n    }\n    if (this._colors) {\n      this.setColors(this._colors);\n    }\n    engine.onDisposeObservable.add(() => {\n      GreasedLineTools.DisposeEmptyColorsTexture();\n    });\n  }\n  /**\n   * Disposes the plugin material.\n   */\n  dispose() {\n    this._colorsTexture?.dispose();\n    super.dispose();\n  }\n  _setColorModeAndColorDistributionType() {\n    this.setVector2(\"grl_colorModeAndColorDistributionType\", new Vector2(this._colorMode, this._colorsDistributionType));\n  }\n  /**\n   * Updates the material. Use when material created in lazy mode.\n   */\n  updateLazy() {\n    if (this._colors) {\n      this.setColors(this._colors, false, true);\n    }\n  }\n  /**\n   * Returns the colors used to colorize the line\n   */\n  get colors() {\n    return this._colors;\n  }\n  /**\n   * Sets the colors used to colorize the line\n   */\n  set colors(value) {\n    this.setColors(value);\n  }\n  /**\n   * Creates or updates the colors texture\n   * @param colors color table RGBA\n   * @param lazy if lazy, the colors are not updated\n   * @param forceNewTexture force creation of a new texture\n   */\n  setColors(colors, lazy = false, forceNewTexture = false) {\n    const origColorsCount = this._colors?.length ?? 0;\n    this._colors = colors;\n    if (colors === null || colors.length === 0) {\n      this._colorsTexture?.dispose();\n      return;\n    }\n    if (lazy && !forceNewTexture) {\n      return;\n    }\n    if (this._colorsTexture && origColorsCount === colors.length && !forceNewTexture) {\n      const colorArray = GreasedLineTools.Color3toRGBAUint8(colors);\n      this._colorsTexture.update(colorArray);\n    } else {\n      this._colorsTexture?.dispose();\n      this.colorsTexture = GreasedLineTools.CreateColorsTexture(`${this.name}-colors-texture`, colors, this.colorsSampling, this.getScene());\n    }\n  }\n  /**\n   * Gets the colors texture\n   */\n  get colorsTexture() {\n    return this._colorsTexture ?? null;\n  }\n  /**\n   * Sets the colorsTexture\n   */\n  set colorsTexture(value) {\n    this._colorsTexture = value;\n    this.setFloat(\"grlColorsWidth\", this._colorsTexture.getSize().width);\n    this.setTexture(\"grlColors\", this._colorsTexture);\n  }\n  /**\n   * Line base width. At each point the line width is calculated by widths[pointIndex] * width\n   */\n  get width() {\n    return this._width;\n  }\n  /**\n   * Line base width. At each point the line width is calculated by widths[pointIndex] * width\n   */\n  set width(value) {\n    this._width = value;\n    this.setFloat(\"grlWidth\", value);\n  }\n  /**\n   * Whether to use the colors option to colorize the line\n   */\n  get useColors() {\n    return this._useColors;\n  }\n  set useColors(value) {\n    this._useColors = value;\n    this.setFloat(\"grlUseColors\", GreasedLineTools.BooleanToNumber(value));\n  }\n  /**\n   * The type of sampling of the colors texture. The values are the same when using with textures.\n   */\n  get colorsSampling() {\n    return this._colorsSampling;\n  }\n  /**\n   * The type of sampling of the colors texture. The values are the same when using with textures.\n   */\n  set colorsSampling(value) {\n    this._colorsSampling = value;\n  }\n  /**\n   * Normalized value of how much of the line will be visible\n   * 0 - 0% of the line will be visible\n   * 1 - 100% of the line will be visible\n   */\n  get visibility() {\n    return this._visibility;\n  }\n  set visibility(value) {\n    this._visibility = value;\n    this.setFloat(\"grlVisibility\", value);\n  }\n  /**\n   * Turns on/off dash mode\n   */\n  get useDash() {\n    return this._useDash;\n  }\n  /**\n   * Turns on/off dash mode\n   */\n  set useDash(value) {\n    this._useDash = value;\n    this.setFloat(\"grlUseDash\", GreasedLineTools.BooleanToNumber(value));\n  }\n  /**\n   * Gets the dash offset\n   */\n  get dashOffset() {\n    return this._dashOffset;\n  }\n  /**\n   * Sets the dash offset\n   */\n  set dashOffset(value) {\n    this._dashOffset = value;\n    this.setFloat(\"grlDashOffset\", value);\n  }\n  /**\n   * Length of the dash. 0 to 1. 0.5 means half empty, half drawn.\n   */\n  get dashRatio() {\n    return this._dashRatio;\n  }\n  /**\n   * Length of the dash. 0 to 1. 0.5 means half empty, half drawn.\n   */\n  set dashRatio(value) {\n    this._dashRatio = value;\n    this.setFloat(\"grlDashRatio\", value);\n  }\n  /**\n   * Gets the number of dashes in the line\n   */\n  get dashCount() {\n    return this._dashCount;\n  }\n  /**\n   * Sets the number of dashes in the line\n   * @param value dash\n   */\n  set dashCount(value) {\n    this._dashCount = value;\n    this._dashArray = 1 / value;\n    this.setFloat(\"grlDashArray\", this._dashArray);\n  }\n  /**\n   * False means 1 unit in width = 1 unit on scene, true means 1 unit in width is reduced on the screen to make better looking lines\n   */\n  get sizeAttenuation() {\n    return this._sizeAttenuation;\n  }\n  /**\n   * Turn on/off attenuation of the width option and widths array.\n   * @param value false means 1 unit in width = 1 unit on scene, true means 1 unit in width is reduced on the screen to make better looking lines\n   */\n  set sizeAttenuation(value) {\n    this._sizeAttenuation = value;\n    this.setFloat(\"grlSizeAttenuation\", GreasedLineTools.BooleanToNumber(value));\n  }\n  /**\n   * Gets the color of the line\n   */\n  get color() {\n    return this.color;\n  }\n  /**\n   * Sets the color of the line\n   * @param value Color3\n   */\n  set color(value) {\n    this.setColor(value);\n  }\n  /**\n   * Sets the color of the line. If set the whole line will be mixed with this color according to the colorMode option.\n   * The simple material always needs a color to be set. If you set it to null it will set the color to the default color (GreasedLineSimpleMaterial.DEFAULT_COLOR).\n   * @param value color\n   */\n  setColor(value) {\n    value = value ?? GreasedLineMaterialDefaults.DEFAULT_COLOR;\n    this._color = value;\n    this.setColor3(\"grlColor\", value);\n  }\n  /**\n   * Gets the color distributiopn type\n   */\n  get colorsDistributionType() {\n    return this._colorsDistributionType;\n  }\n  /**\n   * Sets the color distribution type\n   * @see GreasedLineMeshColorDistributionType\n   * @param value color distribution type\n   */\n  set colorsDistributionType(value) {\n    this._colorsDistributionType = value;\n    this._setColorModeAndColorDistributionType();\n  }\n  /**\n   * Gets the mixing mode of the color and colors paramaters. Default value is GreasedLineMeshColorMode.SET.\n   * MATERIAL_TYPE_SIMPLE mixes the color and colors of the greased line material.\n   * @see GreasedLineMeshColorMode\n   */\n  get colorMode() {\n    return this._colorMode;\n  }\n  /**\n   * Sets the mixing mode of the color and colors paramaters. Default value is GreasedLineMeshColorMode.SET.\n   * MATERIAL_TYPE_SIMPLE mixes the color and colors of the greased line material.\n   * @see GreasedLineMeshColorMode\n   */\n  set colorMode(value) {\n    this._colorMode = value;\n    this._setColorModeAndColorDistributionType();\n  }\n  /**\n   * Gets the resolution\n   */\n  get resolution() {\n    return this._resolution;\n  }\n  /**\n   * Sets the resolution\n   * @param value resolution of the screen for GreasedLine\n   */\n  set resolution(value) {\n    this._resolution = value;\n    this.setVector2(\"grlResolution\", value);\n    this.setFloat(\"grlAspect\", value.x / value.y);\n  }\n  /**\n   * Serializes this plugin material\n   * @returns serializationObjec\n   */\n  serialize() {\n    const serializationObject = super.serialize();\n    const greasedLineMaterialOptions = {\n      colorDistributionType: this._colorsDistributionType,\n      colorsSampling: this._colorsSampling,\n      colorMode: this._colorMode,\n      color: this._color,\n      dashCount: this._dashCount,\n      dashOffset: this._dashOffset,\n      dashRatio: this._dashRatio,\n      resolution: this._resolution,\n      sizeAttenuation: this._sizeAttenuation,\n      useColors: this._useColors,\n      useDash: this._useDash,\n      visibility: this._visibility,\n      width: this._width,\n      cameraFacing: this._cameraFacing\n    };\n    this._colors && (greasedLineMaterialOptions.colors = this._colors);\n    serializationObject.greasedLineMaterialOptions = greasedLineMaterialOptions;\n    return serializationObject;\n  }\n  /**\n   * Parses a serialized objects\n   * @param source serialized object\n   * @param scene scene\n   * @param _rootUrl root url for textures\n   */\n  parse(source, scene, _rootUrl) {\n    // TODO: super.parse?\n    const greasedLineMaterialOptions = source.greasedLineMaterialOptions;\n    this._colorsTexture?.dispose();\n    greasedLineMaterialOptions.color && (this.color = greasedLineMaterialOptions.color);\n    greasedLineMaterialOptions.colorDistributionType && (this.colorsDistributionType = greasedLineMaterialOptions.colorDistributionType);\n    greasedLineMaterialOptions.colorsSampling && (this.colorsSampling = greasedLineMaterialOptions.colorsSampling);\n    greasedLineMaterialOptions.colorMode && (this.colorMode = greasedLineMaterialOptions.colorMode);\n    greasedLineMaterialOptions.useColors && (this.useColors = greasedLineMaterialOptions.useColors);\n    greasedLineMaterialOptions.visibility && (this.visibility = greasedLineMaterialOptions.visibility);\n    greasedLineMaterialOptions.useDash && (this.useDash = greasedLineMaterialOptions.useDash);\n    greasedLineMaterialOptions.dashCount && (this.dashCount = greasedLineMaterialOptions.dashCount);\n    greasedLineMaterialOptions.dashRatio && (this.dashRatio = greasedLineMaterialOptions.dashRatio);\n    greasedLineMaterialOptions.dashOffset && (this.dashOffset = greasedLineMaterialOptions.dashOffset);\n    greasedLineMaterialOptions.width && (this.width = greasedLineMaterialOptions.width);\n    greasedLineMaterialOptions.sizeAttenuation && (this.sizeAttenuation = greasedLineMaterialOptions.sizeAttenuation);\n    greasedLineMaterialOptions.resolution && (this.resolution = greasedLineMaterialOptions.resolution);\n    if (greasedLineMaterialOptions.colors) {\n      this.colorsTexture = GreasedLineTools.CreateColorsTexture(`${this.name}-colors-texture`, greasedLineMaterialOptions.colors, this.colorsSampling, this.getScene());\n    } else {\n      this.colorsTexture = GreasedLineTools.PrepareEmptyColorsTexture(scene);\n    }\n    this._cameraFacing = greasedLineMaterialOptions.cameraFacing ?? true;\n    this.setDefine(\"GREASED_LINE_CAMERA_FACING\", this._cameraFacing);\n  }\n}\n//# sourceMappingURL=greasedLineSimpleMaterial.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}