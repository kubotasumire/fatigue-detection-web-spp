{"ast":null,"code":"import { WebXRAbstractMotionController } from \"./webXRAbstractMotionController.js\";\nimport { WebXRMotionControllerManager } from \"./webXRMotionControllerManager.js\";\nimport { Mesh } from \"../../Meshes/mesh.js\";\nimport { Quaternion } from \"../../Maths/math.vector.js\";\n/**\n * The motion controller class for oculus touch (quest, rift).\n * This class supports legacy mapping as well the standard xr mapping\n */\nexport class WebXROculusTouchMotionController extends WebXRAbstractMotionController {\n  constructor(scene, gamepadObject, handedness, _legacyMapping = false, _forceLegacyControllers = false) {\n    super(scene, OculusTouchLayouts[handedness], gamepadObject, handedness);\n    this._forceLegacyControllers = _forceLegacyControllers;\n    this.profileId = \"oculus-touch\";\n  }\n  _getFilenameAndPath() {\n    let filename = \"\";\n    if (this.handedness === \"left\") {\n      filename = WebXROculusTouchMotionController.MODEL_LEFT_FILENAME;\n    } else {\n      // Right is the default if no hand is specified\n      filename = WebXROculusTouchMotionController.MODEL_RIGHT_FILENAME;\n    }\n    const path = this._isQuest() ? WebXROculusTouchMotionController.QUEST_MODEL_BASE_URL : WebXROculusTouchMotionController.MODEL_BASE_URL;\n    return {\n      filename,\n      path\n    };\n  }\n  _getModelLoadingConstraints() {\n    return true;\n  }\n  _processLoadedModel(_meshes) {\n    const isQuest = this._isQuest();\n    const triggerDirection = this.handedness === \"right\" ? -1 : 1;\n    this.getComponentIds().forEach(id => {\n      const comp = id && this.getComponent(id);\n      if (comp) {\n        comp.onButtonStateChangedObservable.add(component => {\n          if (!this.rootMesh || this.disableAnimation) {\n            return;\n          }\n          switch (id) {\n            case \"xr-standard-trigger\":\n              // index trigger\n              if (!isQuest) {\n                this._modelRootNode.getChildren()[3].rotation.x = -component.value * 0.2;\n                this._modelRootNode.getChildren()[3].position.y = -component.value * 0.005;\n                this._modelRootNode.getChildren()[3].position.z = -component.value * 0.005;\n              }\n              return;\n            case \"xr-standard-squeeze\":\n              // secondary trigger\n              if (!isQuest) {\n                this._modelRootNode.getChildren()[4].position.x = triggerDirection * component.value * 0.0035;\n              }\n              return;\n            case \"xr-standard-thumbstick\":\n              // thumbstick\n              return;\n            case \"a-button\":\n            case \"x-button\":\n              if (!isQuest) {\n                if (component.pressed) {\n                  this._modelRootNode.getChildren()[1].position.y = -0.001;\n                } else {\n                  this._modelRootNode.getChildren()[1].position.y = 0;\n                }\n              }\n              return;\n            case \"b-button\":\n            case \"y-button\":\n              if (!isQuest) {\n                if (component.pressed) {\n                  this._modelRootNode.getChildren()[2].position.y = -0.001;\n                } else {\n                  this._modelRootNode.getChildren()[2].position.y = 0;\n                }\n              }\n              return;\n          }\n        }, undefined, true);\n      }\n    });\n  }\n  _setRootMesh(meshes) {\n    this.rootMesh = new Mesh(this.profileId + \" \" + this.handedness, this.scene);\n    if (!this.scene.useRightHandedSystem) {\n      this.rootMesh.rotationQuaternion = Quaternion.FromEulerAngles(0, Math.PI, 0);\n    }\n    meshes.forEach(mesh => {\n      mesh.isPickable = false;\n    });\n    if (this._isQuest()) {\n      this._modelRootNode = meshes[0];\n    } else {\n      this._modelRootNode = meshes[1];\n      this.rootMesh.position.y = 0.034;\n      this.rootMesh.position.z = 0.052;\n    }\n    this._modelRootNode.parent = this.rootMesh;\n  }\n  _updateModel() {\n    // no-op. model is updated using observables.\n  }\n  /**\n   * Is this the new type of oculus touch. At the moment both have the same profile and it is impossible to differentiate\n   * between the touch and touch 2.\n   * @returns true if this is the new type of oculus touch controllers.\n   */\n  _isQuest() {\n    // this is SADLY the only way to currently check. Until proper profiles will be available.\n    return !!navigator.userAgent.match(/Quest/gi) && !this._forceLegacyControllers;\n  }\n}\n/**\n * The base url used to load the left and right controller models\n */\nWebXROculusTouchMotionController.MODEL_BASE_URL = \"https://controllers.babylonjs.com/oculus/\";\n/**\n * The name of the left controller model file\n */\nWebXROculusTouchMotionController.MODEL_LEFT_FILENAME = \"left.babylon\";\n/**\n * The name of the right controller model file\n */\nWebXROculusTouchMotionController.MODEL_RIGHT_FILENAME = \"right.babylon\";\n/**\n * Base Url for the Quest controller model.\n */\nWebXROculusTouchMotionController.QUEST_MODEL_BASE_URL = \"https://controllers.babylonjs.com/oculusQuest/\";\n// register the profile\nWebXRMotionControllerManager.RegisterController(\"oculus-touch\", (xrInput, scene) => {\n  return new WebXROculusTouchMotionController(scene, xrInput.gamepad, xrInput.handedness);\n});\nWebXRMotionControllerManager.RegisterController(\"oculus-touch-legacy\", (xrInput, scene) => {\n  return new WebXROculusTouchMotionController(scene, xrInput.gamepad, xrInput.handedness, true);\n});\nconst OculusTouchLayouts = {\n  left: {\n    selectComponentId: \"xr-standard-trigger\",\n    components: {\n      \"xr-standard-trigger\": {\n        type: \"trigger\",\n        gamepadIndices: {\n          button: 0\n        },\n        rootNodeName: \"xr_standard_trigger\",\n        visualResponses: {}\n      },\n      \"xr-standard-squeeze\": {\n        type: \"squeeze\",\n        gamepadIndices: {\n          button: 1\n        },\n        rootNodeName: \"xr_standard_squeeze\",\n        visualResponses: {}\n      },\n      \"xr-standard-thumbstick\": {\n        type: \"thumbstick\",\n        gamepadIndices: {\n          button: 3,\n          xAxis: 2,\n          yAxis: 3\n        },\n        rootNodeName: \"xr_standard_thumbstick\",\n        visualResponses: {}\n      },\n      \"x-button\": {\n        type: \"button\",\n        gamepadIndices: {\n          button: 4\n        },\n        rootNodeName: \"x_button\",\n        visualResponses: {}\n      },\n      \"y-button\": {\n        type: \"button\",\n        gamepadIndices: {\n          button: 5\n        },\n        rootNodeName: \"y_button\",\n        visualResponses: {}\n      },\n      thumbrest: {\n        type: \"button\",\n        gamepadIndices: {\n          button: 6\n        },\n        rootNodeName: \"thumbrest\",\n        visualResponses: {}\n      }\n    },\n    gamepadMapping: \"xr-standard\",\n    rootNodeName: \"oculus-touch-v2-left\",\n    assetPath: \"left.glb\"\n  },\n  right: {\n    selectComponentId: \"xr-standard-trigger\",\n    components: {\n      \"xr-standard-trigger\": {\n        type: \"trigger\",\n        gamepadIndices: {\n          button: 0\n        },\n        rootNodeName: \"xr_standard_trigger\",\n        visualResponses: {}\n      },\n      \"xr-standard-squeeze\": {\n        type: \"squeeze\",\n        gamepadIndices: {\n          button: 1\n        },\n        rootNodeName: \"xr_standard_squeeze\",\n        visualResponses: {}\n      },\n      \"xr-standard-thumbstick\": {\n        type: \"thumbstick\",\n        gamepadIndices: {\n          button: 3,\n          xAxis: 2,\n          yAxis: 3\n        },\n        rootNodeName: \"xr_standard_thumbstick\",\n        visualResponses: {}\n      },\n      \"a-button\": {\n        type: \"button\",\n        gamepadIndices: {\n          button: 4\n        },\n        rootNodeName: \"a_button\",\n        visualResponses: {}\n      },\n      \"b-button\": {\n        type: \"button\",\n        gamepadIndices: {\n          button: 5\n        },\n        rootNodeName: \"b_button\",\n        visualResponses: {}\n      },\n      thumbrest: {\n        type: \"button\",\n        gamepadIndices: {\n          button: 6\n        },\n        rootNodeName: \"thumbrest\",\n        visualResponses: {}\n      }\n    },\n    gamepadMapping: \"xr-standard\",\n    rootNodeName: \"oculus-touch-v2-right\",\n    assetPath: \"right.glb\"\n  }\n};\n//# sourceMappingURL=webXROculusTouchMotionController.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}