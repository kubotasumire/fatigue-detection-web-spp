{"ast":null,"code":"import { NodeMaterialBlock } from \"../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialBlockTargets } from \"../Enums/nodeMaterialBlockTargets.js\";\nimport { RegisterClass } from \"../../../Misc/typeStore.js\";\n/**\n * Types of curves supported by the Curve block\n */\nexport var CurveBlockTypes;\n(function (CurveBlockTypes) {\n  /** EaseInSine */\n  CurveBlockTypes[CurveBlockTypes[\"EaseInSine\"] = 0] = \"EaseInSine\";\n  /** EaseOutSine */\n  CurveBlockTypes[CurveBlockTypes[\"EaseOutSine\"] = 1] = \"EaseOutSine\";\n  /** EaseInOutSine */\n  CurveBlockTypes[CurveBlockTypes[\"EaseInOutSine\"] = 2] = \"EaseInOutSine\";\n  /** EaseInQuad */\n  CurveBlockTypes[CurveBlockTypes[\"EaseInQuad\"] = 3] = \"EaseInQuad\";\n  /** EaseOutQuad */\n  CurveBlockTypes[CurveBlockTypes[\"EaseOutQuad\"] = 4] = \"EaseOutQuad\";\n  /** EaseInOutQuad */\n  CurveBlockTypes[CurveBlockTypes[\"EaseInOutQuad\"] = 5] = \"EaseInOutQuad\";\n  /** EaseInCubic */\n  CurveBlockTypes[CurveBlockTypes[\"EaseInCubic\"] = 6] = \"EaseInCubic\";\n  /** EaseOutCubic */\n  CurveBlockTypes[CurveBlockTypes[\"EaseOutCubic\"] = 7] = \"EaseOutCubic\";\n  /** EaseInOutCubic */\n  CurveBlockTypes[CurveBlockTypes[\"EaseInOutCubic\"] = 8] = \"EaseInOutCubic\";\n  /** EaseInQuart */\n  CurveBlockTypes[CurveBlockTypes[\"EaseInQuart\"] = 9] = \"EaseInQuart\";\n  /** EaseOutQuart */\n  CurveBlockTypes[CurveBlockTypes[\"EaseOutQuart\"] = 10] = \"EaseOutQuart\";\n  /** EaseInOutQuart */\n  CurveBlockTypes[CurveBlockTypes[\"EaseInOutQuart\"] = 11] = \"EaseInOutQuart\";\n  /** EaseInQuint */\n  CurveBlockTypes[CurveBlockTypes[\"EaseInQuint\"] = 12] = \"EaseInQuint\";\n  /** EaseOutQuint */\n  CurveBlockTypes[CurveBlockTypes[\"EaseOutQuint\"] = 13] = \"EaseOutQuint\";\n  /** EaseInOutQuint */\n  CurveBlockTypes[CurveBlockTypes[\"EaseInOutQuint\"] = 14] = \"EaseInOutQuint\";\n  /** EaseInExpo */\n  CurveBlockTypes[CurveBlockTypes[\"EaseInExpo\"] = 15] = \"EaseInExpo\";\n  /** EaseOutExpo */\n  CurveBlockTypes[CurveBlockTypes[\"EaseOutExpo\"] = 16] = \"EaseOutExpo\";\n  /** EaseInOutExpo */\n  CurveBlockTypes[CurveBlockTypes[\"EaseInOutExpo\"] = 17] = \"EaseInOutExpo\";\n  /** EaseInCirc */\n  CurveBlockTypes[CurveBlockTypes[\"EaseInCirc\"] = 18] = \"EaseInCirc\";\n  /** EaseOutCirc */\n  CurveBlockTypes[CurveBlockTypes[\"EaseOutCirc\"] = 19] = \"EaseOutCirc\";\n  /** EaseInOutCirc */\n  CurveBlockTypes[CurveBlockTypes[\"EaseInOutCirc\"] = 20] = \"EaseInOutCirc\";\n  /** EaseInBack */\n  CurveBlockTypes[CurveBlockTypes[\"EaseInBack\"] = 21] = \"EaseInBack\";\n  /** EaseOutBack */\n  CurveBlockTypes[CurveBlockTypes[\"EaseOutBack\"] = 22] = \"EaseOutBack\";\n  /** EaseInOutBack */\n  CurveBlockTypes[CurveBlockTypes[\"EaseInOutBack\"] = 23] = \"EaseInOutBack\";\n  /** EaseInElastic */\n  CurveBlockTypes[CurveBlockTypes[\"EaseInElastic\"] = 24] = \"EaseInElastic\";\n  /** EaseOutElastic */\n  CurveBlockTypes[CurveBlockTypes[\"EaseOutElastic\"] = 25] = \"EaseOutElastic\";\n  /** EaseInOutElastic */\n  CurveBlockTypes[CurveBlockTypes[\"EaseInOutElastic\"] = 26] = \"EaseInOutElastic\";\n})(CurveBlockTypes || (CurveBlockTypes = {}));\n/**\n * Block used to apply curve operation\n */\nexport class CurveBlock extends NodeMaterialBlock {\n  /**\n   * Creates a new CurveBlock\n   * @param name defines the block name\n   */\n  constructor(name) {\n    super(name, NodeMaterialBlockTargets.Neutral);\n    /**\n     * Gets or sets the type of the curve applied by the block\n     */\n    this.type = CurveBlockTypes.EaseInOutSine;\n    this.registerInput(\"input\", NodeMaterialBlockConnectionPointTypes.AutoDetect);\n    this.registerOutput(\"output\", NodeMaterialBlockConnectionPointTypes.BasedOnInput);\n    this._outputs[0]._typeConnectionSource = this._inputs[0];\n    this._inputs[0].excludedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Matrix);\n    this._inputs[0].excludedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Object);\n    this._inputs[0].excludedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Int);\n  }\n  /**\n   * Gets the current class name\n   * @returns the class name\n   */\n  getClassName() {\n    return \"CurveBlock\";\n  }\n  /**\n   * Gets the input component\n   */\n  get input() {\n    return this._inputs[0];\n  }\n  /**\n   * Gets the output component\n   */\n  get output() {\n    return this._outputs[0];\n  }\n  _duplicateEntry(entry, component) {\n    return `ret.${component} = ${entry.replace(/VAL/g, \"v.\" + component)}`;\n  }\n  _duplicateEntryDirect(entry) {\n    return `return ${entry.replace(/VAL/g, \"v\")}`;\n  }\n  _duplicateVector(entry, inputType) {\n    if (inputType === \"float\") {\n      return this._duplicateEntryDirect(entry);\n    }\n    const size = parseInt(inputType.replace(\"vec\", \"\"));\n    let code = `\n            vec${size} ret = vec${size}(0.0);\n        `;\n    for (let i = 1; i <= size; i++) {\n      code += this._duplicateEntry(entry, i === 1 ? \"x\" : i === 2 ? \"y\" : i === 3 ? \"z\" : \"w\") + \";\\n\";\n    }\n    code += \"return ret;\\n\";\n    return code;\n  }\n  _buildBlock(state) {\n    super._buildBlock(state);\n    const output = this._outputs[0];\n    let registeredFunction = \"\";\n    let registeredFunctionName = \"\";\n    let inputType = \"\";\n    switch (this.input.type) {\n      case NodeMaterialBlockConnectionPointTypes.Float:\n        inputType = \"float\";\n        break;\n      case NodeMaterialBlockConnectionPointTypes.Vector2:\n        inputType = \"vec2\";\n        break;\n      case NodeMaterialBlockConnectionPointTypes.Vector3:\n      case NodeMaterialBlockConnectionPointTypes.Color3:\n        inputType = \"vec3\";\n        break;\n      case NodeMaterialBlockConnectionPointTypes.Vector4:\n      case NodeMaterialBlockConnectionPointTypes.Color4:\n        inputType = \"vec4\";\n        break;\n    }\n    registeredFunctionName = CurveBlockTypes[this.type] + \"_\" + inputType;\n    switch (this.type) {\n      case CurveBlockTypes.EaseInSine:\n        registeredFunction = `return 1.0 - cos((v * 3.1415) / 2.0)`;\n        break;\n      case CurveBlockTypes.EaseOutSine:\n        registeredFunction = `return sin((v * 3.1415) / 2.0)`;\n        break;\n      case CurveBlockTypes.EaseInOutSine:\n        registeredFunction = `return -(cos(v * 3.1415) - 1.0) / 2.0`;\n        break;\n      case CurveBlockTypes.EaseInQuad:\n        registeredFunction = `return v * v`;\n        break;\n      case CurveBlockTypes.EaseOutQuad:\n        registeredFunction = `return (1.0 - v) * (1.0 - v)`;\n        break;\n      case CurveBlockTypes.EaseInOutQuad:\n        {\n          const entry = \"VAL < 0.5 ? 2.0 * VAL * VAL : 1.0 - pow(-2.0 * VAL + 2.0, 2.0) / 2.0\";\n          registeredFunction = this._duplicateVector(entry, inputType);\n          break;\n        }\n      case CurveBlockTypes.EaseInCubic:\n        registeredFunction = `return v * v * v`;\n        break;\n      case CurveBlockTypes.EaseOutCubic:\n        {\n          const entry = \"1.0 - pow(1.0 - VAL, 3.0)\";\n          registeredFunction = this._duplicateVector(entry, inputType);\n          break;\n        }\n      case CurveBlockTypes.EaseInOutCubic:\n        {\n          const entry = \"VAL < 0.5 ? 4.0 * VAL * VAL * VAL : 1.0 - pow(-2.0 * VAL + 2.0, 3.0) / 2.0\";\n          registeredFunction = this._duplicateVector(entry, inputType);\n          break;\n        }\n      case CurveBlockTypes.EaseInQuart:\n        registeredFunction = `return v * v * v * v`;\n        break;\n      case CurveBlockTypes.EaseOutQuart:\n        {\n          const entry = \"1.0 - pow(1.0 - VAL, 4.0)\";\n          registeredFunction = this._duplicateVector(entry, inputType);\n          break;\n        }\n      case CurveBlockTypes.EaseInOutQuart:\n        {\n          const entry = \"VAL < 0.5 ? 8.0 * VAL * VAL * VAL * VAL : 1.0 - pow(-2.0 * VAL + 2.0, 4.0) / 2.0\";\n          registeredFunction = this._duplicateVector(entry, inputType);\n          break;\n        }\n      case CurveBlockTypes.EaseInQuint:\n        registeredFunction = `return v * v * v * v * v`;\n        break;\n      case CurveBlockTypes.EaseOutQuint:\n        {\n          const entry = \"1.0 - pow(1.0 - VAL, 5.0)\";\n          registeredFunction = this._duplicateVector(entry, inputType);\n          break;\n        }\n      case CurveBlockTypes.EaseInOutQuint:\n        {\n          const entry = \"VAL < 0.5 ? 16.0 * VAL * VAL * VAL * VAL * VAL : 1.0 - pow(-2.0 * VAL + 2.0, 5.0) / 2.0\";\n          registeredFunction = this._duplicateVector(entry, inputType);\n          break;\n        }\n      case CurveBlockTypes.EaseInExpo:\n        {\n          const entry = \"VAL == 0.0 ? 0.0 : pow(2.0, 10.0 * VAL - 10.0)\";\n          registeredFunction = this._duplicateVector(entry, inputType);\n          break;\n        }\n      case CurveBlockTypes.EaseOutExpo:\n        {\n          const entry = \"VAL == 1.0 ? 1.0 : 1.0 - pow(2.0, -10.0 * VAL)\";\n          registeredFunction = this._duplicateVector(entry, inputType);\n          break;\n        }\n      case CurveBlockTypes.EaseInOutExpo:\n        {\n          const entry = \"VAL == 0.0 ? 0.0 : VAL == 1.0 ? 1.0 : VAL < 0.5 ? pow(2.0, 20.0 * VAL - 10.0) / 2.0 : (2.0 - pow(2.0, -20.0 * VAL + 10.0)) / 2.0\";\n          registeredFunction = this._duplicateVector(entry, inputType);\n          break;\n        }\n      case CurveBlockTypes.EaseInCirc:\n        {\n          const entry = \"1.0 - sqrt(1.0 - pow(VAL, 2.0))\";\n          registeredFunction = this._duplicateVector(entry, inputType);\n          break;\n        }\n      case CurveBlockTypes.EaseOutCirc:\n        {\n          const entry = \"sqrt(1.0 - pow(VAL - 1.0, 2.0))\";\n          registeredFunction = this._duplicateVector(entry, inputType);\n          break;\n        }\n      case CurveBlockTypes.EaseInOutCirc:\n        {\n          const entry = \"VAL < 0.5 ? (1.0 - sqrt(1.0 - pow(2.0 * VAL, 2.0))) / 2.0 : (sqrt(1.0 - pow(-2.0 * VAL + 2.0, 2.0)) + 1.0) / 2.0\";\n          registeredFunction = this._duplicateVector(entry, inputType);\n          break;\n        }\n      case CurveBlockTypes.EaseInBack:\n        {\n          registeredFunction = \"return 2.70158 * v * v * v - 1.70158 * v * v\";\n          break;\n        }\n      case CurveBlockTypes.EaseOutBack:\n        {\n          const entry = \"2.70158 * pow(VAL - 1.0, 3.0) + 1.70158 * pow(VAL - 1.0, 2.0)\";\n          registeredFunction = this._duplicateVector(entry, inputType);\n          break;\n        }\n      case CurveBlockTypes.EaseInOutBack:\n        {\n          const entry = \"VAL < 0.5 ? (pow(2.0 * VAL, 2.0) * ((3.5949095) * 2.0 * VAL - 2.5949095)) / 2.0 : (pow(2.0 * VAL - 2.0, 2.0) * (3.5949095 * (VAL * 2.0 - 2.0) + 3.5949095) + 2.0) / 2.0\";\n          registeredFunction = this._duplicateVector(entry, inputType);\n          break;\n        }\n      case CurveBlockTypes.EaseInElastic:\n        {\n          const entry = \"VAL == 0.0 ? 0.0 : VAL == 1.0 ? 1.0 : -pow(2.0, 10.0 * VAL - 10.0) * sin((VAL * 10.0 - 10.75) * ((2.0 * 3.1415) / 3.0))\";\n          registeredFunction = this._duplicateVector(entry, inputType);\n          break;\n        }\n      case CurveBlockTypes.EaseOutElastic:\n        {\n          const entry = \"VAL == 0.0 ? 0.0 : VAL == 1.0 ? 1.0 : pow(2.0, -10.0 * VAL) * sin((VAL * 10.0 - 0.75) * ((2.0 * 3.1415) / 3.0)) + 1.0\";\n          registeredFunction = this._duplicateVector(entry, inputType);\n          break;\n        }\n      case CurveBlockTypes.EaseInOutElastic:\n        {\n          const entry = \"VAL == 0.0 ? 0.0 : VAL == 1.0 ? 1.0 : VAL < 0.5 ? -(pow(2.0, 20.0 * VAL - 10.0) * sin((20.0 * VAL - 11.125) * ((2.0 * 3.1415) / 4.5))) / 2.0 : (pow(2.0, -20.0 * VAL + 10.0) * sin((20.0 * VAL - 11.125) * ((2.0 * 3.1415) / 4.5))) / 2.0 + 1.0\";\n          registeredFunction = this._duplicateVector(entry, inputType);\n          break;\n        }\n    }\n    state._emitFunction(registeredFunctionName, `${inputType} ${registeredFunctionName}(${inputType} v) {${registeredFunction};}\\n`, \"\");\n    state.compilationString += this._declareOutput(output, state) + ` = ${registeredFunctionName}(${this.input.associatedVariableName});\\n`;\n    return this;\n  }\n  serialize() {\n    const serializationObject = super.serialize();\n    serializationObject.curveType = this.type;\n    return serializationObject;\n  }\n  _deserialize(serializationObject, scene, rootUrl) {\n    super._deserialize(serializationObject, scene, rootUrl);\n    this.type = serializationObject.curveType;\n  }\n  _dumpPropertiesCode() {\n    const codeString = super._dumpPropertiesCode() + `${this._codeVariableName}.type = BABYLON.CurveBlockTypes.${CurveBlockTypes[this.type]};\\n`;\n    return codeString;\n  }\n}\nRegisterClass(\"BABYLON.CurveBlock\", CurveBlock);\n//# sourceMappingURL=curveBlock.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}