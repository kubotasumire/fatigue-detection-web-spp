{"ast":null,"code":"import { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialConnectionPointDirection } from \"../../nodeMaterialBlockConnectionPoint.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\nimport { NodeMaterialConnectionPointCustomObject } from \"../../nodeMaterialConnectionPointCustomObject.js\";\nimport { ImageSourceBlock } from \"../Dual/imageSourceBlock.js\";\n/**\n * Block used to read from prepass textures\n */\nexport class PrePassTextureBlock extends NodeMaterialBlock {\n  /**\n   * The texture associated with the node is the prepass texture\n   */\n  get texture() {\n    return null;\n  }\n  set texture(value) {\n    return;\n  }\n  /**\n   * Creates a new PrePassTextureBlock\n   * @param name defines the block name\n   * @param target defines the target of that block (VertexAndFragment by default)\n   */\n  constructor(name, target = NodeMaterialBlockTargets.VertexAndFragment) {\n    super(name, target, false);\n    this.registerOutput(\"position\", NodeMaterialBlockConnectionPointTypes.Object, NodeMaterialBlockTargets.VertexAndFragment, new NodeMaterialConnectionPointCustomObject(\"position\", this, NodeMaterialConnectionPointDirection.Output, ImageSourceBlock, \"ImageSourceBlock\"));\n    this.registerOutput(\"depth\", NodeMaterialBlockConnectionPointTypes.Object, NodeMaterialBlockTargets.VertexAndFragment, new NodeMaterialConnectionPointCustomObject(\"depth\", this, NodeMaterialConnectionPointDirection.Output, ImageSourceBlock, \"ImageSourceBlock\"));\n    this.registerOutput(\"normal\", NodeMaterialBlockConnectionPointTypes.Object, NodeMaterialBlockTargets.VertexAndFragment, new NodeMaterialConnectionPointCustomObject(\"normal\", this, NodeMaterialConnectionPointDirection.Output, ImageSourceBlock, \"ImageSourceBlock\"));\n  }\n  /**\n   * Returns the sampler name associated with the node connection point\n   * @param output defines the connection point to get the associated sampler name\n   * @returns\n   */\n  getSamplerName(output) {\n    if (output === this._outputs[0]) {\n      return this._positionSamplerName;\n    }\n    if (output === this._outputs[1]) {\n      return this._depthSamplerName;\n    }\n    if (output === this._outputs[2]) {\n      return this._normalSamplerName;\n    }\n    return \"\";\n  }\n  /**\n   * Gets the position texture\n   */\n  get position() {\n    return this._outputs[0];\n  }\n  /**\n   * Gets the depth texture\n   */\n  get depth() {\n    return this._outputs[1];\n  }\n  /**\n   * Gets the normal texture\n   */\n  get normal() {\n    return this._outputs[2];\n  }\n  /**\n   * Gets the sampler name associated with this image source\n   */\n  get positionSamplerName() {\n    return this._positionSamplerName;\n  }\n  /**\n   * Gets the sampler name associated with this image source\n   */\n  get normalSamplerName() {\n    return this._normalSamplerName;\n  }\n  /**\n   * Gets the sampler name associated with this image source\n   */\n  get depthSamplerName() {\n    return this._depthSamplerName;\n  }\n  /**\n   * Gets the current class name\n   * @returns the class name\n   */\n  getClassName() {\n    return \"PrePassTextureBlock\";\n  }\n  _buildBlock(state) {\n    super._buildBlock(state);\n    if (state.target === NodeMaterialBlockTargets.Vertex) {\n      return;\n    }\n    this._positionSamplerName = \"prepassPositionSampler\";\n    this._depthSamplerName = \"prepassDepthSampler\";\n    this._normalSamplerName = \"prepassNormalSampler\";\n    // Unique sampler names for every prepasstexture block\n    state.sharedData.variableNames.prepassPositionSampler = 0;\n    state.sharedData.variableNames.prepassDepthSampler = 0;\n    state.sharedData.variableNames.prepassNormalSampler = 0;\n    // Declarations\n    state.sharedData.textureBlocks.push(this);\n    state.sharedData.bindableBlocks.push(this);\n    state._emit2DSampler(this._positionSamplerName);\n    state._emit2DSampler(this._depthSamplerName);\n    state._emit2DSampler(this._normalSamplerName);\n    return this;\n  }\n  bind(effect, nodeMaterial) {\n    const scene = nodeMaterial.getScene();\n    const prePassRenderer = scene.enablePrePassRenderer();\n    if (!prePassRenderer) {\n      return;\n    }\n    const sceneRT = prePassRenderer.defaultRT;\n    if (!sceneRT.textures) {\n      return;\n    }\n    if (this.position.isConnected) {\n      effect.setTexture(this._positionSamplerName, sceneRT.textures[prePassRenderer.getIndex(1)]);\n    }\n    if (this.depth.isConnected) {\n      effect.setTexture(this._depthSamplerName, sceneRT.textures[prePassRenderer.getIndex(5)]);\n    }\n    if (this.normal.isConnected) {\n      effect.setTexture(this._normalSamplerName, sceneRT.textures[prePassRenderer.getIndex(6)]);\n    }\n  }\n}\nRegisterClass(\"BABYLON.PrePassTextureBlock\", PrePassTextureBlock);\n//# sourceMappingURL=prePassTextureBlock.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}