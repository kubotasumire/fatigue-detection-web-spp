{"ast":null,"code":"import { MultiRenderTarget } from \"./multiRenderTarget.js\";\nimport { ImageProcessingPostProcess } from \"../../PostProcesses/imageProcessingPostProcess.js\";\n/**\n * A multi render target designed to render the prepass.\n * Prepass is a scene component used to render information in multiple textures\n * alongside with the scene materials rendering.\n * Note : This is an internal class, and you should NOT need to instanciate this.\n * Only the `PrePassRenderer` should instanciate this class.\n * It is more likely that you need a regular `MultiRenderTarget`\n * @internal\n */\nexport class PrePassRenderTarget extends MultiRenderTarget {\n  constructor(name, renderTargetTexture, size, count, scene, options) {\n    super(name, size, count, scene, options);\n    /**\n     * @internal\n     */\n    this._beforeCompositionPostProcesses = [];\n    /**\n     * @internal\n     */\n    this._internalTextureDirty = false;\n    /**\n     * Is this render target enabled for prepass rendering\n     */\n    this.enabled = false;\n    /**\n     * Render target associated with this prePassRenderTarget\n     * If this is `null`, it means this prePassRenderTarget is associated with the scene\n     */\n    this.renderTargetTexture = null;\n    this.renderTargetTexture = renderTargetTexture;\n  }\n  /**\n   * Creates a composition effect for this RT\n   * @internal\n   */\n  _createCompositionEffect() {\n    this.imageProcessingPostProcess = new ImageProcessingPostProcess(\"prePassComposition\", 1, null, undefined, this._engine);\n    this.imageProcessingPostProcess._updateParameters();\n  }\n  /**\n   * Checks that the size of this RT is still adapted to the desired render size.\n   * @internal\n   */\n  _checkSize() {\n    const requiredWidth = this._engine.getRenderWidth(true);\n    const requiredHeight = this._engine.getRenderHeight(true);\n    const width = this.getRenderWidth();\n    const height = this.getRenderHeight();\n    if (width !== requiredWidth || height !== requiredHeight) {\n      this.resize({\n        width: requiredWidth,\n        height: requiredHeight\n      });\n      this._internalTextureDirty = true;\n    }\n  }\n  /**\n   * Changes the number of render targets in this MRT\n   * Be careful as it will recreate all the data in the new texture.\n   * @param count new texture count\n   * @param options Specifies texture types and sampling modes for new textures\n   * @param textureNames Specifies the names of the textures (optional)\n   */\n  updateCount(count, options, textureNames) {\n    super.updateCount(count, options, textureNames);\n    this._internalTextureDirty = true;\n  }\n  /**\n   * Resets the post processes chains applied to this RT.\n   * @internal\n   */\n  _resetPostProcessChain() {\n    this._beforeCompositionPostProcesses.length = 0;\n  }\n  /**\n   * Diposes this render target\n   */\n  dispose() {\n    const scene = this._scene;\n    super.dispose();\n    if (scene && scene.prePassRenderer) {\n      const index = scene.prePassRenderer.renderTargets.indexOf(this);\n      if (index !== -1) {\n        scene.prePassRenderer.renderTargets.splice(index, 1);\n      }\n    }\n    if (this.imageProcessingPostProcess) {\n      this.imageProcessingPostProcess.dispose();\n    }\n    if (this.renderTargetTexture) {\n      this.renderTargetTexture._prePassRenderTarget = null;\n    }\n    if (this._outputPostProcess) {\n      this._outputPostProcess.autoClear = true;\n      this._outputPostProcess.restoreDefaultInputTexture();\n    }\n  }\n}\n//# sourceMappingURL=prePassRenderTarget.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}