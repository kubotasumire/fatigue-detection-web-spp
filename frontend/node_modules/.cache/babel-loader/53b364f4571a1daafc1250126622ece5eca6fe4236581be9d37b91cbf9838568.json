{"ast":null,"code":"import { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\nimport { bindClipPlane } from \"../../../../Materials/clipPlaneMaterialHelper.js\";\n/**\n * Block used to implement clip planes\n */\nexport class ClipPlanesBlock extends NodeMaterialBlock {\n  /**\n   * Create a new ClipPlanesBlock\n   * @param name defines the block name\n   */\n  constructor(name) {\n    super(name, NodeMaterialBlockTargets.VertexAndFragment, true);\n    this.registerInput(\"worldPosition\", NodeMaterialBlockConnectionPointTypes.Vector4, false);\n  }\n  /**\n   * Gets the current class name\n   * @returns the class name\n   */\n  getClassName() {\n    return \"ClipPlanesBlock\";\n  }\n  /**\n   * Initialize the block and prepare the context for build\n   * @param state defines the state that will be used for the build\n   */\n  initialize(state) {\n    state._excludeVariableName(\"vClipPlane\");\n    state._excludeVariableName(\"fClipDistance\");\n    state._excludeVariableName(\"vClipPlane2\");\n    state._excludeVariableName(\"fClipDistance2\");\n    state._excludeVariableName(\"vClipPlane3\");\n    state._excludeVariableName(\"fClipDistance3\");\n    state._excludeVariableName(\"vClipPlane4\");\n    state._excludeVariableName(\"fClipDistance4\");\n    state._excludeVariableName(\"vClipPlane5\");\n    state._excludeVariableName(\"fClipDistance5\");\n    state._excludeVariableName(\"vClipPlane6\");\n    state._excludeVariableName(\"fClipDistance6\");\n  }\n  /**\n   * Gets the worldPosition input component\n   */\n  get worldPosition() {\n    return this._inputs[0];\n  }\n  get target() {\n    return NodeMaterialBlockTargets.VertexAndFragment;\n  }\n  set target(value) {}\n  prepareDefines(mesh, nodeMaterial, defines) {\n    const scene = mesh.getScene();\n    const useClipPlane1 = nodeMaterial.clipPlane ?? scene.clipPlane ? true : false;\n    const useClipPlane2 = nodeMaterial.clipPlane2 ?? scene.clipPlane2 ? true : false;\n    const useClipPlane3 = nodeMaterial.clipPlane3 ?? scene.clipPlane3 ? true : false;\n    const useClipPlane4 = nodeMaterial.clipPlane4 ?? scene.clipPlane4 ? true : false;\n    const useClipPlane5 = nodeMaterial.clipPlane5 ?? scene.clipPlane5 ? true : false;\n    const useClipPlane6 = nodeMaterial.clipPlane6 ?? scene.clipPlane6 ? true : false;\n    defines.setValue(\"CLIPPLANE\", useClipPlane1, true);\n    defines.setValue(\"CLIPPLANE2\", useClipPlane2, true);\n    defines.setValue(\"CLIPPLANE3\", useClipPlane3, true);\n    defines.setValue(\"CLIPPLANE4\", useClipPlane4, true);\n    defines.setValue(\"CLIPPLANE5\", useClipPlane5, true);\n    defines.setValue(\"CLIPPLANE6\", useClipPlane6, true);\n  }\n  bind(effect, nodeMaterial, mesh) {\n    if (!mesh) {\n      return;\n    }\n    const scene = mesh.getScene();\n    bindClipPlane(effect, nodeMaterial, scene);\n  }\n  _buildBlock(state) {\n    super._buildBlock(state);\n    const comments = `//${this.name}`;\n    if (state.target !== NodeMaterialBlockTargets.Fragment) {\n      // Vertex\n      const worldPos = this.worldPosition;\n      state._emitFunctionFromInclude(\"clipPlaneVertexDeclaration\", comments, {\n        replaceStrings: [{\n          search: /uniform vec4 vClipPlane\\d*;/g,\n          replace: \"\"\n        }]\n      });\n      state.compilationString += state._emitCodeFromInclude(\"clipPlaneVertex\", comments, {\n        replaceStrings: [{\n          search: /worldPos/g,\n          replace: worldPos.associatedVariableName\n        }]\n      });\n      state._emitUniformFromString(\"vClipPlane\", \"vec4\");\n      state._emitUniformFromString(\"vClipPlane2\", \"vec4\");\n      state._emitUniformFromString(\"vClipPlane3\", \"vec4\");\n      state._emitUniformFromString(\"vClipPlane4\", \"vec4\");\n      state._emitUniformFromString(\"vClipPlane5\", \"vec4\");\n      state._emitUniformFromString(\"vClipPlane6\", \"vec4\");\n      return;\n    }\n    // Fragment\n    state.sharedData.bindableBlocks.push(this);\n    state.sharedData.blocksWithDefines.push(this);\n    state._emitFunctionFromInclude(\"clipPlaneFragmentDeclaration\", comments);\n    state.compilationString += state._emitCodeFromInclude(\"clipPlaneFragment\", comments);\n    return this;\n  }\n}\nRegisterClass(\"BABYLON.ClipPlanesBlock\", ClipPlanesBlock);\n//# sourceMappingURL=clipPlanesBlock.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}