{"ast":null,"code":"import { WebGPUCacheRenderPipeline } from \"./webgpuCacheRenderPipeline.js\";\n/** @internal */\nclass NodeState {\n  constructor() {\n    this.values = {};\n  }\n  count() {\n    let countNode = 0,\n      countPipeline = this.pipeline ? 1 : 0;\n    for (const value in this.values) {\n      const node = this.values[value];\n      const [childCountNodes, childCoundPipeline] = node.count();\n      countNode += childCountNodes;\n      countPipeline += childCoundPipeline;\n      countNode++;\n    }\n    return [countNode, countPipeline];\n  }\n}\n/** @internal */\nexport class WebGPUCacheRenderPipelineTree extends WebGPUCacheRenderPipeline {\n  static GetNodeCounts() {\n    const counts = WebGPUCacheRenderPipelineTree._Cache.count();\n    return {\n      nodeCount: counts[0],\n      pipelineCount: counts[1]\n    };\n  }\n  static _GetPipelines(node, pipelines, curPath, curPathLen) {\n    if (node.pipeline) {\n      const path = curPath.slice();\n      path.length = curPathLen;\n      pipelines.push(path);\n    }\n    for (const value in node.values) {\n      const nnode = node.values[value];\n      curPath[curPathLen] = parseInt(value);\n      WebGPUCacheRenderPipelineTree._GetPipelines(nnode, pipelines, curPath, curPathLen + 1);\n    }\n  }\n  static GetPipelines() {\n    const pipelines = [];\n    WebGPUCacheRenderPipelineTree._GetPipelines(WebGPUCacheRenderPipelineTree._Cache, pipelines, [], 0);\n    return pipelines;\n  }\n  static ResetCache() {\n    WebGPUCacheRenderPipelineTree._Cache = new NodeState();\n  }\n  reset() {\n    this._nodeStack = [];\n    this._nodeStack[0] = WebGPUCacheRenderPipelineTree._Cache;\n    super.reset();\n  }\n  _getRenderPipeline(param) {\n    let node = this._nodeStack[this._stateDirtyLowestIndex];\n    for (let i = this._stateDirtyLowestIndex; i < this._statesLength; ++i) {\n      let nn = node.values[this._states[i]];\n      if (!nn) {\n        nn = new NodeState();\n        node.values[this._states[i]] = nn;\n      }\n      node = nn;\n      this._nodeStack[i + 1] = node;\n    }\n    param.token = node;\n    param.pipeline = node.pipeline;\n  }\n  _setRenderPipeline(param) {\n    param.token.pipeline = param.pipeline;\n  }\n}\nWebGPUCacheRenderPipelineTree._Cache = new NodeState();\n//# sourceMappingURL=webgpuCacheRenderPipelineTree.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}