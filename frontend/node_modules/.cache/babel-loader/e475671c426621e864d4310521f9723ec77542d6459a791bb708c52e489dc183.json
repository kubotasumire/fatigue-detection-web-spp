{"ast":null,"code":"import { ThinEngine } from \"../../Engines/thinEngine.js\";\nimport { WebGLDataBuffer } from \"../../Meshes/WebGL/webGLDataBuffer.js\";\nThinEngine.prototype.createUniformBuffer = function (elements, _label) {\n  const ubo = this._gl.createBuffer();\n  if (!ubo) {\n    throw new Error(\"Unable to create uniform buffer\");\n  }\n  const result = new WebGLDataBuffer(ubo);\n  this.bindUniformBuffer(result);\n  if (elements instanceof Float32Array) {\n    this._gl.bufferData(this._gl.UNIFORM_BUFFER, elements, this._gl.STATIC_DRAW);\n  } else {\n    this._gl.bufferData(this._gl.UNIFORM_BUFFER, new Float32Array(elements), this._gl.STATIC_DRAW);\n  }\n  this.bindUniformBuffer(null);\n  result.references = 1;\n  return result;\n};\nThinEngine.prototype.createDynamicUniformBuffer = function (elements, _label) {\n  const ubo = this._gl.createBuffer();\n  if (!ubo) {\n    throw new Error(\"Unable to create dynamic uniform buffer\");\n  }\n  const result = new WebGLDataBuffer(ubo);\n  this.bindUniformBuffer(result);\n  if (elements instanceof Float32Array) {\n    this._gl.bufferData(this._gl.UNIFORM_BUFFER, elements, this._gl.DYNAMIC_DRAW);\n  } else {\n    this._gl.bufferData(this._gl.UNIFORM_BUFFER, new Float32Array(elements), this._gl.DYNAMIC_DRAW);\n  }\n  this.bindUniformBuffer(null);\n  result.references = 1;\n  return result;\n};\nThinEngine.prototype.updateUniformBuffer = function (uniformBuffer, elements, offset, count) {\n  this.bindUniformBuffer(uniformBuffer);\n  if (offset === undefined) {\n    offset = 0;\n  }\n  if (count === undefined) {\n    if (elements instanceof Float32Array) {\n      this._gl.bufferSubData(this._gl.UNIFORM_BUFFER, offset, elements);\n    } else {\n      this._gl.bufferSubData(this._gl.UNIFORM_BUFFER, offset, new Float32Array(elements));\n    }\n  } else {\n    if (elements instanceof Float32Array) {\n      this._gl.bufferSubData(this._gl.UNIFORM_BUFFER, 0, elements.subarray(offset, offset + count));\n    } else {\n      this._gl.bufferSubData(this._gl.UNIFORM_BUFFER, 0, new Float32Array(elements).subarray(offset, offset + count));\n    }\n  }\n  this.bindUniformBuffer(null);\n};\nThinEngine.prototype.bindUniformBuffer = function (buffer) {\n  this._gl.bindBuffer(this._gl.UNIFORM_BUFFER, buffer ? buffer.underlyingResource : null);\n};\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nThinEngine.prototype.bindUniformBufferBase = function (buffer, location, name) {\n  this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER, location, buffer ? buffer.underlyingResource : null);\n};\nThinEngine.prototype.bindUniformBlock = function (pipelineContext, blockName, index) {\n  const program = pipelineContext.program;\n  const uniformLocation = this._gl.getUniformBlockIndex(program, blockName);\n  if (uniformLocation !== 0xffffffff) {\n    this._gl.uniformBlockBinding(program, uniformLocation, index);\n  }\n};\n//# sourceMappingURL=engine.uniformBuffer.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}