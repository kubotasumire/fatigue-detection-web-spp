{"ast":null,"code":"import { __decorate } from \"../../tslib.es6.js\";\nimport { serialize } from \"../../Misc/decorators.js\";\nimport { CameraInputTypes } from \"../../Cameras/cameraInputsManager.js\";\nimport { KeyboardEventTypes } from \"../../Events/keyboardEvents.js\";\nimport { Vector3 } from \"../../Maths/math.vector.js\";\nimport { Tools } from \"../../Misc/tools.js\";\n/**\n * Listen to keyboard events to control the camera.\n * @see https://doc.babylonjs.com/features/featuresDeepDive/cameras/customizingCameraInputs\n */\nexport class FlyCameraKeyboardInput {\n  constructor() {\n    /**\n     * The list of keyboard keys used to control the forward move of the camera.\n     */\n    this.keysForward = [87];\n    /**\n     * The list of keyboard keys used to control the backward move of the camera.\n     */\n    this.keysBackward = [83];\n    /**\n     * The list of keyboard keys used to control the forward move of the camera.\n     */\n    this.keysUp = [69];\n    /**\n     * The list of keyboard keys used to control the backward move of the camera.\n     */\n    this.keysDown = [81];\n    /**\n     * The list of keyboard keys used to control the right strafe move of the camera.\n     */\n    this.keysRight = [68];\n    /**\n     * The list of keyboard keys used to control the left strafe move of the camera.\n     */\n    this.keysLeft = [65];\n    this._keys = new Array();\n  }\n  /**\n   * Attach the input controls to a specific dom element to get the input from.\n   * @param noPreventDefault Defines whether event caught by the controls should call preventdefault() (https://developer.mozilla.org/en-US/docs/Web/API/Event/preventDefault)\n   */\n  attachControl(noPreventDefault) {\n    // eslint-disable-next-line prefer-rest-params\n    noPreventDefault = Tools.BackCompatCameraNoPreventDefault(arguments);\n    if (this._onCanvasBlurObserver) {\n      return;\n    }\n    this._scene = this.camera.getScene();\n    this._engine = this._scene.getEngine();\n    this._onCanvasBlurObserver = this._engine.onCanvasBlurObservable.add(() => {\n      this._keys.length = 0;\n    });\n    this._onKeyboardObserver = this._scene.onKeyboardObservable.add(info => {\n      const evt = info.event;\n      if (info.type === KeyboardEventTypes.KEYDOWN) {\n        if (this.keysForward.indexOf(evt.keyCode) !== -1 || this.keysBackward.indexOf(evt.keyCode) !== -1 || this.keysUp.indexOf(evt.keyCode) !== -1 || this.keysDown.indexOf(evt.keyCode) !== -1 || this.keysLeft.indexOf(evt.keyCode) !== -1 || this.keysRight.indexOf(evt.keyCode) !== -1) {\n          const index = this._keys.indexOf(evt.keyCode);\n          if (index === -1) {\n            this._keys.push(evt.keyCode);\n          }\n          if (!noPreventDefault) {\n            evt.preventDefault();\n          }\n        }\n      } else {\n        if (this.keysForward.indexOf(evt.keyCode) !== -1 || this.keysBackward.indexOf(evt.keyCode) !== -1 || this.keysUp.indexOf(evt.keyCode) !== -1 || this.keysDown.indexOf(evt.keyCode) !== -1 || this.keysLeft.indexOf(evt.keyCode) !== -1 || this.keysRight.indexOf(evt.keyCode) !== -1) {\n          const index = this._keys.indexOf(evt.keyCode);\n          if (index >= 0) {\n            this._keys.splice(index, 1);\n          }\n          if (!noPreventDefault) {\n            evt.preventDefault();\n          }\n        }\n      }\n    });\n  }\n  /**\n   * Detach the current controls from the specified dom element.\n   */\n  detachControl() {\n    if (this._scene) {\n      if (this._onKeyboardObserver) {\n        this._scene.onKeyboardObservable.remove(this._onKeyboardObserver);\n      }\n      if (this._onCanvasBlurObserver) {\n        this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver);\n      }\n      this._onKeyboardObserver = null;\n      this._onCanvasBlurObserver = null;\n    }\n    this._keys.length = 0;\n  }\n  /**\n   * Gets the class name of the current input.\n   * @returns the class name\n   */\n  getClassName() {\n    return \"FlyCameraKeyboardInput\";\n  }\n  /**\n   * @internal\n   */\n  _onLostFocus() {\n    this._keys.length = 0;\n  }\n  /**\n   * Get the friendly name associated with the input class.\n   * @returns the input friendly name\n   */\n  getSimpleName() {\n    return \"keyboard\";\n  }\n  /**\n   * Update the current camera state depending on the inputs that have been used this frame.\n   * This is a dynamically created lambda to avoid the performance penalty of looping for inputs in the render loop.\n   */\n  checkInputs() {\n    if (this._onKeyboardObserver) {\n      const camera = this.camera;\n      // Keyboard\n      for (let index = 0; index < this._keys.length; index++) {\n        const keyCode = this._keys[index];\n        const speed = camera._computeLocalCameraSpeed();\n        if (this.keysForward.indexOf(keyCode) !== -1) {\n          camera._localDirection.copyFromFloats(0, 0, speed);\n        } else if (this.keysBackward.indexOf(keyCode) !== -1) {\n          camera._localDirection.copyFromFloats(0, 0, -speed);\n        } else if (this.keysUp.indexOf(keyCode) !== -1) {\n          camera._localDirection.copyFromFloats(0, speed, 0);\n        } else if (this.keysDown.indexOf(keyCode) !== -1) {\n          camera._localDirection.copyFromFloats(0, -speed, 0);\n        } else if (this.keysRight.indexOf(keyCode) !== -1) {\n          camera._localDirection.copyFromFloats(speed, 0, 0);\n        } else if (this.keysLeft.indexOf(keyCode) !== -1) {\n          camera._localDirection.copyFromFloats(-speed, 0, 0);\n        }\n        if (camera.getScene().useRightHandedSystem) {\n          camera._localDirection.z *= -1;\n        }\n        camera.getViewMatrix().invertToRef(camera._cameraTransformMatrix);\n        Vector3.TransformNormalToRef(camera._localDirection, camera._cameraTransformMatrix, camera._transformedDirection);\n        camera.cameraDirection.addInPlace(camera._transformedDirection);\n      }\n    }\n  }\n}\n__decorate([serialize()], FlyCameraKeyboardInput.prototype, \"keysForward\", void 0);\n__decorate([serialize()], FlyCameraKeyboardInput.prototype, \"keysBackward\", void 0);\n__decorate([serialize()], FlyCameraKeyboardInput.prototype, \"keysUp\", void 0);\n__decorate([serialize()], FlyCameraKeyboardInput.prototype, \"keysDown\", void 0);\n__decorate([serialize()], FlyCameraKeyboardInput.prototype, \"keysRight\", void 0);\n__decorate([serialize()], FlyCameraKeyboardInput.prototype, \"keysLeft\", void 0);\nCameraInputTypes[\"FlyCameraKeyboardInput\"] = FlyCameraKeyboardInput;\n//# sourceMappingURL=flyCameraKeyboardInput.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}