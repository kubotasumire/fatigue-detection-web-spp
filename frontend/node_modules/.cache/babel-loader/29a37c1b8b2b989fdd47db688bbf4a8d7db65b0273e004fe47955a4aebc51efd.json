{"ast":null,"code":"var _jsxFileName = \"/Users/kubotasumire/Univ./\\u5352\\u8AD6/s-2/fatigue-detection-web-spp/frontend/src/components/GameScene.jsx\";\nimport React, { useEffect, useRef, useState } from 'react';\nimport { useGameTimer } from '../hooks/useGameTimer';\nimport DataCollector from '../utils/dataCollector';\nimport QuizBooth from './QuizBooth';\nimport './GameScene.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst GameScene = ({\n  difficulty,\n  sessionId,\n  onGameEnd,\n  onTimeUp,\n  onQuizResponse,\n  onQuizAttempt,\n  quizResponses,\n  attemptedQuizzes\n}) => {\n  const containerRef = useRef(null);\n  const canvasRef = useRef(null);\n  const {\n    formattedTime,\n    remainingTime\n  } = useGameTimer(difficulty, onTimeUp);\n  const dataCollectorRef = useRef(null);\n  const quizBoothsRef = useRef([]);\n  const activeQuizRef = useRef(null);\n  const [quizzes, setQuizzes] = useState([]);\n  const [solvedQuizzes, setSolvedQuizzes] = useState(new Set());\n  const [activeQuizId, setActiveQuizId] = useState(null);\n  const [isInitialized, setIsInitialized] = useState(false);\n\n  // Canvas ÂàùÊúüÂåñ\n  useEffect(() => {\n    if (!containerRef.current) return;\n\n    // Êó¢Â≠ò„ÅÆ canvas „Åå„ÅÇ„Çå„Å∞ÂâäÈô§\n    const existingCanvas = containerRef.current.querySelector('canvas');\n    if (existingCanvas) {\n      existingCanvas.remove();\n    }\n    const width = window.innerWidth;\n    const height = window.innerHeight;\n    const canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    canvas.style.display = 'block';\n    canvas.style.width = '100%';\n    canvas.style.height = '100%';\n    canvas.style.position = 'absolute';\n    canvas.style.top = '0';\n    canvas.style.left = '0';\n    containerRef.current.appendChild(canvas);\n    canvasRef.current = canvas;\n\n    // „ÇØ„É™„ÉÉ„ÇØ„ÇíÁ¢∫ÂÆü„Å´Âèó„ÅëÂèñ„Çã„Åü„ÇÅ\n    canvas.style.cursor = 'pointer';\n    console.log('üé® Canvas initialized:', {\n      width,\n      height\n    });\n    setIsInitialized(true);\n  }, []);\n\n  // „ÇØ„Ç§„Ç∫„Éá„Éº„ÇøÂèñÂæó\n  useEffect(() => {\n    const fetchQuizzes = async () => {\n      try {\n        var _data$quizzes;\n        const response = await fetch(`http://localhost:5001/api/quiz/difficulty/${difficulty}`);\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const data = await response.json();\n        console.log(`Loaded ${((_data$quizzes = data.quizzes) === null || _data$quizzes === void 0 ? void 0 : _data$quizzes.length) || 0} quizzes for difficulty: ${difficulty}`);\n        setQuizzes(data.quizzes || []);\n      } catch (error) {\n        console.error('Failed to fetch quizzes:', error);\n        setQuizzes([]);\n      }\n    };\n    if (difficulty) {\n      fetchQuizzes();\n    }\n  }, [difficulty]);\n\n  // ÂãïÁâ©„ÅÆÈ°î„ÇíÊèèÁîª„Åô„Çã„Éò„É´„Éë„ÉºÈñ¢Êï∞\n  const drawAnimalFace = (ctx, x, y, size, fillColor, strokeColor, quizId, animalType = 'seal') => {\n    // È†≠„ÇíÊèèÁîªÔºàÂÜÜÂΩ¢Ôºâ\n    ctx.fillStyle = fillColor;\n    ctx.strokeStyle = strokeColor;\n    ctx.lineWidth = 3;\n    ctx.beginPath();\n    ctx.arc(x, y, size / 2, 0, Math.PI * 2);\n    ctx.fill();\n    ctx.stroke();\n\n    // ÂãïÁâ©„ÅÆÁ®ÆÈ°û„Å´Âøú„Åò„ÅüÈ°î„ÇíÊèèÁîª\n    if (animalType === 'seal') {\n      // „Ç¢„Ç∂„É©„Ç∑„ÅÆÈ°î\n      // ÁõÆÔºà2„Å§Ôºâ\n      ctx.fillStyle = '#000000';\n      ctx.beginPath();\n      ctx.arc(x - size / 6, y - size / 6, size / 12, 0, Math.PI * 2);\n      ctx.fill();\n      ctx.beginPath();\n      ctx.arc(x + size / 6, y - size / 6, size / 12, 0, Math.PI * 2);\n      ctx.fill();\n\n      // ÁõÆ„ÅÆËºù„Åç\n      ctx.fillStyle = '#ffffff';\n      ctx.beginPath();\n      ctx.arc(x - size / 6 + size / 24, y - size / 6 - size / 24, size / 24, 0, Math.PI * 2);\n      ctx.fill();\n      ctx.beginPath();\n      ctx.arc(x + size / 6 + size / 24, y - size / 6 - size / 24, size / 24, 0, Math.PI * 2);\n      ctx.fill();\n\n      // Èºª\n      ctx.fillStyle = '#000000';\n      ctx.beginPath();\n      ctx.arc(x, y + size / 12, size / 16, 0, Math.PI * 2);\n      ctx.fill();\n\n      // Âè£Ôºà‰∏äÂêë„Åç„ÅÆÊõ≤Á∑ö„ÅßÁ¨ëÈ°îÔºâ\n      ctx.strokeStyle = '#000000';\n      ctx.lineWidth = 2;\n      ctx.beginPath();\n      ctx.arc(x, y + size / 8, size / 8, 0, Math.PI);\n      ctx.stroke();\n\n      // „Å≤„ÅíÔºà3Êú¨Ôºâ\n      ctx.strokeStyle = '#000000';\n      ctx.lineWidth = 1.5;\n      for (let i = -1; i <= 1; i++) {\n        ctx.beginPath();\n        ctx.moveTo(x - size / 4, y + size / 16 + i * size / 12);\n        ctx.lineTo(x - size / 2 - 5, y + size / 16 + i * size / 12);\n        ctx.stroke();\n        ctx.beginPath();\n        ctx.moveTo(x + size / 4, y + size / 16 + i * size / 12);\n        ctx.lineTo(x + size / 2 + 5, y + size / 16 + i * size / 12);\n        ctx.stroke();\n      }\n    }\n\n    // „ÇØ„Ç§„Ç∫Áï™Âè∑„ÇíÊèèÁîªÔºàÈ°î„ÅÆ‰∏ã„Å´Ôºâ\n    ctx.fillStyle = '#000000';\n    ctx.font = 'bold 16px Arial';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillText(quizId, x, y + size / 2 + 25);\n  };\n\n  // Canvas „É¨„É≥„ÉÄ„É™„É≥„Ç∞\n  useEffect(() => {\n    if (!canvasRef.current) return;\n    const canvas = canvasRef.current;\n    const ctx = canvas.getContext('2d');\n\n    // ËÉåÊôØËâ≤ - ÊäπËå∂„Çπ„É†„Éº„Ç∏„Éº„ÅÆ„Çà„ÅÜ„Å™„Éë„Çπ„ÉÜ„É´„Ç∞„É™„Éº„É≥\n    ctx.fillStyle = '#d4f1d8';\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n    // „Ç∞„É™„ÉÉ„ÉâÊèèÁîªÔºàÊúÄÈÅ©ÂåñÁâà - 80px„Åî„Å®„ÄÅÊ∑°„ÅÑËâ≤Ôºâ\n    ctx.strokeStyle = 'rgba(139, 195, 156, 0.3)';\n    ctx.lineWidth = 0.8;\n    const gridSize = 80;\n    for (let i = 0; i < canvas.width; i += gridSize) {\n      ctx.beginPath();\n      ctx.moveTo(i, 0);\n      ctx.lineTo(i, canvas.height);\n      ctx.stroke();\n    }\n    for (let i = 0; i < canvas.height; i += gridSize) {\n      ctx.beginPath();\n      ctx.moveTo(0, i);\n      ctx.lineTo(canvas.width, i);\n      ctx.stroke();\n    }\n\n    // „ÇØ„Ç§„Ç∫„Éñ„Éº„Çπ„ÇíÊèèÁîªÔºàÂãïÁâ©„ÅÆÈ°î„Åß„É©„É≥„ÉÄ„É†ÈÖçÁΩÆÔºâ\n    if (quizzes.length > 0) {\n      const boothSize = 80;\n      const padding = boothSize + 20; // „Éñ„Éº„Çπ„Çµ„Ç§„Ç∫ + ‰ΩôË£ï\n\n      quizBoothsRef.current = quizzes.map((quiz, index) => {\n        // „É©„É≥„ÉÄ„É†„Å™‰ΩçÁΩÆ„ÇíÁîüÊàêÔºàÁîªÈù¢ÂÖ®‰Ωì„Å´Êï£„Çâ„Å∞„Çâ„Åõ„ÇãÔºâ\n        let x, y;\n        let isValidPosition = false;\n        let attempts = 0;\n\n        // Êó¢Â≠ò„ÅÆ„Éñ„Éº„Çπ„Å®Èáç„Å™„Çâ„Å™„ÅÑ‰ΩçÁΩÆ„ÇíÊé¢„Åô\n        while (!isValidPosition && attempts < 50) {\n          x = padding + Math.random() * (canvas.width - padding * 2);\n          y = padding + Math.random() * (canvas.height - padding * 2);\n\n          // ‰ªñ„ÅÆ„Éñ„Éº„Çπ„Å®„ÅÆË∑ùÈõ¢„Çí„ÉÅ„Çß„ÉÉ„ÇØ\n          isValidPosition = true;\n          for (const booth of quizBoothsRef.current) {\n            const dx = x - booth.x;\n            const dy = y - booth.y;\n            const distance = Math.sqrt(dx * dx + dy * dy);\n            if (distance < padding * 1.5) {\n              isValidPosition = false;\n              break;\n            }\n          }\n          attempts++;\n        }\n\n        // ‰ΩçÁΩÆ„ÅåË¶ã„Å§„Åã„Çâ„Å™„ÅÑÂ†¥Âêà„ÅØ„Éá„Éï„Ç©„É´„Éà‰ΩçÁΩÆ„Çí‰ΩøÁî®\n        if (!isValidPosition) {\n          x = padding + index % Math.ceil(Math.sqrt(quizzes.length)) * (canvas.width / Math.ceil(Math.sqrt(quizzes.length)));\n          y = padding + Math.floor(index / Math.ceil(Math.sqrt(quizzes.length))) * (canvas.height / Math.ceil(Math.sqrt(quizzes.length)));\n        }\n\n        // „ÇØ„Ç§„Ç∫„ÅÆÁä∂ÊÖã„ÇíÁ¢∫Ë™ç\n        const quizResponse = quizResponses === null || quizResponses === void 0 ? void 0 : quizResponses.find(r => r.quizId === quiz.id);\n        const isAnswered = !!quizResponse;\n        const isAttempted = attemptedQuizzes === null || attemptedQuizzes === void 0 ? void 0 : attemptedQuizzes.has(quiz.id);\n\n        // ÂãïÁâ©„ÅÆËâ≤„ÇíÊ±∫ÂÆö\n        let fillColor = '#FFD1DC'; // „Éá„Éï„Ç©„É´„ÉàÔºöÊ∑°„ÅÑ„Éî„É≥„ÇØÔºàÊú™Ë©¶Ë°åÔºâ\n        let strokeColor = '#FF69B4';\n        let animalType = 'seal';\n        if (isAnswered) {\n          // ÂõûÁ≠îÊ∏à„ÅøÂïèÈ°åÔºöÊ≠£Ëß£„Å™„ÇâÁ∑ë„ÄÅ‰∏çÊ≠£Ëß£„Å™„ÇâËµ§\n          if (quizResponse.isCorrect) {\n            fillColor = '#A8D8A8'; // Ê∑°„ÅÑÁ∑ë\n            strokeColor = '#4CAF50';\n          } else {\n            fillColor = '#FFB3B3'; // Ê∑°„ÅÑËµ§\n            strokeColor = '#f44336';\n          }\n        } else if (isAttempted) {\n          // Ë©¶Ë°åÊ∏à„Åø„Å†„ÅåÊú™ÂõûÁ≠îÔºöÊ∑°„ÅÑÈùí\n          fillColor = '#ADD8E6';\n          strokeColor = '#2196F3';\n        }\n\n        // ÂãïÁâ©„ÅÆÈ°î„ÇíÊèèÁîª\n        drawAnimalFace(ctx, x, y, boothSize, fillColor, strokeColor, quiz.id, animalType);\n        return {\n          id: quiz.id,\n          x,\n          y,\n          size: boothSize\n        };\n      });\n      console.log('üé® Canvas rendered with', quizBoothsRef.current.length, 'cute animal faces');\n    } else {\n      console.log('‚è≥ Waiting for quizzes to load...');\n      quizBoothsRef.current = [];\n    }\n  }, [quizzes, solvedQuizzes, quizResponses, attemptedQuizzes]);\n\n  // „Éû„Ç¶„Çπ„ÇØ„É™„ÉÉ„ÇØÂá¶ÁêÜÔºà„Éà„É©„ÉÉ„ÇØ„Éë„ÉÉ„ÉâÂØæÂøúÔºâ\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const handlePointerInteraction = event => {\n      const rect = canvas.getBoundingClientRect();\n      const clickX = event.clientX - rect.left;\n      const clickY = event.clientY - rect.top;\n      console.log(`üñ±Ô∏è Pointer detected at canvas coordinates: (${Math.round(clickX)}, ${Math.round(clickY)})`);\n      console.log(`üìç Current booth count: ${quizBoothsRef.current.length}`);\n      if (quizBoothsRef.current.length === 0) {\n        console.log('‚ö†Ô∏è No booths available yet');\n        return;\n      }\n      for (const booth of quizBoothsRef.current) {\n        const dx = clickX - booth.x;\n        const dy = clickY - booth.y;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n\n        // Check if quiz has been answered\n        const isAnswered = quizResponses === null || quizResponses === void 0 ? void 0 : quizResponses.find(r => r.quizId === booth.id);\n        // ÂãïÁâ©„ÅÆÈ°î„ÅÆÈ†≠ÈÉ®ÂàÜ„ÅåÁ¥Ñbooth.size / 2„ÅÆÂçäÂæÑ„Å™„ÅÆ„Åß„ÄÅ„ÇØ„É™„ÉÉ„ÇØÂà§ÂÆö„ÇÇ„Åù„Çå„Å´Âêà„Çè„Åõ„Çã\n        const clickThreshold = booth.size / 2 + 10; // Â∞ë„Åó‰ΩôË£ï„ÇíÊåÅ„Åü„Åõ„Çã\n        console.log(`  Booth ${booth.id}: distance=${Math.round(distance)}, threshold=${clickThreshold}, answered=${!!isAnswered}`);\n        if (distance < clickThreshold && !isAnswered) {\n          console.log(`‚úÖ Clicked booth: ${booth.id}`);\n          // Record attempt when opening quiz\n          if (onQuizAttempt) {\n            onQuizAttempt(booth.id);\n          }\n          setActiveQuizId(booth.id);\n          activeQuizRef.current = booth.id;\n          event.preventDefault();\n          break;\n        }\n      }\n    };\n\n    // Ë§áÊï∞„ÅÆ„Ç§„Éô„É≥„Éà„Çø„Ç§„Éó„Çí„É™„Çπ„É≥\n    canvas.addEventListener('click', handlePointerInteraction);\n    canvas.addEventListener('mousedown', handlePointerInteraction);\n    canvas.addEventListener('touchstart', handlePointerInteraction);\n    console.log('‚úÖ Event listeners attached to canvas');\n    return () => {\n      canvas.removeEventListener('click', handlePointerInteraction);\n      canvas.removeEventListener('mousedown', handlePointerInteraction);\n      canvas.removeEventListener('touchstart', handlePointerInteraction);\n      console.log('üßπ Event listeners removed from canvas');\n    };\n  }, []);\n\n  // „Éá„Éº„ÇøÂèéÈõÜÈñãÂßã\n  useEffect(() => {\n    if (!isInitialized || !sessionId) return;\n    dataCollectorRef.current = new DataCollector(sessionId);\n    dataCollectorRef.current.start();\n    return () => {\n      if (dataCollectorRef.current) {\n        dataCollectorRef.current.stop();\n      }\n    };\n  }, [isInitialized, sessionId]);\n  const handleQuizClose = async (quizId, isCorrect) => {\n    // „ÇØ„Ç§„Ç∫ÂõûÁ≠î„Éá„Éº„Çø„ÇíË®òÈå≤\n    if (onQuizResponse) {\n      onQuizResponse(quizId, isCorrect);\n    }\n    setSolvedQuizzes(prev => new Set(prev).add(quizId));\n    setActiveQuizId(null);\n\n    // „Åô„Åπ„Å¶„ÅÆ„ÇØ„Ç§„Ç∫„Å´ÂõûÁ≠î„Åó„Åü„ÅãÁ¢∫Ë™ç\n    // quizResponses„ÅØÊõ¥Êñ∞‰∏≠„ÅÆÂèØËÉΩÊÄß„Åå„ÅÇ„Çã„Åü„ÇÅ„ÄÅÊâãÂãï„ÅßË®àÁÆó\n    const totalAnswered = ((quizResponses === null || quizResponses === void 0 ? void 0 : quizResponses.length) || 0) + (isCorrect !== null ? 1 : 0);\n    if (totalAnswered === quizzes.length) {\n      onGameEnd({\n        reason: 'completed'\n      });\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"game-scene\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      ref: containerRef,\n      className: \"three-container\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 336,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"game-ui\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: `timer ${remainingTime < 60 ? 'warning' : ''}`,\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"label\",\n          children: \"\\u5236\\u9650\\u6642\\u9593:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 342,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"time\",\n          children: formattedTime\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 343,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 341,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"progress\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"label\",\n          children: \"\\u56DE\\u7B54\\u3057\\u305F\\u554F\\u984C:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 348,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"count\",\n          children: [quizResponses.length, \" / \", quizzes.length]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 349,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 347,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 339,\n      columnNumber: 7\n    }, this), activeQuizId && /*#__PURE__*/_jsxDEV(QuizBooth, {\n      quiz: quizzes.find(q => q.id === activeQuizId),\n      difficulty: difficulty,\n      onClose: handleQuizClose,\n      dataCollector: dataCollectorRef.current\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 355,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 335,\n    columnNumber: 5\n  }, this);\n};\nexport default GameScene;","map":{"version":3,"names":["React","useEffect","useRef","useState","useGameTimer","DataCollector","QuizBooth","jsxDEV","_jsxDEV","GameScene","difficulty","sessionId","onGameEnd","onTimeUp","onQuizResponse","onQuizAttempt","quizResponses","attemptedQuizzes","containerRef","canvasRef","formattedTime","remainingTime","dataCollectorRef","quizBoothsRef","activeQuizRef","quizzes","setQuizzes","solvedQuizzes","setSolvedQuizzes","Set","activeQuizId","setActiveQuizId","isInitialized","setIsInitialized","current","existingCanvas","querySelector","remove","width","window","innerWidth","height","innerHeight","canvas","document","createElement","style","display","position","top","left","appendChild","cursor","console","log","fetchQuizzes","_data$quizzes","response","fetch","ok","Error","status","data","json","length","error","drawAnimalFace","ctx","x","y","size","fillColor","strokeColor","quizId","animalType","fillStyle","strokeStyle","lineWidth","beginPath","arc","Math","PI","fill","stroke","i","moveTo","lineTo","font","textAlign","textBaseline","fillText","getContext","fillRect","gridSize","boothSize","padding","map","quiz","index","isValidPosition","attempts","random","booth","dx","dy","distance","sqrt","ceil","floor","quizResponse","find","r","id","isAnswered","isAttempted","has","isCorrect","handlePointerInteraction","event","rect","getBoundingClientRect","clickX","clientX","clickY","clientY","round","clickThreshold","preventDefault","addEventListener","removeEventListener","start","stop","handleQuizClose","prev","add","totalAnswered","reason","className","children","ref","fileName","_jsxFileName","lineNumber","columnNumber","q","onClose","dataCollector"],"sources":["/Users/kubotasumire/Univ./ÂçíË´ñ/s-2/fatigue-detection-web-spp/frontend/src/components/GameScene.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport { useGameTimer } from '../hooks/useGameTimer';\nimport DataCollector from '../utils/dataCollector';\nimport QuizBooth from './QuizBooth';\nimport './GameScene.css';\n\nconst GameScene = ({ difficulty, sessionId, onGameEnd, onTimeUp, onQuizResponse, onQuizAttempt, quizResponses, attemptedQuizzes }) => {\n  const containerRef = useRef(null);\n  const canvasRef = useRef(null);\n  const { formattedTime, remainingTime } = useGameTimer(difficulty, onTimeUp);\n  const dataCollectorRef = useRef(null);\n  const quizBoothsRef = useRef([]);\n  const activeQuizRef = useRef(null);\n\n  const [quizzes, setQuizzes] = useState([]);\n  const [solvedQuizzes, setSolvedQuizzes] = useState(new Set());\n  const [activeQuizId, setActiveQuizId] = useState(null);\n  const [isInitialized, setIsInitialized] = useState(false);\n\n  // Canvas ÂàùÊúüÂåñ\n  useEffect(() => {\n    if (!containerRef.current) return;\n\n    // Êó¢Â≠ò„ÅÆ canvas „Åå„ÅÇ„Çå„Å∞ÂâäÈô§\n    const existingCanvas = containerRef.current.querySelector('canvas');\n    if (existingCanvas) {\n      existingCanvas.remove();\n    }\n\n    const width = window.innerWidth;\n    const height = window.innerHeight;\n\n    const canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    canvas.style.display = 'block';\n    canvas.style.width = '100%';\n    canvas.style.height = '100%';\n    canvas.style.position = 'absolute';\n    canvas.style.top = '0';\n    canvas.style.left = '0';\n\n    containerRef.current.appendChild(canvas);\n    canvasRef.current = canvas;\n\n    // „ÇØ„É™„ÉÉ„ÇØ„ÇíÁ¢∫ÂÆü„Å´Âèó„ÅëÂèñ„Çã„Åü„ÇÅ\n    canvas.style.cursor = 'pointer';\n\n    console.log('üé® Canvas initialized:', { width, height });\n    setIsInitialized(true);\n  }, []);\n\n  // „ÇØ„Ç§„Ç∫„Éá„Éº„ÇøÂèñÂæó\n  useEffect(() => {\n    const fetchQuizzes = async () => {\n      try {\n        const response = await fetch(`http://localhost:5001/api/quiz/difficulty/${difficulty}`);\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const data = await response.json();\n        console.log(`Loaded ${data.quizzes?.length || 0} quizzes for difficulty: ${difficulty}`);\n        setQuizzes(data.quizzes || []);\n      } catch (error) {\n        console.error('Failed to fetch quizzes:', error);\n        setQuizzes([]);\n      }\n    };\n\n    if (difficulty) {\n      fetchQuizzes();\n    }\n  }, [difficulty]);\n\n  // ÂãïÁâ©„ÅÆÈ°î„ÇíÊèèÁîª„Åô„Çã„Éò„É´„Éë„ÉºÈñ¢Êï∞\n  const drawAnimalFace = (ctx, x, y, size, fillColor, strokeColor, quizId, animalType = 'seal') => {\n    // È†≠„ÇíÊèèÁîªÔºàÂÜÜÂΩ¢Ôºâ\n    ctx.fillStyle = fillColor;\n    ctx.strokeStyle = strokeColor;\n    ctx.lineWidth = 3;\n    ctx.beginPath();\n    ctx.arc(x, y, size / 2, 0, Math.PI * 2);\n    ctx.fill();\n    ctx.stroke();\n\n    // ÂãïÁâ©„ÅÆÁ®ÆÈ°û„Å´Âøú„Åò„ÅüÈ°î„ÇíÊèèÁîª\n    if (animalType === 'seal') {\n      // „Ç¢„Ç∂„É©„Ç∑„ÅÆÈ°î\n      // ÁõÆÔºà2„Å§Ôºâ\n      ctx.fillStyle = '#000000';\n      ctx.beginPath();\n      ctx.arc(x - size / 6, y - size / 6, size / 12, 0, Math.PI * 2);\n      ctx.fill();\n      ctx.beginPath();\n      ctx.arc(x + size / 6, y - size / 6, size / 12, 0, Math.PI * 2);\n      ctx.fill();\n\n      // ÁõÆ„ÅÆËºù„Åç\n      ctx.fillStyle = '#ffffff';\n      ctx.beginPath();\n      ctx.arc(x - size / 6 + size / 24, y - size / 6 - size / 24, size / 24, 0, Math.PI * 2);\n      ctx.fill();\n      ctx.beginPath();\n      ctx.arc(x + size / 6 + size / 24, y - size / 6 - size / 24, size / 24, 0, Math.PI * 2);\n      ctx.fill();\n\n      // Èºª\n      ctx.fillStyle = '#000000';\n      ctx.beginPath();\n      ctx.arc(x, y + size / 12, size / 16, 0, Math.PI * 2);\n      ctx.fill();\n\n      // Âè£Ôºà‰∏äÂêë„Åç„ÅÆÊõ≤Á∑ö„ÅßÁ¨ëÈ°îÔºâ\n      ctx.strokeStyle = '#000000';\n      ctx.lineWidth = 2;\n      ctx.beginPath();\n      ctx.arc(x, y + size / 8, size / 8, 0, Math.PI);\n      ctx.stroke();\n\n      // „Å≤„ÅíÔºà3Êú¨Ôºâ\n      ctx.strokeStyle = '#000000';\n      ctx.lineWidth = 1.5;\n      for (let i = -1; i <= 1; i++) {\n        ctx.beginPath();\n        ctx.moveTo(x - size / 4, y + size / 16 + i * size / 12);\n        ctx.lineTo(x - size / 2 - 5, y + size / 16 + i * size / 12);\n        ctx.stroke();\n        ctx.beginPath();\n        ctx.moveTo(x + size / 4, y + size / 16 + i * size / 12);\n        ctx.lineTo(x + size / 2 + 5, y + size / 16 + i * size / 12);\n        ctx.stroke();\n      }\n    }\n\n    // „ÇØ„Ç§„Ç∫Áï™Âè∑„ÇíÊèèÁîªÔºàÈ°î„ÅÆ‰∏ã„Å´Ôºâ\n    ctx.fillStyle = '#000000';\n    ctx.font = 'bold 16px Arial';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillText(quizId, x, y + size / 2 + 25);\n  };\n\n  // Canvas „É¨„É≥„ÉÄ„É™„É≥„Ç∞\n  useEffect(() => {\n    if (!canvasRef.current) return;\n\n    const canvas = canvasRef.current;\n    const ctx = canvas.getContext('2d');\n\n    // ËÉåÊôØËâ≤ - ÊäπËå∂„Çπ„É†„Éº„Ç∏„Éº„ÅÆ„Çà„ÅÜ„Å™„Éë„Çπ„ÉÜ„É´„Ç∞„É™„Éº„É≥\n    ctx.fillStyle = '#d4f1d8';\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n    // „Ç∞„É™„ÉÉ„ÉâÊèèÁîªÔºàÊúÄÈÅ©ÂåñÁâà - 80px„Åî„Å®„ÄÅÊ∑°„ÅÑËâ≤Ôºâ\n    ctx.strokeStyle = 'rgba(139, 195, 156, 0.3)';\n    ctx.lineWidth = 0.8;\n    const gridSize = 80;\n    for (let i = 0; i < canvas.width; i += gridSize) {\n      ctx.beginPath();\n      ctx.moveTo(i, 0);\n      ctx.lineTo(i, canvas.height);\n      ctx.stroke();\n    }\n    for (let i = 0; i < canvas.height; i += gridSize) {\n      ctx.beginPath();\n      ctx.moveTo(0, i);\n      ctx.lineTo(canvas.width, i);\n      ctx.stroke();\n    }\n\n    // „ÇØ„Ç§„Ç∫„Éñ„Éº„Çπ„ÇíÊèèÁîªÔºàÂãïÁâ©„ÅÆÈ°î„Åß„É©„É≥„ÉÄ„É†ÈÖçÁΩÆÔºâ\n    if (quizzes.length > 0) {\n      const boothSize = 80;\n      const padding = boothSize + 20; // „Éñ„Éº„Çπ„Çµ„Ç§„Ç∫ + ‰ΩôË£ï\n\n      quizBoothsRef.current = quizzes.map((quiz, index) => {\n        // „É©„É≥„ÉÄ„É†„Å™‰ΩçÁΩÆ„ÇíÁîüÊàêÔºàÁîªÈù¢ÂÖ®‰Ωì„Å´Êï£„Çâ„Å∞„Çâ„Åõ„ÇãÔºâ\n        let x, y;\n        let isValidPosition = false;\n        let attempts = 0;\n\n        // Êó¢Â≠ò„ÅÆ„Éñ„Éº„Çπ„Å®Èáç„Å™„Çâ„Å™„ÅÑ‰ΩçÁΩÆ„ÇíÊé¢„Åô\n        while (!isValidPosition && attempts < 50) {\n          x = padding + Math.random() * (canvas.width - padding * 2);\n          y = padding + Math.random() * (canvas.height - padding * 2);\n\n          // ‰ªñ„ÅÆ„Éñ„Éº„Çπ„Å®„ÅÆË∑ùÈõ¢„Çí„ÉÅ„Çß„ÉÉ„ÇØ\n          isValidPosition = true;\n          for (const booth of quizBoothsRef.current) {\n            const dx = x - booth.x;\n            const dy = y - booth.y;\n            const distance = Math.sqrt(dx * dx + dy * dy);\n            if (distance < padding * 1.5) {\n              isValidPosition = false;\n              break;\n            }\n          }\n          attempts++;\n        }\n\n        // ‰ΩçÁΩÆ„ÅåË¶ã„Å§„Åã„Çâ„Å™„ÅÑÂ†¥Âêà„ÅØ„Éá„Éï„Ç©„É´„Éà‰ΩçÁΩÆ„Çí‰ΩøÁî®\n        if (!isValidPosition) {\n          x = padding + (index % Math.ceil(Math.sqrt(quizzes.length))) * (canvas.width / Math.ceil(Math.sqrt(quizzes.length)));\n          y = padding + Math.floor(index / Math.ceil(Math.sqrt(quizzes.length))) * (canvas.height / Math.ceil(Math.sqrt(quizzes.length)));\n        }\n\n        // „ÇØ„Ç§„Ç∫„ÅÆÁä∂ÊÖã„ÇíÁ¢∫Ë™ç\n        const quizResponse = quizResponses?.find(r => r.quizId === quiz.id);\n        const isAnswered = !!quizResponse;\n        const isAttempted = attemptedQuizzes?.has(quiz.id);\n\n        // ÂãïÁâ©„ÅÆËâ≤„ÇíÊ±∫ÂÆö\n        let fillColor = '#FFD1DC'; // „Éá„Éï„Ç©„É´„ÉàÔºöÊ∑°„ÅÑ„Éî„É≥„ÇØÔºàÊú™Ë©¶Ë°åÔºâ\n        let strokeColor = '#FF69B4';\n        let animalType = 'seal';\n\n        if (isAnswered) {\n          // ÂõûÁ≠îÊ∏à„ÅøÂïèÈ°åÔºöÊ≠£Ëß£„Å™„ÇâÁ∑ë„ÄÅ‰∏çÊ≠£Ëß£„Å™„ÇâËµ§\n          if (quizResponse.isCorrect) {\n            fillColor = '#A8D8A8'; // Ê∑°„ÅÑÁ∑ë\n            strokeColor = '#4CAF50';\n          } else {\n            fillColor = '#FFB3B3'; // Ê∑°„ÅÑËµ§\n            strokeColor = '#f44336';\n          }\n        } else if (isAttempted) {\n          // Ë©¶Ë°åÊ∏à„Åø„Å†„ÅåÊú™ÂõûÁ≠îÔºöÊ∑°„ÅÑÈùí\n          fillColor = '#ADD8E6';\n          strokeColor = '#2196F3';\n        }\n\n        // ÂãïÁâ©„ÅÆÈ°î„ÇíÊèèÁîª\n        drawAnimalFace(ctx, x, y, boothSize, fillColor, strokeColor, quiz.id, animalType);\n\n        return { id: quiz.id, x, y, size: boothSize };\n      });\n\n      console.log('üé® Canvas rendered with', quizBoothsRef.current.length, 'cute animal faces');\n    } else {\n      console.log('‚è≥ Waiting for quizzes to load...');\n      quizBoothsRef.current = [];\n    }\n  }, [quizzes, solvedQuizzes, quizResponses, attemptedQuizzes]);\n\n  // „Éû„Ç¶„Çπ„ÇØ„É™„ÉÉ„ÇØÂá¶ÁêÜÔºà„Éà„É©„ÉÉ„ÇØ„Éë„ÉÉ„ÉâÂØæÂøúÔºâ\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const handlePointerInteraction = (event) => {\n      const rect = canvas.getBoundingClientRect();\n      const clickX = event.clientX - rect.left;\n      const clickY = event.clientY - rect.top;\n\n      console.log(`üñ±Ô∏è Pointer detected at canvas coordinates: (${Math.round(clickX)}, ${Math.round(clickY)})`);\n      console.log(`üìç Current booth count: ${quizBoothsRef.current.length}`);\n\n      if (quizBoothsRef.current.length === 0) {\n        console.log('‚ö†Ô∏è No booths available yet');\n        return;\n      }\n\n      for (const booth of quizBoothsRef.current) {\n        const dx = clickX - booth.x;\n        const dy = clickY - booth.y;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n\n        // Check if quiz has been answered\n        const isAnswered = quizResponses?.find(r => r.quizId === booth.id);\n        // ÂãïÁâ©„ÅÆÈ°î„ÅÆÈ†≠ÈÉ®ÂàÜ„ÅåÁ¥Ñbooth.size / 2„ÅÆÂçäÂæÑ„Å™„ÅÆ„Åß„ÄÅ„ÇØ„É™„ÉÉ„ÇØÂà§ÂÆö„ÇÇ„Åù„Çå„Å´Âêà„Çè„Åõ„Çã\n        const clickThreshold = booth.size / 2 + 10; // Â∞ë„Åó‰ΩôË£ï„ÇíÊåÅ„Åü„Åõ„Çã\n        console.log(`  Booth ${booth.id}: distance=${Math.round(distance)}, threshold=${clickThreshold}, answered=${!!isAnswered}`);\n\n        if (distance < clickThreshold && !isAnswered) {\n          console.log(`‚úÖ Clicked booth: ${booth.id}`);\n          // Record attempt when opening quiz\n          if (onQuizAttempt) {\n            onQuizAttempt(booth.id);\n          }\n          setActiveQuizId(booth.id);\n          activeQuizRef.current = booth.id;\n          event.preventDefault();\n          break;\n        }\n      }\n    };\n\n    // Ë§áÊï∞„ÅÆ„Ç§„Éô„É≥„Éà„Çø„Ç§„Éó„Çí„É™„Çπ„É≥\n    canvas.addEventListener('click', handlePointerInteraction);\n    canvas.addEventListener('mousedown', handlePointerInteraction);\n    canvas.addEventListener('touchstart', handlePointerInteraction);\n\n    console.log('‚úÖ Event listeners attached to canvas');\n\n    return () => {\n      canvas.removeEventListener('click', handlePointerInteraction);\n      canvas.removeEventListener('mousedown', handlePointerInteraction);\n      canvas.removeEventListener('touchstart', handlePointerInteraction);\n      console.log('üßπ Event listeners removed from canvas');\n    };\n  }, []);\n\n  // „Éá„Éº„ÇøÂèéÈõÜÈñãÂßã\n  useEffect(() => {\n    if (!isInitialized || !sessionId) return;\n\n    dataCollectorRef.current = new DataCollector(sessionId);\n    dataCollectorRef.current.start();\n\n    return () => {\n      if (dataCollectorRef.current) {\n        dataCollectorRef.current.stop();\n      }\n    };\n  }, [isInitialized, sessionId]);\n\n  const handleQuizClose = async (quizId, isCorrect) => {\n    // „ÇØ„Ç§„Ç∫ÂõûÁ≠î„Éá„Éº„Çø„ÇíË®òÈå≤\n    if (onQuizResponse) {\n      onQuizResponse(quizId, isCorrect);\n    }\n\n    setSolvedQuizzes(prev => new Set(prev).add(quizId));\n    setActiveQuizId(null);\n\n    // „Åô„Åπ„Å¶„ÅÆ„ÇØ„Ç§„Ç∫„Å´ÂõûÁ≠î„Åó„Åü„ÅãÁ¢∫Ë™ç\n    // quizResponses„ÅØÊõ¥Êñ∞‰∏≠„ÅÆÂèØËÉΩÊÄß„Åå„ÅÇ„Çã„Åü„ÇÅ„ÄÅÊâãÂãï„ÅßË®àÁÆó\n    const totalAnswered = (quizResponses?.length || 0) + (isCorrect !== null ? 1 : 0);\n    if (totalAnswered === quizzes.length) {\n      onGameEnd({ reason: 'completed' });\n    }\n  };\n\n  return (\n    <div className=\"game-scene\">\n      <div ref={containerRef} className=\"three-container\"></div>\n\n      {/* UI „Ç™„Éº„Éê„Éº„É¨„Ç§ */}\n      <div className=\"game-ui\">\n        {/* „Çø„Ç§„Éû„Éº */}\n        <div className={`timer ${remainingTime < 60 ? 'warning' : ''}`}>\n          <span className=\"label\">Âà∂ÈôêÊôÇÈñì:</span>\n          <span className=\"time\">{formattedTime}</span>\n        </div>\n\n        {/* ÈÄ≤Êçó */}\n        <div className=\"progress\">\n          <span className=\"label\">ÂõûÁ≠î„Åó„ÅüÂïèÈ°å:</span>\n          <span className=\"count\">{quizResponses.length} / {quizzes.length}</span>\n        </div>\n      </div>\n\n      {/* „ÇØ„Ç§„Ç∫„Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóÔºàUI „Çà„Çä‰∏ä„Å´ÈÖçÁΩÆÔºâ */}\n      {activeQuizId && (\n        <QuizBooth\n          quiz={quizzes.find(q => q.id === activeQuizId)}\n          difficulty={difficulty}\n          onClose={handleQuizClose}\n          dataCollector={dataCollectorRef.current}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default GameScene;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}