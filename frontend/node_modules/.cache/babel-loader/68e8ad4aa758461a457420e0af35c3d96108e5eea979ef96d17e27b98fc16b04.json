{"ast":null,"code":"import { Camera } from \"../../Cameras/camera.js\";\nimport { UniversalCamera } from \"../../Cameras/universalCamera.js\";\nimport { Matrix, Vector3 } from \"../../Maths/math.vector.js\";\nimport { TargetCamera } from \"../targetCamera.js\";\nimport { TransformNode } from \"../../Meshes/transformNode.js\";\nimport { Viewport } from \"../../Maths/math.viewport.js\";\n/**\n * Camera used to simulate stereoscopic rendering on real screens (based on UniversalCamera)\n * @see https://doc.babylonjs.com/features/featuresDeepDive/cameras\n */\nexport class StereoscopicScreenUniversalCamera extends UniversalCamera {\n  set distanceBetweenEyes(newValue) {\n    this._distanceBetweenEyes = newValue;\n  }\n  /**\n   * distance between the eyes\n   */\n  get distanceBetweenEyes() {\n    return this._distanceBetweenEyes;\n  }\n  set distanceToProjectionPlane(newValue) {\n    this._distanceToProjectionPlane = newValue;\n  }\n  /**\n   * Distance to projection plane (should be the same units the like distance between the eyes)\n   */\n  get distanceToProjectionPlane() {\n    return this._distanceToProjectionPlane;\n  }\n  /**\n   * Creates a new StereoscopicScreenUniversalCamera\n   * @param name defines camera name\n   * @param position defines initial position\n   * @param scene defines the hosting scene\n   * @param distanceToProjectionPlane defines distance between each color axis. The rig cameras will receive this as their negative z position!\n   * @param distanceBetweenEyes defines is stereoscopic is done side by side or over under\n   */\n  constructor(name, position, scene, distanceToProjectionPlane = 1, distanceBetweenEyes = 0.065) {\n    super(name, position, scene);\n    this._distanceBetweenEyes = distanceBetweenEyes;\n    this._distanceToProjectionPlane = distanceToProjectionPlane;\n    this.setCameraRigMode(Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL, {\n      stereoHalfAngle: 0\n    });\n    this._cameraRigParams.stereoHalfAngle = 0;\n    this._cameraRigParams.interaxialDistance = distanceBetweenEyes;\n  }\n  /**\n   * Gets camera class name\n   * @returns StereoscopicScreenUniversalCamera\n   */\n  getClassName() {\n    return \"StereoscopicUniversalCamera\";\n  }\n  /**\n   * @internal\n   */\n  createRigCamera(name) {\n    const camera = new TargetCamera(name, Vector3.Zero(), this.getScene());\n    const transform = new TransformNode(\"tm_\" + name, this.getScene());\n    camera.parent = transform;\n    transform.setPivotMatrix(Matrix.Identity(), false);\n    camera.isRigCamera = true;\n    camera.rigParent = this;\n    return camera;\n  }\n  /**\n   * @internal\n   */\n  _updateRigCameras() {\n    for (let cameraIndex = 0; cameraIndex < this._rigCameras.length; cameraIndex++) {\n      const cam = this._rigCameras[cameraIndex];\n      cam.minZ = this.minZ;\n      cam.maxZ = this.maxZ;\n      cam.fov = this.fov;\n      cam.upVector.copyFrom(this.upVector);\n      if (cam.rotationQuaternion) {\n        cam.rotationQuaternion.copyFrom(this.rotationQuaternion);\n      } else {\n        cam.rotation.copyFrom(this.rotation);\n      }\n      this._updateCamera(this._rigCameras[cameraIndex], cameraIndex);\n    }\n  }\n  _updateCamera(camera, cameraIndex) {\n    const b = this.distanceBetweenEyes / 2;\n    const z = b / this.distanceToProjectionPlane;\n    camera.position.copyFrom(this.position);\n    camera.position.addInPlaceFromFloats(cameraIndex === 0 ? -b : b, 0, -this._distanceToProjectionPlane);\n    const transform = camera.parent;\n    const m = transform.getPivotMatrix();\n    m.setTranslationFromFloats(cameraIndex === 0 ? b : -b, 0, 0);\n    m.setRowFromFloats(2, cameraIndex === 0 ? z : -z, 0, 1, 0);\n    transform.setPivotMatrix(m, false);\n  }\n  _setRigMode() {\n    this._rigCameras[0].viewport = new Viewport(0, 0, 0.5, 1);\n    this._rigCameras[1].viewport = new Viewport(0.5, 0, 0.5, 1.0);\n    for (let cameraIndex = 0; cameraIndex < this._rigCameras.length; cameraIndex++) {\n      this._updateCamera(this._rigCameras[cameraIndex], cameraIndex);\n    }\n  }\n}\n//# sourceMappingURL=stereoscopicScreenUniversalCamera.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}