{"ast":null,"code":"import { EventConstants } from \"../Events/deviceInputEvents.js\";\nimport { DeviceType, NativePointerInput, PointerInput } from \"./InputDevices/deviceEnums.js\";\n/**\n * Class to wrap DeviceInputSystem data into an event object\n */\nexport class DeviceEventFactory {\n  /**\n   * Create device input events based on provided type and slot\n   *\n   * @param deviceType Type of device\n   * @param deviceSlot \"Slot\" or index that device is referenced in\n   * @param inputIndex Id of input to be checked\n   * @param currentState Current value for given input\n   * @param deviceInputSystem Reference to DeviceInputSystem\n   * @param elementToAttachTo HTMLElement to reference as target for inputs\n   * @param pointerId PointerId to use for pointer events\n   * @returns IUIEvent object\n   */\n  static CreateDeviceEvent(deviceType, deviceSlot, inputIndex, currentState, deviceInputSystem, elementToAttachTo, pointerId) {\n    switch (deviceType) {\n      case DeviceType.Keyboard:\n        return this._CreateKeyboardEvent(inputIndex, currentState, deviceInputSystem, elementToAttachTo);\n      case DeviceType.Mouse:\n        if (inputIndex === PointerInput.MouseWheelX || inputIndex === PointerInput.MouseWheelY || inputIndex === PointerInput.MouseWheelZ) {\n          return this._CreateWheelEvent(deviceType, deviceSlot, inputIndex, currentState, deviceInputSystem, elementToAttachTo);\n        }\n      // eslint-disable-next-line no-fallthrough\n      case DeviceType.Touch:\n        return this._CreatePointerEvent(deviceType, deviceSlot, inputIndex, currentState, deviceInputSystem, elementToAttachTo, pointerId);\n      default:\n        // eslint-disable-next-line no-throw-literal\n        throw `Unable to generate event for device ${DeviceType[deviceType]}`;\n    }\n  }\n  /**\n   * Creates pointer event\n   *\n   * @param deviceType Type of device\n   * @param deviceSlot \"Slot\" or index that device is referenced in\n   * @param inputIndex Id of input to be checked\n   * @param currentState Current value for given input\n   * @param deviceInputSystem Reference to DeviceInputSystem\n   * @param elementToAttachTo HTMLElement to reference as target for inputs\n   * @param pointerId PointerId to use for pointer events\n   * @returns IUIEvent object (Pointer)\n   */\n  static _CreatePointerEvent(deviceType, deviceSlot, inputIndex, currentState, deviceInputSystem, elementToAttachTo, pointerId) {\n    const evt = this._CreateMouseEvent(deviceType, deviceSlot, inputIndex, currentState, deviceInputSystem, elementToAttachTo);\n    if (deviceType === DeviceType.Mouse) {\n      evt.deviceType = DeviceType.Mouse;\n      evt.pointerId = 1;\n      evt.pointerType = \"mouse\";\n    } else {\n      evt.deviceType = DeviceType.Touch;\n      evt.pointerId = pointerId ?? deviceSlot;\n      evt.pointerType = \"touch\";\n    }\n    let buttons = 0;\n    // Populate buttons property with current state of all mouse buttons\n    // Uses values found on: https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/buttons\n    buttons += deviceInputSystem.pollInput(deviceType, deviceSlot, PointerInput.LeftClick);\n    buttons += deviceInputSystem.pollInput(deviceType, deviceSlot, PointerInput.RightClick) * 2;\n    buttons += deviceInputSystem.pollInput(deviceType, deviceSlot, PointerInput.MiddleClick) * 4;\n    evt.buttons = buttons;\n    if (inputIndex === PointerInput.Move) {\n      evt.type = \"pointermove\";\n    } else if (inputIndex >= PointerInput.LeftClick && inputIndex <= PointerInput.RightClick) {\n      evt.type = currentState === 1 ? \"pointerdown\" : \"pointerup\";\n      evt.button = inputIndex - 2;\n    }\n    return evt;\n  }\n  /**\n   * Create Mouse Wheel Event\n   * @param deviceType Type of device\n   * @param deviceSlot \"Slot\" or index that device is referenced in\n   * @param inputIndex Id of input to be checked\n   * @param currentState Current value for given input\n   * @param deviceInputSystem Reference to DeviceInputSystem\n   * @param elementToAttachTo HTMLElement to reference as target for inputs\n   * @returns IUIEvent object (Wheel)\n   */\n  static _CreateWheelEvent(deviceType, deviceSlot, inputIndex, currentState, deviceInputSystem, elementToAttachTo) {\n    const evt = this._CreateMouseEvent(deviceType, deviceSlot, inputIndex, currentState, deviceInputSystem, elementToAttachTo);\n    // While WheelEvents don't generally have a pointerId, we used to add one in the InputManager\n    // This line has been added to make the InputManager more platform-agnostic\n    // Similar code exists in the WebDeviceInputSystem to handle browser created events\n    evt.pointerId = 1;\n    evt.type = \"wheel\";\n    evt.deltaMode = EventConstants.DOM_DELTA_PIXEL;\n    evt.deltaX = 0;\n    evt.deltaY = 0;\n    evt.deltaZ = 0;\n    switch (inputIndex) {\n      case PointerInput.MouseWheelX:\n        evt.deltaX = currentState;\n        break;\n      case PointerInput.MouseWheelY:\n        evt.deltaY = currentState;\n        break;\n      case PointerInput.MouseWheelZ:\n        evt.deltaZ = currentState;\n        break;\n    }\n    return evt;\n  }\n  /**\n   * Create Mouse Event\n   * @param deviceType Type of device\n   * @param deviceSlot \"Slot\" or index that device is referenced in\n   * @param inputIndex Id of input to be checked\n   * @param currentState Current value for given input\n   * @param deviceInputSystem Reference to DeviceInputSystem\n   * @param elementToAttachTo HTMLElement to reference as target for inputs\n   * @returns IUIEvent object (Mouse)\n   */\n  static _CreateMouseEvent(deviceType, deviceSlot, inputIndex, currentState, deviceInputSystem, elementToAttachTo) {\n    const evt = this._CreateEvent(elementToAttachTo);\n    const pointerX = deviceInputSystem.pollInput(deviceType, deviceSlot, PointerInput.Horizontal);\n    const pointerY = deviceInputSystem.pollInput(deviceType, deviceSlot, PointerInput.Vertical);\n    // Handle offsets/deltas based on existence of HTMLElement\n    if (elementToAttachTo) {\n      evt.movementX = 0;\n      evt.movementY = 0;\n      evt.offsetX = evt.movementX - elementToAttachTo.getBoundingClientRect().x;\n      evt.offsetY = evt.movementY - elementToAttachTo.getBoundingClientRect().y;\n    } else {\n      evt.movementX = deviceInputSystem.pollInput(deviceType, deviceSlot, NativePointerInput.DeltaHorizontal); // DeltaHorizontal\n      evt.movementY = deviceInputSystem.pollInput(deviceType, deviceSlot, NativePointerInput.DeltaVertical); // DeltaVertical\n      evt.offsetX = 0;\n      evt.offsetY = 0;\n    }\n    this._CheckNonCharacterKeys(evt, deviceInputSystem);\n    evt.clientX = pointerX;\n    evt.clientY = pointerY;\n    evt.x = pointerX;\n    evt.y = pointerY;\n    evt.deviceType = deviceType;\n    evt.deviceSlot = deviceSlot;\n    evt.inputIndex = inputIndex;\n    return evt;\n  }\n  /**\n   * Create Keyboard Event\n   * @param inputIndex Id of input to be checked\n   * @param currentState Current value for given input\n   * @param deviceInputSystem Reference to DeviceInputSystem\n   * @param elementToAttachTo HTMLElement to reference as target for inputs\n   * @returns IEvent object (Keyboard)\n   */\n  static _CreateKeyboardEvent(inputIndex, currentState, deviceInputSystem, elementToAttachTo) {\n    const evt = this._CreateEvent(elementToAttachTo);\n    this._CheckNonCharacterKeys(evt, deviceInputSystem);\n    evt.deviceType = DeviceType.Keyboard;\n    evt.deviceSlot = 0;\n    evt.inputIndex = inputIndex;\n    evt.type = currentState === 1 ? \"keydown\" : \"keyup\";\n    evt.key = String.fromCharCode(inputIndex);\n    evt.keyCode = inputIndex;\n    return evt;\n  }\n  /**\n   * Add parameters for non-character keys (Ctrl, Alt, Meta, Shift)\n   * @param evt Event object to add parameters to\n   * @param deviceInputSystem DeviceInputSystem to pull values from\n   */\n  static _CheckNonCharacterKeys(evt, deviceInputSystem) {\n    const isKeyboardActive = deviceInputSystem.isDeviceAvailable(DeviceType.Keyboard);\n    const altKey = isKeyboardActive && deviceInputSystem.pollInput(DeviceType.Keyboard, 0, 18) === 1;\n    const ctrlKey = isKeyboardActive && deviceInputSystem.pollInput(DeviceType.Keyboard, 0, 17) === 1;\n    const metaKey = isKeyboardActive && (deviceInputSystem.pollInput(DeviceType.Keyboard, 0, 91) === 1 || deviceInputSystem.pollInput(DeviceType.Keyboard, 0, 92) === 1 || deviceInputSystem.pollInput(DeviceType.Keyboard, 0, 93) === 1);\n    const shiftKey = isKeyboardActive && deviceInputSystem.pollInput(DeviceType.Keyboard, 0, 16) === 1;\n    evt.altKey = altKey;\n    evt.ctrlKey = ctrlKey;\n    evt.metaKey = metaKey;\n    evt.shiftKey = shiftKey;\n  }\n  /**\n   * Create base event object\n   * @param elementToAttachTo Value to use as event target\n   * @returns\n   */\n  static _CreateEvent(elementToAttachTo) {\n    const evt = {};\n    evt.preventDefault = () => {};\n    evt.target = elementToAttachTo;\n    return evt;\n  }\n}\n//# sourceMappingURL=eventFactory.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}