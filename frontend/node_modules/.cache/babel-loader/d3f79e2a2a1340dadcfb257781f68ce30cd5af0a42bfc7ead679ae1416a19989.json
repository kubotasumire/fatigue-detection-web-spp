{"ast":null,"code":"import { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\n/**\n * Block used for the particle ramp gradient section\n */\nexport class ParticleRampGradientBlock extends NodeMaterialBlock {\n  /**\n   * Create a new ParticleRampGradientBlock\n   * @param name defines the block name\n   */\n  constructor(name) {\n    super(name, NodeMaterialBlockTargets.Fragment);\n    this._isUnique = true;\n    this.registerInput(\"color\", NodeMaterialBlockConnectionPointTypes.Color4, false, NodeMaterialBlockTargets.Fragment);\n    this.registerOutput(\"rampColor\", NodeMaterialBlockConnectionPointTypes.Color4, NodeMaterialBlockTargets.Fragment);\n  }\n  /**\n   * Gets the current class name\n   * @returns the class name\n   */\n  getClassName() {\n    return \"ParticleRampGradientBlock\";\n  }\n  /**\n   * Gets the color input component\n   */\n  get color() {\n    return this._inputs[0];\n  }\n  /**\n   * Gets the rampColor output component\n   */\n  get rampColor() {\n    return this._outputs[0];\n  }\n  /**\n   * Initialize the block and prepare the context for build\n   * @param state defines the state that will be used for the build\n   */\n  initialize(state) {\n    state._excludeVariableName(\"remapRanges\");\n    state._excludeVariableName(\"rampSampler\");\n    state._excludeVariableName(\"baseColor\");\n    state._excludeVariableName(\"alpha\");\n    state._excludeVariableName(\"remappedColorIndex\");\n    state._excludeVariableName(\"rampColor\");\n    state._excludeVariableName(\"finalAlpha\");\n  }\n  _buildBlock(state) {\n    super._buildBlock(state);\n    if (state.target === NodeMaterialBlockTargets.Vertex) {\n      return;\n    }\n    state._emit2DSampler(\"rampSampler\");\n    state._emitVaryingFromString(\"remapRanges\", \"vec4\", \"RAMPGRADIENT\");\n    state.compilationString += `\n            #ifdef RAMPGRADIENT\n                vec4 baseColor = ${this.color.associatedVariableName};\n                float alpha = ${this.color.associatedVariableName}.a;\n\n                float remappedColorIndex = clamp((alpha - remapRanges.x) / remapRanges.y, 0.0, 1.0);\n\n                vec4 rampColor = texture2D(rampSampler, vec2(1.0 - remappedColorIndex, 0.));\n                baseColor.rgb *= rampColor.rgb;\n\n                // Remapped alpha\n                float finalAlpha = baseColor.a;\n                baseColor.a = clamp((alpha * rampColor.a - remapRanges.z) / remapRanges.w, 0.0, 1.0);\n\n                ${this._declareOutput(this.rampColor, state)} = baseColor;\n            #else\n                ${this._declareOutput(this.rampColor, state)} = ${this.color.associatedVariableName};\n            #endif\n        `;\n    return this;\n  }\n}\nRegisterClass(\"BABYLON.ParticleRampGradientBlock\", ParticleRampGradientBlock);\n//# sourceMappingURL=particleRampGradientBlock.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}