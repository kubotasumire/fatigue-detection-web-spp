{"ast":null,"code":"import { __decorate } from \"../../tslib.es6.js\";\nimport { serialize } from \"../../Misc/decorators.js\";\nimport { CameraInputTypes } from \"../../Cameras/cameraInputsManager.js\";\nimport { KeyboardEventTypes } from \"../../Events/keyboardEvents.js\";\nimport { Vector3 } from \"../../Maths/math.vector.js\";\nimport { Tools } from \"../../Misc/tools.js\";\n/**\n * Manage the keyboard inputs to control the movement of a free camera.\n * @see https://doc.babylonjs.com/features/featuresDeepDive/cameras/customizingCameraInputs\n */\nexport class FreeCameraKeyboardMoveInput {\n  constructor() {\n    /**\n     * Gets or Set the list of keyboard keys used to control the forward move of the camera.\n     */\n    this.keysUp = [38];\n    /**\n     * Gets or Set the list of keyboard keys used to control the upward move of the camera.\n     */\n    this.keysUpward = [33];\n    /**\n     * Gets or Set the list of keyboard keys used to control the backward move of the camera.\n     */\n    this.keysDown = [40];\n    /**\n     * Gets or Set the list of keyboard keys used to control the downward move of the camera.\n     */\n    this.keysDownward = [34];\n    /**\n     * Gets or Set the list of keyboard keys used to control the left strafe move of the camera.\n     */\n    this.keysLeft = [37];\n    /**\n     * Gets or Set the list of keyboard keys used to control the right strafe move of the camera.\n     */\n    this.keysRight = [39];\n    /**\n     * Defines the pointer angular sensibility  along the X and Y axis or how fast is the camera rotating.\n     */\n    this.rotationSpeed = 0.5;\n    /**\n     * Gets or Set the list of keyboard keys used to control the left rotation move of the camera.\n     */\n    this.keysRotateLeft = [];\n    /**\n     * Gets or Set the list of keyboard keys used to control the right rotation move of the camera.\n     */\n    this.keysRotateRight = [];\n    /**\n     * Gets or Set the list of keyboard keys used to control the up rotation move of the camera.\n     */\n    this.keysRotateUp = [];\n    /**\n     * Gets or Set the list of keyboard keys used to control the down rotation move of the camera.\n     */\n    this.keysRotateDown = [];\n    this._keys = new Array();\n  }\n  /**\n   * Attach the input controls to a specific dom element to get the input from.\n   * @param noPreventDefault Defines whether event caught by the controls should call preventdefault() (https://developer.mozilla.org/en-US/docs/Web/API/Event/preventDefault)\n   */\n  attachControl(noPreventDefault) {\n    // eslint-disable-next-line prefer-rest-params\n    noPreventDefault = Tools.BackCompatCameraNoPreventDefault(arguments);\n    if (this._onCanvasBlurObserver) {\n      return;\n    }\n    this._scene = this.camera.getScene();\n    this._engine = this._scene.getEngine();\n    this._onCanvasBlurObserver = this._engine.onCanvasBlurObservable.add(() => {\n      this._keys.length = 0;\n    });\n    this._onKeyboardObserver = this._scene.onKeyboardObservable.add(info => {\n      const evt = info.event;\n      if (!evt.metaKey) {\n        if (info.type === KeyboardEventTypes.KEYDOWN) {\n          if (this.keysUp.indexOf(evt.keyCode) !== -1 || this.keysDown.indexOf(evt.keyCode) !== -1 || this.keysLeft.indexOf(evt.keyCode) !== -1 || this.keysRight.indexOf(evt.keyCode) !== -1 || this.keysUpward.indexOf(evt.keyCode) !== -1 || this.keysDownward.indexOf(evt.keyCode) !== -1 || this.keysRotateLeft.indexOf(evt.keyCode) !== -1 || this.keysRotateRight.indexOf(evt.keyCode) !== -1 || this.keysRotateUp.indexOf(evt.keyCode) !== -1 || this.keysRotateDown.indexOf(evt.keyCode) !== -1) {\n            const index = this._keys.indexOf(evt.keyCode);\n            if (index === -1) {\n              this._keys.push(evt.keyCode);\n            }\n            if (!noPreventDefault) {\n              evt.preventDefault();\n            }\n          }\n        } else {\n          if (this.keysUp.indexOf(evt.keyCode) !== -1 || this.keysDown.indexOf(evt.keyCode) !== -1 || this.keysLeft.indexOf(evt.keyCode) !== -1 || this.keysRight.indexOf(evt.keyCode) !== -1 || this.keysUpward.indexOf(evt.keyCode) !== -1 || this.keysDownward.indexOf(evt.keyCode) !== -1 || this.keysRotateLeft.indexOf(evt.keyCode) !== -1 || this.keysRotateRight.indexOf(evt.keyCode) !== -1 || this.keysRotateUp.indexOf(evt.keyCode) !== -1 || this.keysRotateDown.indexOf(evt.keyCode) !== -1) {\n            const index = this._keys.indexOf(evt.keyCode);\n            if (index >= 0) {\n              this._keys.splice(index, 1);\n            }\n            if (!noPreventDefault) {\n              evt.preventDefault();\n            }\n          }\n        }\n      }\n    });\n  }\n  /**\n   * Detach the current controls from the specified dom element.\n   */\n  detachControl() {\n    if (this._scene) {\n      if (this._onKeyboardObserver) {\n        this._scene.onKeyboardObservable.remove(this._onKeyboardObserver);\n      }\n      if (this._onCanvasBlurObserver) {\n        this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver);\n      }\n      this._onKeyboardObserver = null;\n      this._onCanvasBlurObserver = null;\n    }\n    this._keys.length = 0;\n  }\n  /**\n   * Update the current camera state depending on the inputs that have been used this frame.\n   * This is a dynamically created lambda to avoid the performance penalty of looping for inputs in the render loop.\n   */\n  checkInputs() {\n    if (this._onKeyboardObserver) {\n      const camera = this.camera;\n      // Keyboard\n      for (let index = 0; index < this._keys.length; index++) {\n        const keyCode = this._keys[index];\n        const speed = camera._computeLocalCameraSpeed();\n        if (this.keysLeft.indexOf(keyCode) !== -1) {\n          camera._localDirection.copyFromFloats(-speed, 0, 0);\n        } else if (this.keysUp.indexOf(keyCode) !== -1) {\n          camera._localDirection.copyFromFloats(0, 0, speed);\n        } else if (this.keysRight.indexOf(keyCode) !== -1) {\n          camera._localDirection.copyFromFloats(speed, 0, 0);\n        } else if (this.keysDown.indexOf(keyCode) !== -1) {\n          camera._localDirection.copyFromFloats(0, 0, -speed);\n        } else if (this.keysUpward.indexOf(keyCode) !== -1) {\n          camera._localDirection.copyFromFloats(0, speed, 0);\n        } else if (this.keysDownward.indexOf(keyCode) !== -1) {\n          camera._localDirection.copyFromFloats(0, -speed, 0);\n        } else if (this.keysRotateLeft.indexOf(keyCode) !== -1) {\n          camera._localDirection.copyFromFloats(0, 0, 0);\n          camera.cameraRotation.y -= this._getLocalRotation();\n        } else if (this.keysRotateRight.indexOf(keyCode) !== -1) {\n          camera._localDirection.copyFromFloats(0, 0, 0);\n          camera.cameraRotation.y += this._getLocalRotation();\n        } else if (this.keysRotateUp.indexOf(keyCode) !== -1) {\n          camera._localDirection.copyFromFloats(0, 0, 0);\n          camera.cameraRotation.x -= this._getLocalRotation();\n        } else if (this.keysRotateDown.indexOf(keyCode) !== -1) {\n          camera._localDirection.copyFromFloats(0, 0, 0);\n          camera.cameraRotation.x += this._getLocalRotation();\n        }\n        if (camera.getScene().useRightHandedSystem) {\n          camera._localDirection.z *= -1;\n        }\n        camera.getViewMatrix().invertToRef(camera._cameraTransformMatrix);\n        Vector3.TransformNormalToRef(camera._localDirection, camera._cameraTransformMatrix, camera._transformedDirection);\n        camera.cameraDirection.addInPlace(camera._transformedDirection);\n      }\n    }\n  }\n  /**\n   * Gets the class name of the current input.\n   * @returns the class name\n   */\n  getClassName() {\n    return \"FreeCameraKeyboardMoveInput\";\n  }\n  /** @internal */\n  _onLostFocus() {\n    this._keys.length = 0;\n  }\n  /**\n   * Get the friendly name associated with the input class.\n   * @returns the input friendly name\n   */\n  getSimpleName() {\n    return \"keyboard\";\n  }\n  _getLocalRotation() {\n    const handednessMultiplier = this.camera._calculateHandednessMultiplier();\n    const rotation = this.rotationSpeed * this._engine.getDeltaTime() / 1000 * handednessMultiplier;\n    return rotation;\n  }\n}\n__decorate([serialize()], FreeCameraKeyboardMoveInput.prototype, \"keysUp\", void 0);\n__decorate([serialize()], FreeCameraKeyboardMoveInput.prototype, \"keysUpward\", void 0);\n__decorate([serialize()], FreeCameraKeyboardMoveInput.prototype, \"keysDown\", void 0);\n__decorate([serialize()], FreeCameraKeyboardMoveInput.prototype, \"keysDownward\", void 0);\n__decorate([serialize()], FreeCameraKeyboardMoveInput.prototype, \"keysLeft\", void 0);\n__decorate([serialize()], FreeCameraKeyboardMoveInput.prototype, \"keysRight\", void 0);\n__decorate([serialize()], FreeCameraKeyboardMoveInput.prototype, \"rotationSpeed\", void 0);\n__decorate([serialize()], FreeCameraKeyboardMoveInput.prototype, \"keysRotateLeft\", void 0);\n__decorate([serialize()], FreeCameraKeyboardMoveInput.prototype, \"keysRotateRight\", void 0);\n__decorate([serialize()], FreeCameraKeyboardMoveInput.prototype, \"keysRotateUp\", void 0);\n__decorate([serialize()], FreeCameraKeyboardMoveInput.prototype, \"keysRotateDown\", void 0);\nCameraInputTypes[\"FreeCameraKeyboardMoveInput\"] = FreeCameraKeyboardMoveInput;\n//# sourceMappingURL=freeCameraKeyboardMoveInput.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}