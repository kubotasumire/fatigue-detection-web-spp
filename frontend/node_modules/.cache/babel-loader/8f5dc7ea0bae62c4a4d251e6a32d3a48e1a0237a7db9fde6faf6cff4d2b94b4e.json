{"ast":null,"code":"import { Observable } from \"../Misc/observable.js\";\nimport { Vector2, Vector3 } from \"../Maths/math.vector.js\";\nimport { Color3, Color4 } from \"../Maths/math.color.js\";\nimport { RegisterClass } from \"../Misc/typeStore.js\";\n/**\n * The action to be carried out following a trigger\n * @see https://doc.babylonjs.com/features/featuresDeepDive/events/actions#available-actions\n */\nexport class Action {\n  /**\n   * Creates a new Action\n   * @param triggerOptions the trigger, with or without parameters, for the action\n   * @param condition an optional determinant of action\n   */\n  constructor(/** the trigger, with or without parameters, for the action */\n  triggerOptions, condition) {\n    this.triggerOptions = triggerOptions;\n    /**\n     * An event triggered prior to action being executed.\n     */\n    this.onBeforeExecuteObservable = new Observable();\n    if (triggerOptions.parameter) {\n      this.trigger = triggerOptions.trigger;\n      this._triggerParameter = triggerOptions.parameter;\n    } else if (triggerOptions.trigger) {\n      this.trigger = triggerOptions.trigger;\n    } else {\n      this.trigger = triggerOptions;\n    }\n    this._nextActiveAction = this;\n    this._condition = condition;\n  }\n  /**\n   * Internal only\n   * @internal\n   */\n  _prepare() {}\n  /**\n   * Gets the trigger parameter\n   * @returns the trigger parameter\n   */\n  getTriggerParameter() {\n    return this._triggerParameter;\n  }\n  /**\n   * Sets the trigger parameter\n   * @param value defines the new trigger parameter\n   */\n  setTriggerParameter(value) {\n    this._triggerParameter = value;\n  }\n  /**\n   * Internal only - Returns if the current condition allows to run the action\n   * @internal\n   */\n  _evaluateConditionForCurrentFrame() {\n    const condition = this._condition;\n    if (!condition) {\n      return true;\n    }\n    const currentRenderId = this._actionManager.getScene().getRenderId();\n    // We cache the current evaluation for the current frame\n    if (condition._evaluationId !== currentRenderId) {\n      condition._evaluationId = currentRenderId;\n      condition._currentResult = condition.isValid();\n    }\n    return condition._currentResult;\n  }\n  /**\n   * Internal only - executes current action event\n   * @internal\n   */\n  _executeCurrent(evt) {\n    const isConditionValid = this._evaluateConditionForCurrentFrame();\n    if (!isConditionValid) {\n      return;\n    }\n    this.onBeforeExecuteObservable.notifyObservers(this);\n    this._nextActiveAction.execute(evt);\n    this.skipToNextActiveAction();\n  }\n  /**\n   * Execute placeholder for child classes\n   * @param evt optional action event\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  execute(evt) {}\n  /**\n   * Skips to next active action\n   */\n  skipToNextActiveAction() {\n    if (this._nextActiveAction._child) {\n      if (!this._nextActiveAction._child._actionManager) {\n        this._nextActiveAction._child._actionManager = this._actionManager;\n      }\n      this._nextActiveAction = this._nextActiveAction._child;\n    } else {\n      this._nextActiveAction = this;\n    }\n  }\n  /**\n   * Adds action to chain of actions, may be a DoNothingAction\n   * @param action defines the next action to execute\n   * @returns The action passed in\n   * @see https://www.babylonjs-playground.com/#1T30HR#0\n   */\n  then(action) {\n    this._child = action;\n    action._actionManager = this._actionManager;\n    action._prepare();\n    return action;\n  }\n  /**\n   * Internal only\n   * @internal\n   */\n  _getProperty(propertyPath) {\n    return this._actionManager._getProperty(propertyPath);\n  }\n  /**\n   * @internal\n   */\n  _getEffectiveTarget(target, propertyPath) {\n    return this._actionManager._getEffectiveTarget(target, propertyPath);\n  }\n  /**\n   * Serialize placeholder for child classes\n   * @param parent of child\n   * @returns the serialized object\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  serialize(parent) {\n    return null;\n  }\n  /**\n   * Internal only called by serialize\n   * @internal\n   */\n  _serialize(serializedAction, parent) {\n    const serializationObject = {\n      type: 1,\n      children: [],\n      name: serializedAction.name,\n      properties: serializedAction.properties || []\n    };\n    // Serialize child\n    if (this._child) {\n      this._child.serialize(serializationObject);\n    }\n    // Check if \"this\" has a condition\n    if (this._condition) {\n      const serializedCondition = this._condition.serialize();\n      serializedCondition.children.push(serializationObject);\n      if (parent) {\n        parent.children.push(serializedCondition);\n      }\n      return serializedCondition;\n    }\n    if (parent) {\n      parent.children.push(serializationObject);\n    }\n    return serializationObject;\n  }\n}\n/**\n * Internal only\n * @internal\n */\nAction._SerializeValueAsString = value => {\n  if (typeof value === \"number\") {\n    return value.toString();\n  }\n  if (typeof value === \"boolean\") {\n    return value ? \"true\" : \"false\";\n  }\n  if (value instanceof Vector2) {\n    return value.x + \", \" + value.y;\n  }\n  if (value instanceof Vector3) {\n    return value.x + \", \" + value.y + \", \" + value.z;\n  }\n  if (value instanceof Color3) {\n    return value.r + \", \" + value.g + \", \" + value.b;\n  }\n  if (value instanceof Color4) {\n    return value.r + \", \" + value.g + \", \" + value.b + \", \" + value.a;\n  }\n  return value; // string\n};\n/**\n * Internal only\n * @internal\n */\nAction._GetTargetProperty = target => {\n  return {\n    name: \"target\",\n    targetType: target._isMesh ? \"MeshProperties\" : target._isLight ? \"LightProperties\" : target._isCamera ? \"CameraProperties\" : target._isMaterial ? \"MaterialProperties\" : \"SceneProperties\",\n    value: target._isScene ? \"Scene\" : target.name\n  };\n};\nRegisterClass(\"BABYLON.Action\", Action);\n//# sourceMappingURL=action.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}