{"ast":null,"code":"var _jsxFileName = \"/Users/kubotasumire/Univ./\\u5352\\u8AD6/s-2/fatigue-detection-web-spp/frontend/src/App.jsx\";\nimport React, { useState, useEffect, useRef } from 'react';\nimport StartScreen from './components/StartScreen';\nimport GameScene from './components/GameScene';\nimport EndScreen from './components/EndScreen';\nimport './App.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction App() {\n  const [gameState, setGameState] = useState('start'); // start, playing, end\n  const [selectedDifficulty, setSelectedDifficulty] = useState(null);\n  const [sessionId, setSessionId] = useState(null);\n  const [sessionData, setSessionData] = useState(null);\n  const [quizResponses, setQuizResponses] = useState([]);\n  const [attemptedQuizzes, setAttemptedQuizzes] = useState(new Set());\n  const sessionDataRef = useRef(null);\n\n  // ゲーム開始時\n  const handleDifficultySelect = async difficulty => {\n    const newSessionId = `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    try {\n      // バックエンドにセッション開始を通知\n      const response = await fetch('http://localhost:5001/api/data/session/start', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          difficulty,\n          timestamp: Date.now()\n        })\n      });\n      const data = await response.json();\n      setSelectedDifficulty(difficulty);\n      setSessionId(data.sessionId);\n      setQuizResponses([]); // クイズ回答をリセット\n      setAttemptedQuizzes(new Set()); // 試行済みクイズをリセット\n      setGameState('playing');\n\n      // セッションデータをメモリに保存\n      sessionDataRef.current = {\n        id: data.sessionId,\n        difficulty,\n        startTime: Date.now(),\n        sensorData: [],\n        quizResponses: [],\n        endTime: null\n      };\n    } catch (error) {\n      console.error('Failed to start session:', error);\n    }\n  };\n\n  // クイズ試行を記録（開いたときに呼ばれる）\n  const handleQuizAttempt = quizId => {\n    setAttemptedQuizzes(prev => new Set(prev).add(quizId));\n    console.log(`Quiz attempt recorded: ${quizId}`);\n  };\n\n  // クイズ回答データを記録\n  const handleQuizResponse = (quizId, isCorrect) => {\n    const response = {\n      quizId,\n      isCorrect,\n      timestamp: Date.now()\n    };\n\n    // App.jsx の状態に記録\n    setQuizResponses(prev => [...prev, response]);\n\n    // sessionDataRef にも記録（バックアップ用）\n    if (sessionDataRef.current) {\n      sessionDataRef.current.quizResponses.push(response);\n    }\n    console.log(`Quiz response recorded: ${quizId} - ${isCorrect ? 'correct' : 'incorrect'}`);\n  };\n\n  // ゲーム終了時\n  const handleGameEnd = async reason => {\n    if (!sessionDataRef.current) return;\n    const endTime = Date.now();\n    sessionDataRef.current.endTime = endTime;\n    console.log('=== Game End - Final Session Data ===');\n    console.log('Quiz Responses:', sessionDataRef.current.quizResponses);\n    try {\n      // バックエンドにセッション終了を通知\n      await fetch('http://localhost:5001/api/data/session/end', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          sessionId,\n          timestamp: endTime\n        })\n      });\n\n      // セッションデータを保存して終了画面へ\n      setSessionData(sessionDataRef.current);\n      setGameState('end');\n    } catch (error) {\n      console.error('Failed to end session:', error);\n      setGameState('end');\n    }\n  };\n  const handleTimeUp = () => {\n    console.log('時間終了');\n    handleGameEnd({\n      reason: 'timeup'\n    });\n  };\n\n  // スタート画面に戻る\n  const handleRestart = () => {\n    setGameState('start');\n    setSelectedDifficulty(null);\n    setSessionId(null);\n    setSessionData(null);\n    sessionDataRef.current = null;\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"App\",\n    children: [gameState === 'start' && /*#__PURE__*/_jsxDEV(StartScreen, {\n      onDifficultySelect: handleDifficultySelect\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 33\n    }, this), gameState === 'playing' && /*#__PURE__*/_jsxDEV(GameScene, {\n      difficulty: selectedDifficulty,\n      sessionId: sessionId,\n      onGameEnd: handleGameEnd,\n      onTimeUp: handleTimeUp,\n      onQuizResponse: handleQuizResponse,\n      onQuizAttempt: handleQuizAttempt,\n      quizResponses: quizResponses,\n      attemptedQuizzes: attemptedQuizzes\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 9\n    }, this), gameState === 'end' && sessionData && /*#__PURE__*/_jsxDEV(EndScreen, {\n      sessionData: sessionData,\n      difficulty: selectedDifficulty,\n      onRestart: handleRestart\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 123,\n    columnNumber: 5\n  }, this);\n}\nexport default App;","map":{"version":3,"names":["React","useState","useEffect","useRef","StartScreen","GameScene","EndScreen","jsxDEV","_jsxDEV","App","gameState","setGameState","selectedDifficulty","setSelectedDifficulty","sessionId","setSessionId","sessionData","setSessionData","quizResponses","setQuizResponses","attemptedQuizzes","setAttemptedQuizzes","Set","sessionDataRef","handleDifficultySelect","difficulty","newSessionId","Date","now","Math","random","toString","substr","response","fetch","method","headers","body","JSON","stringify","timestamp","data","json","current","id","startTime","sensorData","endTime","error","console","handleQuizAttempt","quizId","prev","add","log","handleQuizResponse","isCorrect","push","handleGameEnd","reason","handleTimeUp","handleRestart","className","children","onDifficultySelect","fileName","_jsxFileName","lineNumber","columnNumber","onGameEnd","onTimeUp","onQuizResponse","onQuizAttempt","onRestart"],"sources":["/Users/kubotasumire/Univ./卒論/s-2/fatigue-detection-web-spp/frontend/src/App.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport StartScreen from './components/StartScreen';\nimport GameScene from './components/GameScene';\nimport EndScreen from './components/EndScreen';\nimport './App.css';\n\nfunction App() {\n  const [gameState, setGameState] = useState('start'); // start, playing, end\n  const [selectedDifficulty, setSelectedDifficulty] = useState(null);\n  const [sessionId, setSessionId] = useState(null);\n  const [sessionData, setSessionData] = useState(null);\n  const [quizResponses, setQuizResponses] = useState([]);\n  const [attemptedQuizzes, setAttemptedQuizzes] = useState(new Set());\n  const sessionDataRef = useRef(null);\n\n  // ゲーム開始時\n  const handleDifficultySelect = async (difficulty) => {\n    const newSessionId = `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n\n    try {\n      // バックエンドにセッション開始を通知\n      const response = await fetch('http://localhost:5001/api/data/session/start', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          difficulty,\n          timestamp: Date.now()\n        })\n      });\n\n      const data = await response.json();\n\n      setSelectedDifficulty(difficulty);\n      setSessionId(data.sessionId);\n      setQuizResponses([]); // クイズ回答をリセット\n      setAttemptedQuizzes(new Set()); // 試行済みクイズをリセット\n      setGameState('playing');\n\n      // セッションデータをメモリに保存\n      sessionDataRef.current = {\n        id: data.sessionId,\n        difficulty,\n        startTime: Date.now(),\n        sensorData: [],\n        quizResponses: [],\n        endTime: null\n      };\n    } catch (error) {\n      console.error('Failed to start session:', error);\n    }\n  };\n\n  // クイズ試行を記録（開いたときに呼ばれる）\n  const handleQuizAttempt = (quizId) => {\n    setAttemptedQuizzes(prev => new Set(prev).add(quizId));\n    console.log(`Quiz attempt recorded: ${quizId}`);\n  };\n\n  // クイズ回答データを記録\n  const handleQuizResponse = (quizId, isCorrect) => {\n    const response = {\n      quizId,\n      isCorrect,\n      timestamp: Date.now()\n    };\n\n    // App.jsx の状態に記録\n    setQuizResponses(prev => [...prev, response]);\n\n    // sessionDataRef にも記録（バックアップ用）\n    if (sessionDataRef.current) {\n      sessionDataRef.current.quizResponses.push(response);\n    }\n\n    console.log(`Quiz response recorded: ${quizId} - ${isCorrect ? 'correct' : 'incorrect'}`);\n  };\n\n  // ゲーム終了時\n  const handleGameEnd = async (reason) => {\n    if (!sessionDataRef.current) return;\n\n    const endTime = Date.now();\n    sessionDataRef.current.endTime = endTime;\n\n    console.log('=== Game End - Final Session Data ===');\n    console.log('Quiz Responses:', sessionDataRef.current.quizResponses);\n\n    try {\n      // バックエンドにセッション終了を通知\n      await fetch('http://localhost:5001/api/data/session/end', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          sessionId,\n          timestamp: endTime\n        })\n      });\n\n      // セッションデータを保存して終了画面へ\n      setSessionData(sessionDataRef.current);\n      setGameState('end');\n    } catch (error) {\n      console.error('Failed to end session:', error);\n      setGameState('end');\n    }\n  };\n\n  const handleTimeUp = () => {\n    console.log('時間終了');\n    handleGameEnd({ reason: 'timeup' });\n  };\n\n  // スタート画面に戻る\n  const handleRestart = () => {\n    setGameState('start');\n    setSelectedDifficulty(null);\n    setSessionId(null);\n    setSessionData(null);\n    sessionDataRef.current = null;\n  };\n\n  return (\n    <div className=\"App\">\n      {gameState === 'start' && <StartScreen onDifficultySelect={handleDifficultySelect} />}\n\n      {gameState === 'playing' && (\n        <GameScene\n          difficulty={selectedDifficulty}\n          sessionId={sessionId}\n          onGameEnd={handleGameEnd}\n          onTimeUp={handleTimeUp}\n          onQuizResponse={handleQuizResponse}\n          onQuizAttempt={handleQuizAttempt}\n          quizResponses={quizResponses}\n          attemptedQuizzes={attemptedQuizzes}\n        />\n      )}\n\n      {gameState === 'end' && sessionData && (\n        <EndScreen sessionData={sessionData} difficulty={selectedDifficulty} onRestart={handleRestart} />\n      )}\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}