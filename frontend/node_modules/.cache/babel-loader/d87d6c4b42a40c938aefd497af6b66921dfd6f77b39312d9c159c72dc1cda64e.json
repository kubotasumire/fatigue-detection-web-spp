{"ast":null,"code":"import { VertexBuffer } from \"../../Buffers/buffer.js\";\nimport { EffectWrapper } from \"../../Materials/effectRenderer.js\";\nimport { FluidRenderingObject } from \"./fluidRenderingObject.js\";\n/**\n * Defines a rendering object based on a list of custom buffers\n * The list must contain at least a \"position\" buffer!\n */\nexport class FluidRenderingObjectCustomParticles extends FluidRenderingObject {\n  /**\n   * @returns the name of the class\n   */\n  getClassName() {\n    return \"FluidRenderingObjectCustomParticles\";\n  }\n  /**\n   * Gets the vertex buffers\n   */\n  get vertexBuffers() {\n    return this._vertexBuffers;\n  }\n  /**\n   * Creates a new instance of the class\n   * @param scene The scene the particles should be rendered into\n   * @param buffers The list of buffers (must contain at least one \"position\" buffer!). Note that you don't have to pass all (or any!) buffers at once in the constructor, you can use the addBuffers method to add more later.\n   * @param numParticles Number of vertices to take into account from the buffers\n   */\n  constructor(scene, buffers, numParticles) {\n    super(scene);\n    this._numParticles = numParticles;\n    this._diffuseEffectWrapper = null;\n    this._vertexBuffers = {};\n    this.addBuffers(buffers);\n  }\n  /**\n   * Add some new buffers\n   * @param buffers List of buffers\n   */\n  addBuffers(buffers) {\n    for (const name in buffers) {\n      let stride;\n      let instanced = true;\n      switch (name) {\n        case \"velocity\":\n          stride = 3;\n          break;\n        case \"offset\":\n          instanced = false;\n          break;\n      }\n      this._vertexBuffers[name] = new VertexBuffer(this._engine, buffers[name], name, true, false, stride, instanced);\n    }\n  }\n  _createEffects() {\n    super._createEffects();\n    const uniformNames = [\"view\", \"projection\", \"size\"];\n    const attributeNames = [\"position\", \"offset\", \"color\"];\n    this._diffuseEffectWrapper = new EffectWrapper({\n      engine: this._engine,\n      useShaderStore: true,\n      vertexShader: \"fluidRenderingParticleDiffuse\",\n      fragmentShader: \"fluidRenderingParticleDiffuse\",\n      attributeNames,\n      uniformNames,\n      samplerNames: []\n    });\n  }\n  /**\n   * Indicates if the object is ready to be rendered\n   * @returns True if everything is ready for the object to be rendered, otherwise false\n   */\n  isReady() {\n    if (!this._vertexBuffers[\"offset\"]) {\n      this._vertexBuffers[\"offset\"] = new VertexBuffer(this._engine, [0, 0, 1, 0, 0, 1, 1, 1], \"offset\", false, false, 2);\n    }\n    return super.isReady() && (this._diffuseEffectWrapper?.effect.isReady() ?? false);\n  }\n  /**\n   * Gets the number of particles in this object\n   * @returns The number of particles\n   */\n  get numParticles() {\n    return this._numParticles;\n  }\n  /**\n   * Sets the number of particles in this object\n   * @param num The number of particles to take into account\n   */\n  setNumParticles(num) {\n    this._numParticles = num;\n  }\n  /**\n   * Render the diffuse texture for this object\n   */\n  renderDiffuseTexture() {\n    const numParticles = this.numParticles;\n    if (!this._diffuseEffectWrapper || numParticles === 0) {\n      return;\n    }\n    const diffuseDrawWrapper = this._diffuseEffectWrapper._drawWrapper;\n    const diffuseEffect = diffuseDrawWrapper.effect;\n    this._engine.enableEffect(diffuseDrawWrapper);\n    this._engine.bindBuffers(this.vertexBuffers, this.indexBuffer, diffuseEffect);\n    diffuseEffect.setMatrix(\"view\", this._scene.getViewMatrix());\n    diffuseEffect.setMatrix(\"projection\", this._scene.getProjectionMatrix());\n    if (this._particleSize !== null) {\n      diffuseEffect.setFloat2(\"size\", this._particleSize, this._particleSize);\n    }\n    if (this.useInstancing) {\n      this._engine.drawArraysType(7, 0, 4, numParticles);\n    } else {\n      this._engine.drawElementsType(0, 0, numParticles);\n    }\n  }\n  /**\n   * Releases the ressources used by the class\n   */\n  dispose() {\n    super.dispose();\n    this._diffuseEffectWrapper?.dispose();\n    for (const name in this._vertexBuffers) {\n      this._vertexBuffers[name].dispose();\n    }\n    this._vertexBuffers = {};\n  }\n}\n//# sourceMappingURL=fluidRenderingObjectCustomParticles.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}