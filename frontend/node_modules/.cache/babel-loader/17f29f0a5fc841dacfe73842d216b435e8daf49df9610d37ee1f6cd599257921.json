{"ast":null,"code":"import { __decorate } from \"../../../tslib.es6.js\";\nimport { NodeMaterialBlock } from \"../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialBlockTargets } from \"../Enums/nodeMaterialBlockTargets.js\";\nimport { RegisterClass } from \"../../../Misc/typeStore.js\";\nimport { InputBlock } from \"./Input/inputBlock.js\";\nimport { MorphTargetsBlock } from \"./Vertex/morphTargetsBlock.js\";\nimport { PropertyTypeForEdition, editableInPropertyPage } from \"../../../Decorators/nodeDecorator.js\";\nexport var MeshAttributeExistsBlockTypes;\n(function (MeshAttributeExistsBlockTypes) {\n  MeshAttributeExistsBlockTypes[MeshAttributeExistsBlockTypes[\"None\"] = 0] = \"None\";\n  MeshAttributeExistsBlockTypes[MeshAttributeExistsBlockTypes[\"Normal\"] = 1] = \"Normal\";\n  MeshAttributeExistsBlockTypes[MeshAttributeExistsBlockTypes[\"Tangent\"] = 2] = \"Tangent\";\n  MeshAttributeExistsBlockTypes[MeshAttributeExistsBlockTypes[\"VertexColor\"] = 3] = \"VertexColor\";\n  MeshAttributeExistsBlockTypes[MeshAttributeExistsBlockTypes[\"UV1\"] = 4] = \"UV1\";\n  MeshAttributeExistsBlockTypes[MeshAttributeExistsBlockTypes[\"UV2\"] = 5] = \"UV2\";\n  MeshAttributeExistsBlockTypes[MeshAttributeExistsBlockTypes[\"UV3\"] = 6] = \"UV3\";\n  MeshAttributeExistsBlockTypes[MeshAttributeExistsBlockTypes[\"UV4\"] = 7] = \"UV4\";\n  MeshAttributeExistsBlockTypes[MeshAttributeExistsBlockTypes[\"UV5\"] = 8] = \"UV5\";\n  MeshAttributeExistsBlockTypes[MeshAttributeExistsBlockTypes[\"UV6\"] = 9] = \"UV6\";\n})(MeshAttributeExistsBlockTypes || (MeshAttributeExistsBlockTypes = {}));\n/**\n * Block used to check if Mesh attribute of specified type exists\n * and provide an alternative fallback input for to use in such case\n */\nexport class MeshAttributeExistsBlock extends NodeMaterialBlock {\n  /**\n   * Creates a new MeshAttributeExistsBlock\n   * @param name defines the block name\n   */\n  constructor(name) {\n    super(name, NodeMaterialBlockTargets.Neutral);\n    /**\n     * Defines which mesh attribute to use\n     */\n    this.attributeType = MeshAttributeExistsBlockTypes.None;\n    this.registerInput(\"input\", NodeMaterialBlockConnectionPointTypes.AutoDetect);\n    this.registerInput(\"fallback\", NodeMaterialBlockConnectionPointTypes.AutoDetect);\n    this.registerOutput(\"output\", NodeMaterialBlockConnectionPointTypes.BasedOnInput);\n    this._outputs[0]._typeConnectionSource = this._inputs[0];\n    this._linkConnectionTypes(0, 1);\n    // Try to auto determine attributeType\n    this._inputs[0].onConnectionObservable.add(other => {\n      if (this.attributeType) {\n        // But only if not already specified\n        return;\n      }\n      const sourceBlock = other.ownerBlock;\n      if (sourceBlock instanceof InputBlock && sourceBlock.isAttribute) {\n        switch (sourceBlock.name) {\n          case \"color\":\n            this.attributeType = MeshAttributeExistsBlockTypes.VertexColor;\n            break;\n          case \"normal\":\n            this.attributeType = MeshAttributeExistsBlockTypes.Normal;\n            break;\n          case \"tangent\":\n            this.attributeType = MeshAttributeExistsBlockTypes.Tangent;\n            break;\n          case \"uv\":\n            this.attributeType = MeshAttributeExistsBlockTypes.UV1;\n            break;\n          case \"uv2\":\n            this.attributeType = MeshAttributeExistsBlockTypes.UV2;\n            break;\n          case \"uv3\":\n            this.attributeType = MeshAttributeExistsBlockTypes.UV3;\n            break;\n          case \"uv4\":\n            this.attributeType = MeshAttributeExistsBlockTypes.UV4;\n            break;\n          case \"uv5\":\n            this.attributeType = MeshAttributeExistsBlockTypes.UV5;\n            break;\n          case \"uv6\":\n            this.attributeType = MeshAttributeExistsBlockTypes.UV6;\n            break;\n        }\n      } else if (sourceBlock instanceof MorphTargetsBlock) {\n        switch (this.input.connectedPoint?.name) {\n          case \"normalOutput\":\n            this.attributeType = MeshAttributeExistsBlockTypes.Normal;\n            break;\n          case \"tangentOutput\":\n            this.attributeType = MeshAttributeExistsBlockTypes.Tangent;\n            break;\n          case \"uvOutput\":\n            this.attributeType = MeshAttributeExistsBlockTypes.UV1;\n            break;\n        }\n      }\n    });\n  }\n  /**\n   * Gets the current class name\n   * @returns the class name\n   */\n  getClassName() {\n    return \"MeshAttributeExistsBlock\";\n  }\n  /**\n   * Gets the input component\n   */\n  get input() {\n    return this._inputs[0];\n  }\n  /**\n   * Gets the fallback component when speciefied attribute doesn't exist\n   */\n  get fallback() {\n    return this._inputs[1];\n  }\n  /**\n   * Gets the output component\n   */\n  get output() {\n    return this._outputs[0];\n  }\n  _buildBlock(state) {\n    super._buildBlock(state);\n    let attributeDefine = null;\n    switch (this.attributeType) {\n      case MeshAttributeExistsBlockTypes.VertexColor:\n        attributeDefine = \"VERTEXCOLOR_NME\";\n        break;\n      case MeshAttributeExistsBlockTypes.Normal:\n        attributeDefine = \"NORMAL\";\n        break;\n      case MeshAttributeExistsBlockTypes.Tangent:\n        attributeDefine = \"TANGENT\";\n        break;\n      case MeshAttributeExistsBlockTypes.UV1:\n        attributeDefine = \"UV1\";\n        break;\n      case MeshAttributeExistsBlockTypes.UV2:\n        attributeDefine = \"UV2\";\n        break;\n      case MeshAttributeExistsBlockTypes.UV3:\n        attributeDefine = \"UV3\";\n        break;\n      case MeshAttributeExistsBlockTypes.UV4:\n        attributeDefine = \"UV4\";\n        break;\n      case MeshAttributeExistsBlockTypes.UV5:\n        attributeDefine = \"UV5\";\n        break;\n      case MeshAttributeExistsBlockTypes.UV6:\n        attributeDefine = \"UV6\";\n        break;\n    }\n    const output = this._declareOutput(this.output, state);\n    if (attributeDefine) {\n      state.compilationString += `#ifdef ${attributeDefine}\\n`;\n    }\n    state.compilationString += `${output} = ${this.input.associatedVariableName};\\n`;\n    if (attributeDefine) {\n      state.compilationString += `#else\\n`;\n      state.compilationString += `${output} = ${this.fallback.associatedVariableName};\\n`;\n      state.compilationString += `#endif\\n`;\n    }\n    return this;\n  }\n  serialize() {\n    const serializationObject = super.serialize();\n    serializationObject.attributeType = this.attributeType;\n    return serializationObject;\n  }\n  _deserialize(serializationObject, scene, rootUrl) {\n    super._deserialize(serializationObject, scene, rootUrl);\n    this.attributeType = serializationObject.attributeType ?? MeshAttributeExistsBlockTypes.None;\n  }\n  _dumpPropertiesCode() {\n    let codeString = super._dumpPropertiesCode();\n    codeString += `${this._codeVariableName}.attributeType = ${this.attributeType};\\n`;\n    return codeString;\n  }\n}\n__decorate([editableInPropertyPage(\"Attribute lookup\", PropertyTypeForEdition.List, undefined, {\n  notifiers: {\n    update: true\n  },\n  options: [{\n    label: \"(None)\",\n    value: MeshAttributeExistsBlockTypes.None\n  }, {\n    label: \"Normal\",\n    value: MeshAttributeExistsBlockTypes.Normal\n  }, {\n    label: \"Tangent\",\n    value: MeshAttributeExistsBlockTypes.Tangent\n  }, {\n    label: \"Vertex Color\",\n    value: MeshAttributeExistsBlockTypes.VertexColor\n  }, {\n    label: \"UV1\",\n    value: MeshAttributeExistsBlockTypes.UV1\n  }, {\n    label: \"UV2\",\n    value: MeshAttributeExistsBlockTypes.UV2\n  }, {\n    label: \"UV3\",\n    value: MeshAttributeExistsBlockTypes.UV3\n  }, {\n    label: \"UV4\",\n    value: MeshAttributeExistsBlockTypes.UV4\n  }, {\n    label: \"UV5\",\n    value: MeshAttributeExistsBlockTypes.UV5\n  }, {\n    label: \"UV6\",\n    value: MeshAttributeExistsBlockTypes.UV6\n  }]\n})], MeshAttributeExistsBlock.prototype, \"attributeType\", void 0);\nRegisterClass(\"BABYLON.MeshAttributeExistsBlock\", MeshAttributeExistsBlock);\n//# sourceMappingURL=meshAttributeExistsBlock.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}