{"ast":null,"code":"import { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\nimport { Logger } from \"../../../../Misc/logger.js\";\n/**\n * Block used to write the fragment depth\n */\nexport class FragDepthBlock extends NodeMaterialBlock {\n  /**\n   * Create a new FragDepthBlock\n   * @param name defines the block name\n   */\n  constructor(name) {\n    super(name, NodeMaterialBlockTargets.Fragment, true);\n    this.registerInput(\"depth\", NodeMaterialBlockConnectionPointTypes.Float, true);\n    this.registerInput(\"worldPos\", NodeMaterialBlockConnectionPointTypes.Vector4, true);\n    this.registerInput(\"viewProjection\", NodeMaterialBlockConnectionPointTypes.Matrix, true);\n  }\n  /**\n   * Gets the current class name\n   * @returns the class name\n   */\n  getClassName() {\n    return \"FragDepthBlock\";\n  }\n  /**\n   * Gets the depth input component\n   */\n  get depth() {\n    return this._inputs[0];\n  }\n  /**\n   * Gets the worldPos input component\n   */\n  get worldPos() {\n    return this._inputs[1];\n  }\n  /**\n   * Gets the viewProjection input component\n   */\n  get viewProjection() {\n    return this._inputs[2];\n  }\n  _buildBlock(state) {\n    super._buildBlock(state);\n    if (this.depth.isConnected) {\n      state.compilationString += `gl_FragDepth = ${this.depth.associatedVariableName};\\n`;\n    } else if (this.worldPos.isConnected && this.viewProjection.isConnected) {\n      state.compilationString += `\n                vec4 p = ${this.viewProjection.associatedVariableName} * ${this.worldPos.associatedVariableName};\n                float v = p.z / p.w;\n                #ifndef IS_NDC_HALF_ZRANGE\n                    v = v * 0.5 + 0.5;\n                #endif\n                gl_FragDepth = v;\n    \n            `;\n    } else {\n      Logger.Warn(\"FragDepthBlock: either the depth input or both the worldPos and viewProjection inputs must be connected!\");\n    }\n    return this;\n  }\n}\nRegisterClass(\"BABYLON.FragDepthBlock\", FragDepthBlock);\n//# sourceMappingURL=fragDepthBlock.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}