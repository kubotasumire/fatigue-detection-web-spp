{"ast":null,"code":"import { Engine } from \"../Engines/engine.js\";\nimport { EngineStore } from \"../Engines/engineStore.js\";\n/**\n * It could be useful to isolate your music & sounds on several tracks to better manage volume on a grouped instance of sounds.\n * It will be also used in a future release to apply effects on a specific track.\n * @see https://doc.babylonjs.com/features/featuresDeepDive/audio/playingSoundsMusic#using-sound-tracks\n */\nexport class SoundTrack {\n  /**\n   * Creates a new sound track.\n   * @see https://doc.babylonjs.com/features/featuresDeepDive/audio/playingSoundsMusic#using-sound-tracks\n   * @param scene Define the scene the sound track belongs to\n   * @param options\n   */\n  constructor(scene, options = {}) {\n    /**\n     * The unique identifier of the sound track in the scene.\n     */\n    this.id = -1;\n    this._isInitialized = false;\n    scene = scene || EngineStore.LastCreatedScene;\n    if (!scene) {\n      return;\n    }\n    this._scene = scene;\n    this.soundCollection = [];\n    this._options = options;\n    if (!this._options.mainTrack && this._scene.soundTracks) {\n      this._scene.soundTracks.push(this);\n      this.id = this._scene.soundTracks.length - 1;\n    }\n  }\n  _initializeSoundTrackAudioGraph() {\n    if (Engine.audioEngine?.canUseWebAudio && Engine.audioEngine.audioContext) {\n      this._outputAudioNode = Engine.audioEngine.audioContext.createGain();\n      this._outputAudioNode.connect(Engine.audioEngine.masterGain);\n      if (this._options) {\n        if (this._options.volume) {\n          this._outputAudioNode.gain.value = this._options.volume;\n        }\n      }\n      this._isInitialized = true;\n    }\n  }\n  /**\n   * Release the sound track and its associated resources\n   */\n  dispose() {\n    if (Engine.audioEngine && Engine.audioEngine.canUseWebAudio) {\n      if (this._connectedAnalyser) {\n        this._connectedAnalyser.stopDebugCanvas();\n      }\n      while (this.soundCollection.length) {\n        this.soundCollection[0].dispose();\n      }\n      if (this._outputAudioNode) {\n        this._outputAudioNode.disconnect();\n      }\n      this._outputAudioNode = null;\n    }\n  }\n  /**\n   * Adds a sound to this sound track\n   * @param sound define the sound to add\n   * @ignoreNaming\n   */\n  addSound(sound) {\n    if (!this._isInitialized) {\n      this._initializeSoundTrackAudioGraph();\n    }\n    if (Engine.audioEngine?.canUseWebAudio && this._outputAudioNode) {\n      sound.connectToSoundTrackAudioNode(this._outputAudioNode);\n    }\n    if (sound.soundTrackId !== undefined) {\n      if (sound.soundTrackId === -1) {\n        this._scene.mainSoundTrack.removeSound(sound);\n      } else if (this._scene.soundTracks) {\n        this._scene.soundTracks[sound.soundTrackId].removeSound(sound);\n      }\n    }\n    this.soundCollection.push(sound);\n    sound.soundTrackId = this.id;\n  }\n  /**\n   * Removes a sound to this sound track\n   * @param sound define the sound to remove\n   * @ignoreNaming\n   */\n  removeSound(sound) {\n    const index = this.soundCollection.indexOf(sound);\n    if (index !== -1) {\n      this.soundCollection.splice(index, 1);\n    }\n  }\n  /**\n   * Set a global volume for the full sound track.\n   * @param newVolume Define the new volume of the sound track\n   */\n  setVolume(newVolume) {\n    if (Engine.audioEngine?.canUseWebAudio && this._outputAudioNode) {\n      this._outputAudioNode.gain.value = newVolume;\n    }\n  }\n  /**\n   * Switch the panning model to HRTF:\n   * Renders a stereo output of higher quality than equalpower â€” it uses a convolution with measured impulse responses from human subjects.\n   * @see https://doc.babylonjs.com/features/featuresDeepDive/audio/playingSoundsMusic#creating-a-spatial-3d-sound\n   */\n  switchPanningModelToHRTF() {\n    if (Engine.audioEngine?.canUseWebAudio) {\n      for (let i = 0; i < this.soundCollection.length; i++) {\n        this.soundCollection[i].switchPanningModelToHRTF();\n      }\n    }\n  }\n  /**\n   * Switch the panning model to Equal Power:\n   * Represents the equal-power panning algorithm, generally regarded as simple and efficient. equalpower is the default value.\n   * @see https://doc.babylonjs.com/features/featuresDeepDive/audio/playingSoundsMusic#creating-a-spatial-3d-sound\n   */\n  switchPanningModelToEqualPower() {\n    if (Engine.audioEngine?.canUseWebAudio) {\n      for (let i = 0; i < this.soundCollection.length; i++) {\n        this.soundCollection[i].switchPanningModelToEqualPower();\n      }\n    }\n  }\n  /**\n   * Connect the sound track to an audio analyser allowing some amazing\n   * synchronization between the sounds/music and your visualization (VuMeter for instance).\n   * @see https://doc.babylonjs.com/features/featuresDeepDive/audio/playingSoundsMusic#using-the-analyser\n   * @param analyser The analyser to connect to the engine\n   */\n  connectToAnalyser(analyser) {\n    if (this._connectedAnalyser) {\n      this._connectedAnalyser.stopDebugCanvas();\n    }\n    this._connectedAnalyser = analyser;\n    if (Engine.audioEngine?.canUseWebAudio && this._outputAudioNode) {\n      this._outputAudioNode.disconnect();\n      this._connectedAnalyser.connectAudioNodes(this._outputAudioNode, Engine.audioEngine.masterGain);\n    }\n  }\n}\n//# sourceMappingURL=soundTrack.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}