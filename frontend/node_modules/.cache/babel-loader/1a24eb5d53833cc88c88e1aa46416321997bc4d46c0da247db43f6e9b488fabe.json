{"ast":null,"code":"import { __decorate } from \"../../../../tslib.es6.js\";\nimport { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialConnectionPointDirection } from \"../../nodeMaterialBlockConnectionPoint.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\nimport { editableInPropertyPage, PropertyTypeForEdition } from \"../../../../Decorators/nodeDecorator.js\";\nimport { NodeMaterialConnectionPointCustomObject } from \"../../nodeMaterialConnectionPointCustomObject.js\";\n/**\n * Block used to implement the sheen module of the PBR material\n */\nexport class SheenBlock extends NodeMaterialBlock {\n  /**\n   * Create a new SheenBlock\n   * @param name defines the block name\n   */\n  constructor(name) {\n    super(name, NodeMaterialBlockTargets.Fragment);\n    /**\n     * If true, the sheen effect is layered above the base BRDF with the albedo-scaling technique.\n     * It allows the strength of the sheen effect to not depend on the base color of the material,\n     * making it easier to setup and tweak the effect\n     */\n    this.albedoScaling = false;\n    /**\n     * Defines if the sheen is linked to the sheen color.\n     */\n    this.linkSheenWithAlbedo = false;\n    this._isUnique = true;\n    this.registerInput(\"intensity\", NodeMaterialBlockConnectionPointTypes.Float, true, NodeMaterialBlockTargets.Fragment);\n    this.registerInput(\"color\", NodeMaterialBlockConnectionPointTypes.Color3, true, NodeMaterialBlockTargets.Fragment);\n    this.registerInput(\"roughness\", NodeMaterialBlockConnectionPointTypes.Float, true, NodeMaterialBlockTargets.Fragment);\n    this.registerOutput(\"sheen\", NodeMaterialBlockConnectionPointTypes.Object, NodeMaterialBlockTargets.Fragment, new NodeMaterialConnectionPointCustomObject(\"sheen\", this, NodeMaterialConnectionPointDirection.Output, SheenBlock, \"SheenBlock\"));\n  }\n  /**\n   * Initialize the block and prepare the context for build\n   * @param state defines the state that will be used for the build\n   */\n  initialize(state) {\n    state._excludeVariableName(\"sheenOut\");\n    state._excludeVariableName(\"sheenMapData\");\n    state._excludeVariableName(\"vSheenColor\");\n    state._excludeVariableName(\"vSheenRoughness\");\n  }\n  /**\n   * Gets the current class name\n   * @returns the class name\n   */\n  getClassName() {\n    return \"SheenBlock\";\n  }\n  /**\n   * Gets the intensity input component\n   */\n  get intensity() {\n    return this._inputs[0];\n  }\n  /**\n   * Gets the color input component\n   */\n  get color() {\n    return this._inputs[1];\n  }\n  /**\n   * Gets the roughness input component\n   */\n  get roughness() {\n    return this._inputs[2];\n  }\n  /**\n   * Gets the sheen object output component\n   */\n  get sheen() {\n    return this._outputs[0];\n  }\n  prepareDefines(mesh, nodeMaterial, defines) {\n    super.prepareDefines(mesh, nodeMaterial, defines);\n    defines.setValue(\"SHEEN\", true);\n    defines.setValue(\"SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE\", true, true);\n    defines.setValue(\"SHEEN_LINKWITHALBEDO\", this.linkSheenWithAlbedo, true);\n    defines.setValue(\"SHEEN_ROUGHNESS\", this.roughness.isConnected, true);\n    defines.setValue(\"SHEEN_ALBEDOSCALING\", this.albedoScaling, true);\n  }\n  /**\n   * Gets the main code of the block (fragment side)\n   * @param reflectionBlock instance of a ReflectionBlock null if the code must be generated without an active reflection module\n   * @returns the shader code\n   */\n  getCode(reflectionBlock) {\n    let code = \"\";\n    const color = this.color.isConnected ? this.color.associatedVariableName : \"vec3(1.)\";\n    const intensity = this.intensity.isConnected ? this.intensity.associatedVariableName : \"1.\";\n    const roughness = this.roughness.isConnected ? this.roughness.associatedVariableName : \"0.\";\n    const texture = \"vec4(0.)\";\n    code = `#ifdef SHEEN\n            sheenOutParams sheenOut;\n\n            vec4 vSheenColor = vec4(${color}, ${intensity});\n\n            sheenBlock(\n                vSheenColor,\n            #ifdef SHEEN_ROUGHNESS\n                ${roughness},\n            #endif\n                roughness,\n            #ifdef SHEEN_TEXTURE\n                ${texture},\n                1.0,\n            #endif\n                reflectance,\n            #ifdef SHEEN_LINKWITHALBEDO\n                baseColor,\n                surfaceAlbedo,\n            #endif\n            #ifdef ENVIRONMENTBRDF\n                NdotV,\n                environmentBrdf,\n            #endif\n            #if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\n                AARoughnessFactors,\n                ${reflectionBlock?._vReflectionMicrosurfaceInfosName},\n                ${reflectionBlock?._vReflectionInfosName},\n                ${reflectionBlock?.reflectionColor},\n                vLightingIntensity,\n                #ifdef ${reflectionBlock?._define3DName}\n                    ${reflectionBlock?._cubeSamplerName},\n                #else\n                    ${reflectionBlock?._2DSamplerName},\n                #endif\n                reflectionOut.reflectionCoords,\n                NdotVUnclamped,\n                #ifndef LODBASEDMICROSFURACE\n                    #ifdef ${reflectionBlock?._define3DName}\n                        ${reflectionBlock?._cubeSamplerName},\n                        ${reflectionBlock?._cubeSamplerName},\n                    #else\n                        ${reflectionBlock?._2DSamplerName},\n                        ${reflectionBlock?._2DSamplerName},\n                    #endif\n                #endif\n                #if !defined(${reflectionBlock?._defineSkyboxName}) && defined(RADIANCEOCCLUSION)\n                    seo,\n                #endif\n                #if !defined(${reflectionBlock?._defineSkyboxName}) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(${reflectionBlock?._define3DName})\n                    eho,\n                #endif\n            #endif\n                sheenOut\n            );\n\n            #ifdef SHEEN_LINKWITHALBEDO\n                surfaceAlbedo = sheenOut.surfaceAlbedo;\n            #endif\n        #endif\\n`;\n    return code;\n  }\n  _buildBlock(state) {\n    if (state.target === NodeMaterialBlockTargets.Fragment) {\n      state.sharedData.blocksWithDefines.push(this);\n    }\n    return this;\n  }\n  _dumpPropertiesCode() {\n    let codeString = super._dumpPropertiesCode();\n    codeString += `${this._codeVariableName}.albedoScaling = ${this.albedoScaling};\\n`;\n    codeString += `${this._codeVariableName}.linkSheenWithAlbedo = ${this.linkSheenWithAlbedo};\\n`;\n    return codeString;\n  }\n  serialize() {\n    const serializationObject = super.serialize();\n    serializationObject.albedoScaling = this.albedoScaling;\n    serializationObject.linkSheenWithAlbedo = this.linkSheenWithAlbedo;\n    return serializationObject;\n  }\n  _deserialize(serializationObject, scene, rootUrl) {\n    super._deserialize(serializationObject, scene, rootUrl);\n    this.albedoScaling = serializationObject.albedoScaling;\n    this.linkSheenWithAlbedo = serializationObject.linkSheenWithAlbedo;\n  }\n}\n__decorate([editableInPropertyPage(\"Albedo scaling\", PropertyTypeForEdition.Boolean, \"PROPERTIES\", {\n  notifiers: {\n    update: true\n  }\n})], SheenBlock.prototype, \"albedoScaling\", void 0);\n__decorate([editableInPropertyPage(\"Link sheen with albedo\", PropertyTypeForEdition.Boolean, \"PROPERTIES\", {\n  notifiers: {\n    update: true\n  }\n})], SheenBlock.prototype, \"linkSheenWithAlbedo\", void 0);\nRegisterClass(\"BABYLON.SheenBlock\", SheenBlock);\n//# sourceMappingURL=sheenBlock.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}