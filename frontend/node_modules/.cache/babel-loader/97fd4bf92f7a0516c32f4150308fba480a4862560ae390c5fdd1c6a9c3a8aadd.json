{"ast":null,"code":"import { PointerEventTypes } from \"../../Events/pointerEvents.js\";\nimport { PrecisionDate } from \"../../Misc/precisionDate.js\";\nimport { Epsilon } from \"../../Maths/math.constants.js\";\n/**\n * The autoRotation behavior (AutoRotationBehavior) is designed to create a smooth rotation of an ArcRotateCamera when there is no user interaction.\n * @see https://doc.babylonjs.com/features/featuresDeepDive/behaviors/cameraBehaviors#autorotation-behavior\n */\nexport class AutoRotationBehavior {\n  constructor() {\n    this._zoomStopsAnimation = false;\n    this._idleRotationSpeed = 0.05;\n    this._idleRotationWaitTime = 2000;\n    this._idleRotationSpinupTime = 2000;\n    /**\n     * Target alpha\n     */\n    this.targetAlpha = null;\n    this._isPointerDown = false;\n    this._lastFrameTime = null;\n    this._lastInteractionTime = -Infinity;\n    this._cameraRotationSpeed = 0;\n    this._lastFrameRadius = 0;\n  }\n  /**\n   * Gets the name of the behavior.\n   */\n  get name() {\n    return \"AutoRotation\";\n  }\n  /**\n   * Sets the flag that indicates if user zooming should stop animation.\n   */\n  set zoomStopsAnimation(flag) {\n    this._zoomStopsAnimation = flag;\n  }\n  /**\n   * Gets the flag that indicates if user zooming should stop animation.\n   */\n  get zoomStopsAnimation() {\n    return this._zoomStopsAnimation;\n  }\n  /**\n   * Sets the default speed at which the camera rotates around the model.\n   */\n  set idleRotationSpeed(speed) {\n    this._idleRotationSpeed = speed;\n  }\n  /**\n   * Gets the default speed at which the camera rotates around the model.\n   */\n  get idleRotationSpeed() {\n    return this._idleRotationSpeed;\n  }\n  /**\n   * Sets the time (in milliseconds) to wait after user interaction before the camera starts rotating.\n   */\n  set idleRotationWaitTime(time) {\n    this._idleRotationWaitTime = time;\n  }\n  /**\n   * Gets the time (milliseconds) to wait after user interaction before the camera starts rotating.\n   */\n  get idleRotationWaitTime() {\n    return this._idleRotationWaitTime;\n  }\n  /**\n   * Sets the time (milliseconds) to take to spin up to the full idle rotation speed.\n   */\n  set idleRotationSpinupTime(time) {\n    this._idleRotationSpinupTime = time;\n  }\n  /**\n   * Gets the time (milliseconds) to take to spin up to the full idle rotation speed.\n   */\n  get idleRotationSpinupTime() {\n    return this._idleRotationSpinupTime;\n  }\n  /**\n   * Gets a value indicating if the camera is currently rotating because of this behavior\n   */\n  get rotationInProgress() {\n    return Math.abs(this._cameraRotationSpeed) > 0;\n  }\n  /**\n   * Initializes the behavior.\n   */\n  init() {\n    // Do nothing\n  }\n  /**\n   * Attaches the behavior to its arc rotate camera.\n   * @param camera Defines the camera to attach the behavior to\n   */\n  attach(camera) {\n    this._attachedCamera = camera;\n    const scene = this._attachedCamera.getScene();\n    this._onPrePointerObservableObserver = scene.onPrePointerObservable.add(pointerInfoPre => {\n      if (pointerInfoPre.type === PointerEventTypes.POINTERDOWN) {\n        this._isPointerDown = true;\n        return;\n      }\n      if (pointerInfoPre.type === PointerEventTypes.POINTERUP) {\n        this._isPointerDown = false;\n      }\n    });\n    this._onAfterCheckInputsObserver = camera.onAfterCheckInputsObservable.add(() => {\n      if (this._reachTargetAlpha()) {\n        return;\n      }\n      const now = PrecisionDate.Now;\n      let dt = 0;\n      if (this._lastFrameTime != null) {\n        dt = now - this._lastFrameTime;\n      }\n      this._lastFrameTime = now;\n      // Stop the animation if there is user interaction and the animation should stop for this interaction\n      this._applyUserInteraction();\n      const timeToRotation = now - this._lastInteractionTime - this._idleRotationWaitTime;\n      const scale = Math.max(Math.min(timeToRotation / this._idleRotationSpinupTime, 1), 0);\n      this._cameraRotationSpeed = this._idleRotationSpeed * scale;\n      // Step camera rotation by rotation speed\n      if (this._attachedCamera) {\n        this._attachedCamera.alpha -= this._cameraRotationSpeed * (dt / 1000);\n      }\n    });\n  }\n  /**\n   * Detaches the behavior from its current arc rotate camera.\n   */\n  detach() {\n    if (!this._attachedCamera) {\n      return;\n    }\n    const scene = this._attachedCamera.getScene();\n    if (this._onPrePointerObservableObserver) {\n      scene.onPrePointerObservable.remove(this._onPrePointerObservableObserver);\n    }\n    this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver);\n    this._attachedCamera = null;\n  }\n  /**\n   * Force-reset the last interaction time\n   * @param customTime an optional time that will be used instead of the current last interaction time. For example `Date.now()`\n   */\n  resetLastInteractionTime(customTime) {\n    this._lastInteractionTime = customTime ?? PrecisionDate.Now;\n  }\n  /**\n   * Returns true if camera alpha reaches the target alpha\n   * @returns true if camera alpha reaches the target alpha\n   */\n  _reachTargetAlpha() {\n    if (this._attachedCamera && this.targetAlpha) {\n      return Math.abs(this._attachedCamera.alpha - this.targetAlpha) < Epsilon;\n    }\n    return false;\n  }\n  /**\n   * Returns true if user is scrolling.\n   * @returns true if user is scrolling.\n   */\n  _userIsZooming() {\n    if (!this._attachedCamera) {\n      return false;\n    }\n    return this._attachedCamera.inertialRadiusOffset !== 0;\n  }\n  _shouldAnimationStopForInteraction() {\n    if (!this._attachedCamera) {\n      return false;\n    }\n    let zoomHasHitLimit = false;\n    if (this._lastFrameRadius === this._attachedCamera.radius && this._attachedCamera.inertialRadiusOffset !== 0) {\n      zoomHasHitLimit = true;\n    }\n    // Update the record of previous radius - works as an approx. indicator of hitting radius limits\n    this._lastFrameRadius = this._attachedCamera.radius;\n    return this._zoomStopsAnimation ? zoomHasHitLimit : this._userIsZooming();\n  }\n  /**\n   *  Applies any current user interaction to the camera. Takes into account maximum alpha rotation.\n   */\n  _applyUserInteraction() {\n    if (this._userIsMoving() && !this._shouldAnimationStopForInteraction()) {\n      this._lastInteractionTime = PrecisionDate.Now;\n    }\n  }\n  // Tools\n  _userIsMoving() {\n    if (!this._attachedCamera) {\n      return false;\n    }\n    return this._attachedCamera.inertialAlphaOffset !== 0 || this._attachedCamera.inertialBetaOffset !== 0 || this._attachedCamera.inertialRadiusOffset !== 0 || this._attachedCamera.inertialPanningX !== 0 || this._attachedCamera.inertialPanningY !== 0 || this._isPointerDown;\n  }\n}\n//# sourceMappingURL=autoRotationBehavior.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}