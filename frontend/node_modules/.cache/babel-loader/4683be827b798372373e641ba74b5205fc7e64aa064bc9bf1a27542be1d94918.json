{"ast":null,"code":"import { UniformBuffer } from \"../../Materials/uniformBuffer.js\";\nimport { WebGPUShaderProcessor } from \"./webgpuShaderProcessor.js\";\n/** @internal */\nexport class WebGPUPipelineContext {\n  get isAsync() {\n    return false;\n  }\n  get isReady() {\n    if (this.stages) {\n      return true;\n    }\n    return false;\n  }\n  constructor(shaderProcessingContext, engine) {\n    // The field is indexed by textureState. See @WebGPUMaterialContext.textureState for more information.\n    this.bindGroupLayouts = {};\n    this._name = \"unnamed\";\n    this.shaderProcessingContext = shaderProcessingContext;\n    this._leftOverUniformsByName = {};\n    this.engine = engine;\n    this.vertexBufferKindToType = {};\n  }\n  _handlesSpectorRebuildCallback() {\n    // Nothing to do yet for spector.\n  }\n  _fillEffectInformation(effect, uniformBuffersNames, uniformsNames, uniforms, samplerList, samplers, attributesNames, attributes) {\n    const engine = this.engine;\n    if (engine._doNotHandleContextLost) {\n      effect._fragmentSourceCode = \"\";\n      effect._vertexSourceCode = \"\";\n    }\n    const foundSamplers = this.shaderProcessingContext.availableTextures;\n    let index;\n    for (index = 0; index < samplerList.length; index++) {\n      const name = samplerList[index];\n      const sampler = foundSamplers[samplerList[index]];\n      if (sampler == null || sampler == undefined) {\n        samplerList.splice(index, 1);\n        index--;\n      } else {\n        samplers[name] = index;\n      }\n    }\n    for (const attr of engine.getAttributes(this, attributesNames)) {\n      attributes.push(attr);\n    }\n    // Build the uniform layout for the left over uniforms.\n    this.buildUniformLayout();\n    const attributeNamesFromEffect = [];\n    const attributeLocationsFromEffect = [];\n    for (index = 0; index < attributesNames.length; index++) {\n      const location = attributes[index];\n      if (location >= 0) {\n        attributeNamesFromEffect.push(attributesNames[index]);\n        attributeLocationsFromEffect.push(location);\n      }\n    }\n    this.shaderProcessingContext.attributeNamesFromEffect = attributeNamesFromEffect;\n    this.shaderProcessingContext.attributeLocationsFromEffect = attributeLocationsFromEffect;\n  }\n  /** @internal */\n  /**\n   * Build the uniform buffer used in the material.\n   */\n  buildUniformLayout() {\n    if (!this.shaderProcessingContext.leftOverUniforms.length) {\n      return;\n    }\n    this.uniformBuffer = new UniformBuffer(this.engine, undefined, undefined, \"leftOver-\" + this._name);\n    for (const leftOverUniform of this.shaderProcessingContext.leftOverUniforms) {\n      const type = leftOverUniform.type.replace(/^(.*?)(<.*>)?$/, \"$1\");\n      const size = WebGPUShaderProcessor.UniformSizes[type];\n      this.uniformBuffer.addUniform(leftOverUniform.name, size, leftOverUniform.length);\n      this._leftOverUniformsByName[leftOverUniform.name] = leftOverUniform.type;\n    }\n    this.uniformBuffer.create();\n  }\n  /**\n   * Release all associated resources.\n   **/\n  dispose() {\n    if (this.uniformBuffer) {\n      this.uniformBuffer.dispose();\n    }\n  }\n  /**\n   * Sets an integer value on a uniform variable.\n   * @param uniformName Name of the variable.\n   * @param value Value to be set.\n   */\n  setInt(uniformName, value) {\n    if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n      return;\n    }\n    this.uniformBuffer.updateInt(uniformName, value);\n  }\n  /**\n   * Sets an int2 value on a uniform variable.\n   * @param uniformName Name of the variable.\n   * @param x First int in int2.\n   * @param y Second int in int2.\n   */\n  setInt2(uniformName, x, y) {\n    if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n      return;\n    }\n    this.uniformBuffer.updateInt2(uniformName, x, y);\n  }\n  /**\n   * Sets an int3 value on a uniform variable.\n   * @param uniformName Name of the variable.\n   * @param x First int in int3.\n   * @param y Second int in int3.\n   * @param z Third int in int3.\n   */\n  setInt3(uniformName, x, y, z) {\n    if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n      return;\n    }\n    this.uniformBuffer.updateInt3(uniformName, x, y, z);\n  }\n  /**\n   * Sets an int4 value on a uniform variable.\n   * @param uniformName Name of the variable.\n   * @param x First int in int4.\n   * @param y Second int in int4.\n   * @param z Third int in int4.\n   * @param w Fourth int in int4.\n   */\n  setInt4(uniformName, x, y, z, w) {\n    if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n      return;\n    }\n    this.uniformBuffer.updateInt4(uniformName, x, y, z, w);\n  }\n  /**\n   * Sets an int array on a uniform variable.\n   * @param uniformName Name of the variable.\n   * @param array array to be set.\n   */\n  setIntArray(uniformName, array) {\n    if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n      return;\n    }\n    this.uniformBuffer.updateIntArray(uniformName, array);\n  }\n  /**\n   * Sets an int array 2 on a uniform variable. (Array is specified as single array eg. [1,2,3,4] will result in [[1,2],[3,4]] in the shader)\n   * @param uniformName Name of the variable.\n   * @param array array to be set.\n   */\n  setIntArray2(uniformName, array) {\n    this.setIntArray(uniformName, array);\n  }\n  /**\n   * Sets an int array 3 on a uniform variable. (Array is specified as single array eg. [1,2,3,4,5,6] will result in [[1,2,3],[4,5,6]] in the shader)\n   * @param uniformName Name of the variable.\n   * @param array array to be set.\n   */\n  setIntArray3(uniformName, array) {\n    this.setIntArray(uniformName, array);\n  }\n  /**\n   * Sets an int array 4 on a uniform variable. (Array is specified as single array eg. [1,2,3,4,5,6,7,8] will result in [[1,2,3,4],[5,6,7,8]] in the shader)\n   * @param uniformName Name of the variable.\n   * @param array array to be set.\n   */\n  setIntArray4(uniformName, array) {\n    this.setIntArray(uniformName, array);\n  }\n  /**\n   * Sets an unsigned integer value on a uniform variable.\n   * @param uniformName Name of the variable.\n   * @param value Value to be set.\n   */\n  setUInt(uniformName, value) {\n    if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n      return;\n    }\n    this.uniformBuffer.updateUInt(uniformName, value);\n  }\n  /**\n   * Sets an unsigned int2 value on a uniform variable.\n   * @param uniformName Name of the variable.\n   * @param x First unsigned int in uint2.\n   * @param y Second unsigned int in uint2.\n   */\n  setUInt2(uniformName, x, y) {\n    if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n      return;\n    }\n    this.uniformBuffer.updateUInt2(uniformName, x, y);\n  }\n  /**\n   * Sets an unsigned int3 value on a uniform variable.\n   * @param uniformName Name of the variable.\n   * @param x First unsigned int in uint3.\n   * @param y Second unsigned int in uint3.\n   * @param z Third unsigned int in uint3.\n   */\n  setUInt3(uniformName, x, y, z) {\n    if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n      return;\n    }\n    this.uniformBuffer.updateUInt3(uniformName, x, y, z);\n  }\n  /**\n   * Sets an unsigned int4 value on a uniform variable.\n   * @param uniformName Name of the variable.\n   * @param x First unsigned int in uint4.\n   * @param y Second unsigned int in uint4.\n   * @param z Third unsigned int in uint4.\n   * @param w Fourth unsigned int in uint4.\n   */\n  setUInt4(uniformName, x, y, z, w) {\n    if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n      return;\n    }\n    this.uniformBuffer.updateUInt4(uniformName, x, y, z, w);\n  }\n  /**\n   * Sets an unsigned int array on a uniform variable.\n   * @param uniformName Name of the variable.\n   * @param array array to be set.\n   */\n  setUIntArray(uniformName, array) {\n    if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n      return;\n    }\n    this.uniformBuffer.updateUIntArray(uniformName, array);\n  }\n  /**\n   * Sets an unsigned int array 2 on a uniform variable. (Array is specified as single array eg. [1,2,3,4] will result in [[1,2],[3,4]] in the shader)\n   * @param uniformName Name of the variable.\n   * @param array array to be set.\n   */\n  setUIntArray2(uniformName, array) {\n    this.setUIntArray(uniformName, array);\n  }\n  /**\n   * Sets an unsigned int array 3 on a uniform variable. (Array is specified as single array eg. [1,2,3,4,5,6] will result in [[1,2,3],[4,5,6]] in the shader)\n   * @param uniformName Name of the variable.\n   * @param array array to be set.\n   */\n  setUIntArray3(uniformName, array) {\n    this.setUIntArray(uniformName, array);\n  }\n  /**\n   * Sets an unsigned int array 4 on a uniform variable. (Array is specified as single array eg. [1,2,3,4,5,6,7,8] will result in [[1,2,3,4],[5,6,7,8]] in the shader)\n   * @param uniformName Name of the variable.\n   * @param array array to be set.\n   */\n  setUIntArray4(uniformName, array) {\n    this.setUIntArray(uniformName, array);\n  }\n  /**\n   * Sets an array on a uniform variable.\n   * @param uniformName Name of the variable.\n   * @param array array to be set.\n   */\n  setArray(uniformName, array) {\n    if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n      return;\n    }\n    this.uniformBuffer.updateArray(uniformName, array);\n  }\n  /**\n   * Sets an array 2 on a uniform variable. (Array is specified as single array eg. [1,2,3,4] will result in [[1,2],[3,4]] in the shader)\n   * @param uniformName Name of the variable.\n   * @param array array to be set.\n   */\n  setArray2(uniformName, array) {\n    this.setArray(uniformName, array);\n  }\n  /**\n   * Sets an array 3 on a uniform variable. (Array is specified as single array eg. [1,2,3,4,5,6] will result in [[1,2,3],[4,5,6]] in the shader)\n   * @param uniformName Name of the variable.\n   * @param array array to be set.\n   */\n  setArray3(uniformName, array) {\n    this.setArray(uniformName, array);\n  }\n  /**\n   * Sets an array 4 on a uniform variable. (Array is specified as single array eg. [1,2,3,4,5,6,7,8] will result in [[1,2,3,4],[5,6,7,8]] in the shader)\n   * @param uniformName Name of the variable.\n   * @param array array to be set.\n   */\n  setArray4(uniformName, array) {\n    this.setArray(uniformName, array);\n  }\n  /**\n   * Sets matrices on a uniform variable.\n   * @param uniformName Name of the variable.\n   * @param matrices matrices to be set.\n   */\n  setMatrices(uniformName, matrices) {\n    if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n      return;\n    }\n    this.uniformBuffer.updateMatrices(uniformName, matrices);\n  }\n  /**\n   * Sets matrix on a uniform variable.\n   * @param uniformName Name of the variable.\n   * @param matrix matrix to be set.\n   */\n  setMatrix(uniformName, matrix) {\n    if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n      return;\n    }\n    this.uniformBuffer.updateMatrix(uniformName, matrix);\n  }\n  /**\n   * Sets a 3x3 matrix on a uniform variable. (Specified as [1,2,3,4,5,6,7,8,9] will result in [1,2,3][4,5,6][7,8,9] matrix)\n   * @param uniformName Name of the variable.\n   * @param matrix matrix to be set.\n   */\n  setMatrix3x3(uniformName, matrix) {\n    if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n      return;\n    }\n    this.uniformBuffer.updateMatrix3x3(uniformName, matrix);\n  }\n  /**\n   * Sets a 2x2 matrix on a uniform variable. (Specified as [1,2,3,4] will result in [1,2][3,4] matrix)\n   * @param uniformName Name of the variable.\n   * @param matrix matrix to be set.\n   */\n  setMatrix2x2(uniformName, matrix) {\n    if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n      return;\n    }\n    this.uniformBuffer.updateMatrix2x2(uniformName, matrix);\n  }\n  /**\n   * Sets a float on a uniform variable.\n   * @param uniformName Name of the variable.\n   * @param value value to be set.\n   */\n  setFloat(uniformName, value) {\n    if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n      return;\n    }\n    this.uniformBuffer.updateFloat(uniformName, value);\n  }\n  /**\n   * Sets a Vector2 on a uniform variable.\n   * @param uniformName Name of the variable.\n   * @param vector2 vector2 to be set.\n   */\n  setVector2(uniformName, vector2) {\n    this.setFloat2(uniformName, vector2.x, vector2.y);\n  }\n  /**\n   * Sets a float2 on a uniform variable.\n   * @param uniformName Name of the variable.\n   * @param x First float in float2.\n   * @param y Second float in float2.\n   */\n  setFloat2(uniformName, x, y) {\n    if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n      return;\n    }\n    this.uniformBuffer.updateFloat2(uniformName, x, y);\n  }\n  /**\n   * Sets a Vector3 on a uniform variable.\n   * @param uniformName Name of the variable.\n   * @param vector3 Value to be set.\n   */\n  setVector3(uniformName, vector3) {\n    this.setFloat3(uniformName, vector3.x, vector3.y, vector3.z);\n  }\n  /**\n   * Sets a float3 on a uniform variable.\n   * @param uniformName Name of the variable.\n   * @param x First float in float3.\n   * @param y Second float in float3.\n   * @param z Third float in float3.\n   */\n  setFloat3(uniformName, x, y, z) {\n    if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n      return;\n    }\n    this.uniformBuffer.updateFloat3(uniformName, x, y, z);\n  }\n  /**\n   * Sets a Vector4 on a uniform variable.\n   * @param uniformName Name of the variable.\n   * @param vector4 Value to be set.\n   */\n  setVector4(uniformName, vector4) {\n    this.setFloat4(uniformName, vector4.x, vector4.y, vector4.z, vector4.w);\n  }\n  /**\n   * Sets a Quaternion on a uniform variable.\n   * @param uniformName Name of the variable.\n   * @param quaternion Value to be set.\n   */\n  setQuaternion(uniformName, quaternion) {\n    this.setFloat4(uniformName, quaternion.x, quaternion.y, quaternion.z, quaternion.w);\n  }\n  /**\n   * Sets a float4 on a uniform variable.\n   * @param uniformName Name of the variable.\n   * @param x First float in float4.\n   * @param y Second float in float4.\n   * @param z Third float in float4.\n   * @param w Fourth float in float4.\n   */\n  setFloat4(uniformName, x, y, z, w) {\n    if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n      return;\n    }\n    this.uniformBuffer.updateFloat4(uniformName, x, y, z, w);\n  }\n  /**\n   * Sets a Color3 on a uniform variable.\n   * @param uniformName Name of the variable.\n   * @param color3 Value to be set.\n   */\n  setColor3(uniformName, color3) {\n    this.setFloat3(uniformName, color3.r, color3.g, color3.b);\n  }\n  /**\n   * Sets a Color4 on a uniform variable.\n   * @param uniformName Name of the variable.\n   * @param color3 Value to be set.\n   * @param alpha Alpha value to be set.\n   */\n  setColor4(uniformName, color3, alpha) {\n    this.setFloat4(uniformName, color3.r, color3.g, color3.b, alpha);\n  }\n  /**\n   * Sets a Color4 on a uniform variable\n   * @param uniformName defines the name of the variable\n   * @param color4 defines the value to be set\n   */\n  setDirectColor4(uniformName, color4) {\n    this.setFloat4(uniformName, color4.r, color4.g, color4.b, color4.a);\n  }\n  _getVertexShaderCode() {\n    return this.sources?.vertex;\n  }\n  _getFragmentShaderCode() {\n    return this.sources?.fragment;\n  }\n}\n//# sourceMappingURL=webgpuPipelineContext.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}