{"ast":null,"code":"import { ReflectionProbe } from \"../Probes/reflectionProbe.js\";\nimport { RenderTargetTexture } from \"../Materials/Textures/renderTargetTexture.js\";\nimport { CustomProceduralTexture } from \"../Materials/Textures/Procedurals/customProceduralTexture.js\";\nimport { DumpTools } from \"./dumpTools.js\";\nimport \"../Shaders/equirectangularPanorama.fragment.js\";\n/**\n * @param scene This refers to the scene which would be rendered in the given equirectangular capture\n * @param options This refers to the options for a given equirectangular capture\n * @returns the requested capture's pixel-data or auto downloads the file if options.filename is specified\n */\nexport async function captureEquirectangularFromScene(scene, options) {\n  const probe = options.probe ?? new ReflectionProbe(\"tempProbe\", options.size, scene);\n  const wasProbeProvided = !!options.probe;\n  if (!wasProbeProvided) {\n    if (options.position) {\n      probe.position = options.position.clone();\n    } else if (scene.activeCamera) {\n      probe.position = scene.activeCamera.position.clone();\n    }\n  }\n  const meshesToConsider = options.meshesFilter ? scene.meshes.filter(options.meshesFilter) : scene.meshes;\n  probe.renderList?.push(...meshesToConsider);\n  probe.refreshRate = RenderTargetTexture.REFRESHRATE_RENDER_ONCE;\n  probe.cubeTexture.render();\n  const dumpTexture = new CustomProceduralTexture(\"tempProceduralTexture\", \"equirectangularPanorama\", {\n    width: options.size * 2,\n    height: options.size\n  }, scene);\n  dumpTexture.setTexture(\"cubeMap\", probe.cubeTexture);\n  return new Promise((resolve, reject) => {\n    dumpTexture.onGeneratedObservable.addOnce(() => {\n      const pixelDataPromise = dumpTexture.readPixels();\n      if (!pixelDataPromise) {\n        reject(new Error(\"No Pixel Data found on procedural texture\"));\n        dumpTexture.dispose();\n        if (!wasProbeProvided) {\n          probe.dispose();\n        }\n        return;\n      }\n      pixelDataPromise.then(pixelData => {\n        dumpTexture.dispose();\n        if (!wasProbeProvided) {\n          probe.dispose();\n        }\n        if (options.filename) {\n          DumpTools.DumpData(options.size * 2, options.size, pixelData, undefined, \"image/png\", options.filename);\n          resolve(null);\n        } else {\n          resolve(pixelData);\n        }\n      });\n    });\n  });\n}\n//# sourceMappingURL=equirectangularCapture.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}